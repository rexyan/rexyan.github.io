<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rexyan.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"top","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"buttons","active":null,"storage":true,"lazyload":true,"nav":{"disqus":{"text":"Load Disqus","order":-1}}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":3,"unescape":false,"preload":false},"motion":{"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="相关概念Spring Cloud是分布式系统的整体解决方案，而不是一项具体的技术。 SpringBoot 和 Spring 的关系SpringBoot底层就是Spring，简化使用Spring的方式而已，多加了好多的自动配置；  Spring Cloud 和 SpringBoot 的关系Spring Cloud是分布式系统的整体解决方案，底层用的SpringBoot来构建项目，Cloud新增很多的">
<meta name="keywords" content="Java 大数据,SpringCloud">
<meta property="og:type" content="article">
<meta property="og:title" content="49. SpringCloud">
<meta property="og:url" content="https://rexyan.github.io/2020/04/08/49. SpringCloud/index.html">
<meta property="og:site_name" content="星尘">
<meta property="og:description" content="相关概念Spring Cloud是分布式系统的整体解决方案，而不是一项具体的技术。 SpringBoot 和 Spring 的关系SpringBoot底层就是Spring，简化使用Spring的方式而已，多加了好多的自动配置；  Spring Cloud 和 SpringBoot 的关系Spring Cloud是分布式系统的整体解决方案，底层用的SpringBoot来构建项目，Cloud新增很多的">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjETprLfOmKZ6izXpKuRv0Po86cEmpvHDldlddZO9iKYlFZZKjISp*heW.ia45.LGhA!!/mnull&bo=1QJBAdUCQQEDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjJF3XT5lmgeiEyeYnzNswTMYaQ8kjGEi59C*Nd7QB7h3zdqdhoMPnphQwgGRnhwWBA!!/mnull&bo=qgI.AaoCPgEDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjOdnJNJVkNgpJNfnffXde.TXtfpVHfgRzmVRAnQzqKnAK07.Ab2GBM.UPQmoPb1QaQ!!/mnull&bo=ngTwBZ4E8AUDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjDcfSoTzWcWoDZ8*t29ObT0ZSMQH7xcQP95Yy6*ub9KPiclKuewkqLgLMGAUDtwPXw!!/mnull&bo=nAT4BZwE.AUDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjEH.9HMcUQBBQJpu7zCF.Cjcy1ggnjbVWtPrr4L7vSzxPlG07eRZ878fyHH559aI4w!!/mnull&bo=AgWAAgYNgAYDCSQ!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjA4gljNEbFXPXWvWAo1u3JDQCKCOcGRptvkfmMLd47lWIs8uLk2ccPbu1czxDWKRoQ!!/mnull&bo=nASaBZwEmgUDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjElLmFxAkmzrLwm*BnhqtGbVk70gA5.SXZUMuxd6wdNt6V0QwUGwox*NHsc2sNf8Qw!!/mnull&bo=ngSSBZ4EkgUDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjAA2pOhCc7AwrCeAjZgQjfkur69HVgwzz1orRfgNuIBSUxeeQR4QNQJaTUOKf9HvTg!!/mnull&bo=4Aw.AeAMPgEDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjM0EEaebWjzexREQjbiGHrARWdV2yhHK6q995OeTP20hRdEYYdXp93bnnpcQptcC7w!!/mnull&bo=mgSWBZoElgUDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjGZrZktHGLR4bytkqyjiDRvAF1ZpY0W80.5yi4fg4C4Ja66xHAWJ.NoSKXslsVut3A!!/mnull&bo=mgSUBZoElAUDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjE9.UEVXuXsZUTS8JMe3MmDOWBVcSlUzfGlFj2ODJugu2XbBhtqqbrlx4y0zAG2mKA!!/mnull&bo=4gzsAeIM7AEDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjAwj27DUDB7C7EY6ZWYzjUznd71fT9*FkIhRjcKzH*aQPx7*gvUy4S3cMrMBU2IDpQ!!/mnull&bo=dgYGBHYGBgQDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjPrwZI5.EX6*d0OoqZf0jmxMFMGVRcgrqxP2gASA.jQx8fDaoPTJasQEAJa0e8K9Fw!!/mnull&bo=ggWAAmwG6gIDCas!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjE.mdVWiW4b1MjDHygdH2Q7ynVjdGjoL8jMfDtM*dP4iBgTYO05MOoANNNbXhVpZlA!!/mnull&bo=YgaAApoGlgIDCcI!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjGZD.1Ob2U9Sh.mQX7fEM9R0*nauN2jU4.Yv89Z*B4vRnjspDtGwBKFqw24CIPpcrA!!/mnull&bo=9Af6BPQH.gQDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjDKWu4FkNTat3JsQ4fd9GBZ6duA*mZloXRDgP9pTACgHMF74YiDWdJzzCesKXDTUbg!!/mnull&bo=YAcWAWAHFgEDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjCdee99S.piwDAkK9qIrvf9pQIheWvvc*Mqse8cx8244yMVyb0vJ0Zg3ILbKddamvg!!/mnull&bo=2gxgAdoMYAEDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjE4w5BihH5M34gM*B1wQZ6PdxeLzvTxQfGJcAl4lSoh8*EYTQ3I64U6*tXzzyAvW3A!!/mnull&bo=YgcIAWIHCAEDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjKkCFHifrt5OuGHYpT6PFsOOlk0rz*IWdOdTXqN0kGSOqIUd5TKPwuIGC9rXPZ3*MQ!!/mnull&bo=7gckAe4HJAEDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjNdj6U10goV50s5UWeokBIqVsuf6jEYmzO0.eIG1B8GXtEjCI5EA47QYXJ7qRhdsYA!!/mnull&bo=ogJQAaICUAEDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjD6Uwc.eC7psJYY2vdsHpX1hD4cQlMtHB05gra*6cVJXJkldKPIZRYIJUbQBUidv2w!!/mnull&bo=swI9ArMCPQIDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjBj2srQ7FYjRBunnq9JkwLWClrdGxyYL*l9kvSvd4ymcMZr7Bq09J41zkyWmWYPrtQ!!/mnull&bo=HAWAAvYJ4AQDCaw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjFdLG5O23PGeiOZxM2L9BJM6QOnb6AoMJxkI*dkudfrExkMzhrg8DFI9fg.AkQUVLQ!!/mnull&bo=6AWAAjwHEAMDCWs!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjMAksl66**oENFI765VJxrnUDYZYKrUqlcJdHYM2uuP1jgx2YHsSyz2R5j4mHcnYcA!!/mnull&bo=FQaAAtAHNgMDCV8!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:updated_time" content="2025-10-31T03:20:39.387Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="49. SpringCloud">
<meta name="twitter:description" content="相关概念Spring Cloud是分布式系统的整体解决方案，而不是一项具体的技术。 SpringBoot 和 Spring 的关系SpringBoot底层就是Spring，简化使用Spring的方式而已，多加了好多的自动配置；  Spring Cloud 和 SpringBoot 的关系Spring Cloud是分布式系统的整体解决方案，底层用的SpringBoot来构建项目，Cloud新增很多的">
<meta name="twitter:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjETprLfOmKZ6izXpKuRv0Po86cEmpvHDldlddZO9iKYlFZZKjISp*heW.ia45.LGhA!!/mnull&bo=1QJBAdUCQQEDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">

<link rel="canonical" href="https://rexyan.github.io/2020/04/08/49. SpringCloud/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>49. SpringCloud | 星尘</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  
  <link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.6.0/lxgwwenkaiscreen.css" />
  <!-- 自定义为霞鹜文楷字体 -->
  <style>
	  body,div.post-body,h1,h2,h3,h4 {
		font-family: "LXGW WenKai Screen", sans-serif;
		font-size: 104%;
	  }
  </style>
  
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">星尘</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-读书">

    <a href="/books/" rel="section"><i class="address-book fa-fw"></i>读书</a>

  </li>
        <li class="menu-item menu-item-瞎扯">

    <a href="/crap/" rel="section"><i class="crap fa-fw"></i>瞎扯</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



<script src="https://cdn.jsdelivr.net/npm/echarts@4.8.0/dist/echarts.min.js"></script>

<meta name="referrer" content="never">




  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://rexyan.github.io/2020/04/08/49. SpringCloud/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/rexyan/warehouse/master/20230809141242.jpg">
      <meta itemprop="name" content="Rex">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="星尘">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          49. SpringCloud
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-08 23:05:57" itemprop="dateCreated datePublished" datetime="2020-04-08T23:05:57+00:00">2020-04-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-31 03:20:39" itemprop="dateModified" datetime="2025-10-31T03:20:39+00:00">2025-10-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java-大数据/" itemprop="url" rel="index"><span itemprop="name">Java 大数据</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h3><p>Spring Cloud是分布式系统的整体解决方案，而不是一项具体的技术。</p>
<h4 id="SpringBoot-和-Spring-的关系"><a href="#SpringBoot-和-Spring-的关系" class="headerlink" title="SpringBoot 和 Spring 的关系"></a>SpringBoot 和 Spring 的关系</h4><p>SpringBoot底层就是Spring，简化使用Spring的方式而已，多加了好多的自动配置； </p>
<h4 id="Spring-Cloud-和-SpringBoot-的关系"><a href="#Spring-Cloud-和-SpringBoot-的关系" class="headerlink" title="Spring Cloud 和 SpringBoot 的关系"></a>Spring Cloud 和 SpringBoot 的关系</h4><p>Spring Cloud是分布式系统的整体解决方案，底层用的SpringBoot来构建项目，Cloud新增很多的分布式的starter，包括这些starter的自动配置；</p>
<h4 id="资料信息"><a href="#资料信息" class="headerlink" title="资料信息"></a>资料信息</h4><p><a href="http://spring.io/projects" target="_blank" rel="noopener">http://spring.io/projects</a><br><a href="https://projects.spring.io/spring-cloud/#quick-start" target="_blank" rel="noopener">https://projects.spring.io/spring-cloud/#quick-start</a><br><a href="https://springcloud.cc/" target="_blank" rel="noopener">https://springcloud.cc/</a></p>
<h3 id="SpringCloud-案例开发"><a href="#SpringCloud-案例开发" class="headerlink" title="SpringCloud 案例开发"></a>SpringCloud 案例开发</h3><p>本次 SpringCloud 开发案例如下：需要创建注册中心，用于服务和电影服务。两个服务之间采用 SpringCloud 自带的 RESETful 进行调用。可以查询用户，购买电影票查询最新电影等操作。</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjETprLfOmKZ6izXpKuRv0Po86cEmpvHDldlddZO9iKYlFZZKjISp*heW.ia45.LGhA!!/mnull&amp;bo=1QJBAdUCQQEDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<h3 id="注册中心"><a href="#注册中心" class="headerlink" title="注册中心"></a>注册中心</h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p>注册中心的作用是管理所有服务（服务发现和注册）。注册中心中的 Region 和 Zone 就相当于大区和机房，一个 Region（大区）可以有很多的 Zone（机房）。在Spring Cloud 中，服务消费者会优先查找在同一个 Zone 的服务，之后在去查找其他的服务。如果该项配置使用的好，那么项目请求的响应时间将大大缩短！</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjJF3XT5lmgeiEyeYnzNswTMYaQ8kjGEi59C*Nd7QB7h3zdqdhoMPnphQwgGRnhwWBA!!/mnull&amp;bo=qgI.AaoCPgEDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<h4 id="创建注册中心"><a href="#创建注册中心" class="headerlink" title="创建注册中心"></a>创建注册中心</h4><p>创建一个 Spring Starter Project</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjOdnJNJVkNgpJNfnffXde.TXtfpVHfgRzmVRAnQzqKnAK07.Ab2GBM.UPQmoPb1QaQ!!/mnull&amp;bo=ngTwBZ4E8AUDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p>引入 eureka-server</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjDcfSoTzWcWoDZ8*t29ObT0ZSMQH7xcQP95Yy6*ub9KPiclKuewkqLgLMGAUDtwPXw!!/mnull&amp;bo=nAT4BZwE.AUDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p>新增 application.yml，内容如下：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-eureka-registry-center</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8761</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment">#自己就是注册中心，不用注册自己</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span> <span class="comment">#要不要去注册中心获取其他服务的地址</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">    	 <span class="comment"># 这里是引用的上面的配置，eureka.instance.hostname 就是 localhost。server.port 就是 8761</span></span><br><span class="line">       <span class="attr">defaultZone:</span> <span class="string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br></pre></td></tr></table></figure>
<p>主程序使用注解 <code>@EnableEurekaServer</code> 开启 Eureka 注册中心功能 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明当前项目为注册中心</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CloudEurekaRegistryCenterApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(CloudEurekaRegistryCenterApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问 <a href="http://localhost:8761/" target="_blank" rel="noopener">http://localhost:8761/</a> 就能查看注册中心的 Dashboard 页面信息</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjEH.9HMcUQBBQJpu7zCF.Cjcy1ggnjbVWtPrr4L7vSzxPlG07eRZ878fyHH559aI4w!!/mnull&amp;bo=AgWAAgYNgAYDCSQ!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<h3 id="创建电影服务"><a href="#创建电影服务" class="headerlink" title="创建电影服务"></a>创建电影服务</h3><p>新建 Spring Starter Project</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjA4gljNEbFXPXWvWAo1u3JDQCKCOcGRptvkfmMLd47lWIs8uLk2ccPbu1czxDWKRoQ!!/mnull&amp;bo=nASaBZwEmgUDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p>选择 Eureka Client Starter 和 Spring Web Starter</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjElLmFxAkmzrLwm*BnhqtGbVk70gA5.SXZUMuxd6wdNt6V0QwUGwox*NHsc2sNf8Qw!!/mnull&amp;bo=ngSSBZ4EkgUDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p>创建 Controller，dao，service，service.impl，bean 包，MovieController 中的内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.bean.Movie;</span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.service.MovieService;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里使用 @RestController 来替代 @Controller 和 @ResponseBody</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	MovieService moviceService;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// @ResponseBody</span></span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/getMovieById/&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Movie <span class="title">getMovieById</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> moviceService.getMovieById(id);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其余 dao，service，service.impl，bean 中的内容不在这里记录，直接启动项目（注意这里虽然没有配置 Eureka注册和发现，但是要确保你的 Eureka 已经启动了）</p>
<p>直接测试 <a href="http://localhost:8080/getMovieById/1" target="_blank" rel="noopener">http://localhost:8080/getMovieById/1</a> 看看是否有数据返回，有数据返回则接口就可以了，接下来配置 Eureka，新建 application.yml 文件，内容如下：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-provider-movie</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8000</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 指定注册到哪个注册中心</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8761/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment">#注册自己服务使用ip的方式</span></span><br></pre></td></tr></table></figure>
<p>在主程序中添加注解 <code>@EnableDiscoveryClient</code> 让其注册到注册中心当中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将该服务注册到注册中心（即启用服务注册和发现功能）</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CloudProviderMovieApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(CloudProviderMovieApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意⚠️：在启动类上面添加 <code>@EnableDiscoveryClient</code>、<code>@EnableEurekaClient</code> 这二个注解作用，都可以让该服务注册到注册中心上去。不同点：<code>@EnableEurekaClient</code> 只支持Eureka注册中心，<code>@EnableDiscoveryClient</code>支持 Eureka、Zookeeper、Consul 这三个注册中心。</p>
<p>在此查看 Eureka 的 dashboard，就会看到服务已经注册进来了：</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjAA2pOhCc7AwrCeAjZgQjfkur69HVgwzz1orRfgNuIBSUxeeQR4QNQJaTUOKf9HvTg!!/mnull&amp;bo=4Aw.AeAMPgEDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<h3 id="创建用户服务"><a href="#创建用户服务" class="headerlink" title="创建用户服务"></a>创建用户服务</h3><p>新建 Spring Starter Project</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjM0EEaebWjzexREQjbiGHrARWdV2yhHK6q995OeTP20hRdEYYdXp93bnnpcQptcC7w!!/mnull&amp;bo=mgSWBZoElgUDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p>选择 Eureka Client Starter 和 Spring Web Starter</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjGZrZktHGLR4bytkqyjiDRvAF1ZpY0W80.5yi4fg4C4Ja66xHAWJ.NoSKXslsVut3A!!/mnull&amp;bo=mgSUBZoElAUDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p>创建 Controller，dao，service，service.impl，bean 包，UserController 中的内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.bean.User;</span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	UserService userService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/getUserById/&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> userService.getUserById(id);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>直接测试 <a href="http://localhost:8080/getUserById/1" target="_blank" rel="noopener">http://localhost:8080/getUserById/1</a> 看看是否有数据返回，有数据返回则接口就可以了，接下来配置 Eureka，新建 application.yml 文件，内容如下：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-provider-user</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9000</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 指定注册到哪个注册中心</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8761/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment">#注册自己服务使用ip的方式</span></span><br></pre></td></tr></table></figure>
<p>在主程序中添加注解 <code>@EnableDiscoveryClient</code> 让其注册到注册中心当中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CloudProviderUserApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(CloudProviderUserApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看 Eureka Dashboard，就会看到 Movie 服务和 User 服务都注册到里面了</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjE9.UEVXuXsZUTS8JMe3MmDOWBVcSlUzfGlFj2ODJugu2XbBhtqqbrlx4y0zAG2mKA!!/mnull&amp;bo=4gzsAeIM7AEDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<h3 id="远程调用"><a href="#远程调用" class="headerlink" title="远程调用"></a>远程调用</h3><p>远程调用可以使用 RestTemplate 和 Feign。两种方式都需要掌握，Feign 可能会用得更多些。</p>
<h4 id="RestTemplate"><a href="#RestTemplate" class="headerlink" title="RestTemplate"></a>RestTemplate</h4><h5 id="引入-Ribbon"><a href="#引入-Ribbon" class="headerlink" title="引入 Ribbon"></a>引入 Ribbon</h5><p>在 dependencies 中使用 <code>Alt + /</code> 然后选择 <code>Insert dependeny</code> 这样就能选择导入被父工程管理的包。</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjAwj27DUDB7C7EY6ZWYzjUznd71fT9*FkIhRjcKzH*aQPx7*gvUy4S3cMrMBU2IDpQ!!/mnull&amp;bo=dgYGBHYGBgQDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<h5 id="容器注入-RestTemplate"><a href="#容器注入-RestTemplate" class="headerlink" title="容器注入 RestTemplate"></a>容器注入 RestTemplate</h5><p>给容器中注入一个RestTemplate并使用Ribbon进行负载均衡调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CloudProviderUserApplication</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 配置 RestTemplate bean 对象。因为这里主程序是一个配置类，所以就写在这里（并不是非得写到这里，只要是配置类就行）</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@LoadBalanced</span> <span class="comment">// 负载均衡</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(CloudProviderUserApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="远程调用-1"><a href="#远程调用-1" class="headerlink" title="远程调用"></a>远程调用</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.bean.Movie;</span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.bean.User;</span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	UserService userService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取用户信息</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/getUserById/&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> userService.getUserById(id);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 购买电影票</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> movieId</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/buyMovie/&#123;userId&#125;/&#123;movieId&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">buyMovie</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			@PathVariable(<span class="string">"userId"</span>)</span> Integer userId, </span></span><br><span class="line"><span class="function">			@<span class="title">PathVariable</span><span class="params">(<span class="string">"movieId"</span>)</span> Integer movieId</span></span><br><span class="line"><span class="function">	)</span>&#123;</span><br><span class="line">		HashMap&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">		<span class="comment">// 获取用户信息，查询自己的服务即可</span></span><br><span class="line">		User user = userService.getUserById(userId);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 查询电影信息，需要远程调用</span></span><br><span class="line">		Movie movie = restTemplate.getForObject(<span class="string">"http://CLOUD-PROVIDER-MOVIE/getMovieById/"</span>+movieId, Movie<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		</span><br><span class="line">		result.put(<span class="string">"user"</span>, user);</span><br><span class="line">		result.put(<span class="string">"movie"</span>, movie);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问 <a href="http://localhost:9000/buyMovie/1/2" target="_blank" rel="noopener">http://localhost:9000/buyMovie/1/2</a> 返回数据如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"movie"</span>:&#123;<span class="attr">"id"</span>:<span class="number">2</span>,<span class="attr">"name"</span>:<span class="string">"电影名称2"</span>&#125;,<span class="attr">"user"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1</span>,<span class="attr">"name"</span>:<span class="string">"User1"</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="集成-Ribbon"><a href="#集成-Ribbon" class="headerlink" title="集成 Ribbon"></a>集成 Ribbon</h5><p>多运行几个 Movie 服务（多拷贝几份配置，并将配置端口设置为不一样的值）</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjPrwZI5.EX6*d0OoqZf0jmxMFMGVRcgrqxP2gASA.jQx8fDaoPTJasQEAJa0e8K9Fw!!/mnull&amp;bo=ggWAAmwG6gIDCas!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjE.mdVWiW4b1MjDHygdH2Q7ynVjdGjoL8jMfDtM*dP4iBgTYO05MOoANNNbXhVpZlA!!/mnull&amp;bo=YgaAApoGlgIDCcI!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p>配置多个 Movie 服务的端口。并在 Controller 中打印服务的端口信息，用来显示当前运行的端口</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjGZD.1Ob2U9Sh.mQX7fEM9R0*nauN2jU4.Yv89Z*B4vRnjspDtGwBKFqw24CIPpcrA!!/mnull&amp;bo=9Af6BPQH.gQDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.bean.Movie;</span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.service.MovieService;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里使用 @RestController 来替代 @Controller 和 @ResponseBody</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	MovieService moviceService;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 获取当前配置的端口信息，用来判断那个 Movie 服务被调用</span></span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"$&#123;server.port&#125;"</span>)</span><br><span class="line">	<span class="keyword">int</span> port;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// @ResponseBody</span></span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/getMovieById/&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Movie <span class="title">getMovieById</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">    <span class="comment">// 打印端口信息</span></span><br><span class="line">		System.out.println(<span class="string">"port: "</span> + port);</span><br><span class="line">		<span class="keyword">return</span> moviceService.getMovieById(id);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动项目</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjDKWu4FkNTat3JsQ4fd9GBZ6duA*mZloXRDgP9pTACgHMF74YiDWdJzzCesKXDTUbg!!/mnull&amp;bo=YAcWAWAHFgEDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p>查看注册中心，就会发现 Movie 的三个服务都注册到注册中心了</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjCdee99S.piwDAkK9qIrvf9pQIheWvvc*Mqse8cx8244yMVyb0vJ0Zg3ILbKddamvg!!/mnull&amp;bo=2gxgAdoMYAEDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p>再次调用购买电影票的接口 <a href="http://localhost:9000/buyMovie/1/2" target="_blank" rel="noopener">http://localhost:9000/buyMovie/1/2</a>  6 次就会看到打印的端口信息。每个服务都打印了端口两次，也就说被调用了两次。（默认是轮训策略，每个 Movie 服务被调用一次，六次就是每个被调用两次。这说明 RestTemplate 默认就是和 Ribbon 集成的）</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjE4w5BihH5M34gM*B1wQZ6PdxeLzvTxQfGJcAl4lSoh8*EYTQ3I64U6*tXzzyAvW3A!!/mnull&amp;bo=YgcIAWIHCAEDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p>注意⚠️：这里的 <code>@LoadBalanced</code> 是配置在 User 服务上的，也就是说这里 Ribbon 是在发挥正向代理的作用，请求发给 User 服务，然后进入到 Ribbon 中进行负载均衡，将请求发往不同的 Movie 服务。Nginx 的那种代理是反向代理。</p>
<h4 id="Feign"><a href="#Feign" class="headerlink" title="Feign"></a>Feign</h4><h5 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h5><p>复制一份 User 服务，名字叫做 cloud-provider-user-feign，并将以前的 User 服务名称修改为 cloud-provider-user-restTemplate，分别修改两个服务中的 pom 坐标和 application.yml 中的名称。</p>
<h5 id="引入-Feign"><a href="#引入-Feign" class="headerlink" title="引入 Feign"></a>引入 Feign</h5><p>在 cloud-provider-user-feign 的 pom 文件中引入 feign 的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="启用-Feign"><a href="#启用-Feign" class="headerlink" title="启用 Feign"></a>启用 Feign</h5><p>在主程序中加上注解 <code>@EnableFeignClients</code> 启用 Feign 客户端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CloudProviderUserApplication</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(CloudProviderUserApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="创建-Feign-远程调用接口"><a href="#创建-Feign-远程调用接口" class="headerlink" title="创建 Feign 远程调用接口"></a>创建 Feign 远程调用接口</h5><p>在 service 包下新建 MovieServiceFeign 接口，并在接口上加上 <code>@FeignClient</code> 注解。并添加和要远程调用的 Movie 中的方法（确保名称和参数都一摸一样，只是不需要实现而已）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.bean.Movie;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明这是一个 Feign 的客户端（远程调用端）并指定远程服务地址（名称）</span></span><br><span class="line"><span class="meta">@FeignClient</span>(value=<span class="string">"CLOUD-PROVIDER-MOVIE"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MovieServiceFeign</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 要远程调用的方法。这里的方法和 Movie Controller 中的一摸一样。</span></span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/getMovieById/&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Movie <span class="title">getMovieById</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="实现调用"><a href="#实现调用" class="headerlink" title="实现调用"></a>实现调用</h5><p>在 User Controller 中修改购买电影票接口，让其去调用 Feign 中配置的接口。只需要将以前 RestTemplate 中的远程调用方法更换为使用 Feign 去调用就行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.bean.Movie;</span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.bean.User;</span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.service.MovieServiceFeign;</span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	UserService userService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	MovieServiceFeign moviceServiceFeign;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取用户信息</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/getUserById/&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> userService.getUserById(id);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 购买电影票</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> movieId</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/buyMovie/&#123;userId&#125;/&#123;movieId&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">buyMovie</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			@PathVariable(<span class="string">"userId"</span>)</span> Integer userId, </span></span><br><span class="line"><span class="function">			@<span class="title">PathVariable</span><span class="params">(<span class="string">"movieId"</span>)</span> Integer movieId</span></span><br><span class="line"><span class="function">	)</span>&#123;</span><br><span class="line">		HashMap&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">		<span class="comment">// 获取用户信息，查询自己的服务即可</span></span><br><span class="line">		User user = userService.getUserById(userId);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 查询电影信息，需要远程调用</span></span><br><span class="line">		Movie movie = moviceServiceFeign.getMovieById(movieId);</span><br><span class="line">		</span><br><span class="line">		result.put(<span class="string">"user"</span>, user);</span><br><span class="line">		result.put(<span class="string">"movie"</span>, movie);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="集成-Ribbon-1"><a href="#集成-Ribbon-1" class="headerlink" title="集成 Ribbon"></a>集成 Ribbon</h5><p>Feign 默认就是和 Ribbon 集成的。调用六次会发现，每个 Movie 服务都被平均的调用了两次。</p>
<h3 id="熔断"><a href="#熔断" class="headerlink" title="熔断"></a>熔断</h3><p>当停止其中一个 Movie 服务接口的时候，继续调用 <a href="http://localhost:9001/buyMovie/1/2" target="_blank" rel="noopener">http://localhost:9001/buyMovie/1/2</a> 时可能会出现卡顿或者中断的情况，原因就是请求发送到停止的 Movie 服务上去了。过一会儿就恢复了，原因是注册中心发现此 Movie 服务心跳没了，所以将该服务从注册中心中进行了剔除。</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjKkCFHifrt5OuGHYpT6PFsOOlk0rz*IWdOdTXqN0kGSOqIUd5TKPwuIGC9rXPZ3*MQ!!/mnull&amp;bo=7gckAe4HJAEDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p>如果三个电影服务都挂了，那就导致了 User 服务完成不能调用 Movie 服务的情况。</p>
<p>熔断的作用是防止其中一个服务不可用而导致整个服务链路的雪崩，会在发生熔断的时候返回假数据。Ribbon 和 Hystrix 可以组合使用。Feign 和 Hystrix 也能组合使用。</p>
<p>熔断的状态转换如下：默认熔断是关闭的，当服务请求失败且达到一定的阀值的时候就会被打开，随着服务的慢慢恢复，会由半开状态慢慢的又转换为关闭状态。</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjNdj6U10goV50s5UWeokBIqVsuf6jEYmzO0.eIG1B8GXtEjCI5EA47QYXJ7qRhdsYA!!/mnull&amp;bo=ogJQAaICUAEDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<h4 id="Hystrix-Ribbon"><a href="#Hystrix-Ribbon" class="headerlink" title="Hystrix + Ribbon"></a>Hystrix + Ribbon</h4><p>添加 pom 依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入hystrix进行服务熔断 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在主程序上开启断路保护功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span>  <span class="comment">// 开启断路保护功能</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CloudProviderUserApplication</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 配置 RestTemplate bean 对象。因为这里主程序是一个配置类，所以就写在这里（并不是非得写到这里，只要是配置类就行）</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@LoadBalanced</span> <span class="comment">// 负载均衡</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(CloudProviderUserApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编写断路处理方法【注意⚠️：这个方法的定义要和远程调用方法的定义一摸一样，也就是除了方法名，参数，返回值什么的都需要一样，请求映射 @GetMapping 不用加】，当发生服务不能远程调用的时候，就使用断路方法的逻辑进行处理。需要在远程调用的方法上加上 <code>@HystrixCommand</code> 注解，并指定发生断路的时候，要调用的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.bean.Movie;</span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.bean.User;</span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	UserService userService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取用户信息</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/getUserById/&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> userService.getUserById(id);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 购买电影票</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> movieId</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@HystrixCommand</span>(fallbackMethod = <span class="string">"buyMovieHystrix"</span>) <span class="comment">// 当发生断路的时候，调用该方法进行处理</span></span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/buyMovie/&#123;userId&#125;/&#123;movieId&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">buyMovie</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			@PathVariable(<span class="string">"userId"</span>)</span> Integer userId, </span></span><br><span class="line"><span class="function">			@<span class="title">PathVariable</span><span class="params">(<span class="string">"movieId"</span>)</span> Integer movieId</span></span><br><span class="line"><span class="function">	)</span>&#123;</span><br><span class="line">		HashMap&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">		<span class="comment">// 获取用户信息，查询自己的服务即可</span></span><br><span class="line">		User user = userService.getUserById(userId);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 查询电影信息，需要远程调用</span></span><br><span class="line">		Movie movie = restTemplate.getForObject(<span class="string">"http://CLOUD-PROVIDER-MOVIE/getMovieById/"</span>+movieId, Movie<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		</span><br><span class="line">		result.put(<span class="string">"user"</span>, user);</span><br><span class="line">		result.put(<span class="string">"movie"</span>, movie);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 熔断处理逻辑（请求映射 <span class="doctag">@GetMapping</span> 不用加）</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> movieId</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">buyMovieHystrix</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			@PathVariable(<span class="string">"userId"</span>)</span> Integer userId, </span></span><br><span class="line"><span class="function">			@<span class="title">PathVariable</span><span class="params">(<span class="string">"movieId"</span>)</span> Integer movieId</span></span><br><span class="line"><span class="function">	)</span>&#123;</span><br><span class="line">		Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">		User user = <span class="keyword">new</span> User(-<span class="number">1</span>, <span class="string">"无此用户"</span>);</span><br><span class="line">		Movie movie = <span class="keyword">new</span> Movie(-<span class="number">1</span>, <span class="string">"无此电影"</span>);</span><br><span class="line">		</span><br><span class="line">		map.put(<span class="string">"user"</span>, user);</span><br><span class="line">		map.put(<span class="string">"movie"</span>, movie);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> map;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次将三个 Movie 服务进行重启，然后中断其中某一个或者两个 Movie 服务，或者全部中断，访问 <a href="http://localhost:9002/buyMovie/1/2" target="_blank" rel="noopener">http://localhost:9002/buyMovie/1/2</a> 就会看到会出现以下返回：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"movie"</span>:&#123;<span class="attr">"id"</span>:<span class="number">-1</span>,<span class="attr">"name"</span>:<span class="string">"无此电影"</span>&#125;,<span class="attr">"user"</span>:&#123;<span class="attr">"id"</span>:<span class="number">-1</span>,<span class="attr">"name"</span>:<span class="string">"无此用户"</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>过一会儿之后，就会发现没有这种返回了，原因是被注册中心已经将该服务给去掉了。</p>
<p>关闭 Ribbon 重试机制，在远程服务调用不通的情况下，Ribbon 会进行重试。只需要配置文件中关闭重试即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ribbon:</span><br><span class="line">  # http建立socket超时时间,毫秒</span><br><span class="line">  ConnectTimeout: 2000</span><br><span class="line">  # http读取响应socket超时时间</span><br><span class="line">  ReadTimeout: 10000</span><br><span class="line">  # 同一台实例最大重试次数,不包括首次调用</span><br><span class="line">  MaxAutoRetries: 0</span><br><span class="line">  # 重试负载均衡其他的实例最大重试次数,不包括首次server</span><br><span class="line">  MaxAutoRetriesNextServer: 0</span><br><span class="line">  # 是否所有操作都重试，POST请求注意多次提交错误。</span><br><span class="line">  # 默认false，设定为false的话，只有get请求会重试</span><br><span class="line">  OkToRetryOnAllOperations: false</span><br></pre></td></tr></table></figure>
<h4 id="Hystrix-Feign"><a href="#Hystrix-Feign" class="headerlink" title="Hystrix + Feign"></a>Hystrix + Feign</h4><p>添加 pom 依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入hystrix进行服务熔断 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>application.yml 中开启 Feign 对 Hystrix 支持</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-provider-user-feign</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9001</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 指定注册到哪个注册中心</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8761/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment">#注册自己服务使用ip的方式</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#默认false</span></span><br></pre></td></tr></table></figure>
<p>主程序入口开启断路保护功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span> <span class="comment">// 开启断路保护功能</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CloudProviderUserApplication</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(CloudProviderUserApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>新建一个 exception 包，里面定义一个异常处理类 <code>MovieServiceFeignException</code> 并实现之前的远程方法调用接口 <code>MovieServiceFeign</code> 。重写里面的远程调用方法，返回一个虚假的 Movie 对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.bean.Movie;</span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.service.MovieServiceFeign;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieServiceFeignException</span> <span class="keyword">implements</span> <span class="title">MovieServiceFeign</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Movie <span class="title">getMovieById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		Movie movie = <span class="keyword">new</span> Movie(-<span class="number">1</span>, <span class="string">"无此电影"</span>);</span><br><span class="line">		<span class="keyword">return</span> movie;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在远程调用接口 <code>MovieServiceFeign</code> 中的 <code>@FeignClient</code> 装饰器上加上 fallback 回调的属性，值为刚才新增的异常处理类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.bean.Movie;</span><br><span class="line"><span class="keyword">import</span> com.itguigu.springcloud.exception.MovieServiceFeignException;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明这是一个 Feign 的客户端（远程调用端）并指定远程服务地址（名称）。指定断路异常处理类</span></span><br><span class="line"><span class="meta">@FeignClient</span>(value=<span class="string">"CLOUD-PROVIDER-MOVIE"</span>, fallback = MovieServiceFeignException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">interface</span> <span class="title">MovieServiceFeign</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 要远程调用的方法。这里的方法和 Movie Controller 中的一摸一样。</span></span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/getMovieById/&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Movie <span class="title">getMovieById</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>做同样测试，再次将三个 Movie 服务进行重启，然后中断其中某一个或者两个 Movie 服务，或者全部中断，访问 <a href="http://localhost:9001/buyMovie/1/2【注意，这里" target="_blank" rel="noopener">http://localhost:9001/buyMovie/1/2【注意，这里</a> 9001 是演示 Hystrix + Feign 的地址，之前的 9002 是演示 Hystrix + Ribbon 的地址 】 就会看到会出现以下返回：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"movie"</span>:&#123;<span class="attr">"id"</span>:<span class="number">-1</span>,<span class="attr">"name"</span>:<span class="string">"无此电影"</span>&#125;,<span class="attr">"user"</span>:&#123;<span class="attr">"id"</span>:<span class="number">-1</span>,<span class="attr">"name"</span>:<span class="string">"无此用户"</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>过一会儿之后，就会发现没有这种返回了，原因是被注册中心已经将该服务给去掉了。</p>
<p>注意⚠️：这里的熔断是加在用户端的，也就是说当电影服务出现问题的时候，默认执行的是在用户端设置的断路处理逻辑，即返回的是虚假的数据。所以哪怕是电影服务全部挂掉之后，用户服务调用失败也会有返回值，因为这个断路处理逻辑是在用户端加上的。</p>
<h4 id="Hystrix-Dashboard"><a href="#Hystrix-Dashboard" class="headerlink" title="Hystrix Dashboard"></a>Hystrix Dashboard</h4><p>Hystrix 提供了近实时的监控，Hystrix 会实时、累加地记录所有关于 HystrixCommand 的执行信息，包括每秒执行多少请求，多少成功，多少失败等。Netflix 通过 <strong>hystrix-metrics-event-stream</strong> 项目实现了对以上指标的监控。</p>
<p><strong>spring-boot-starter-actuator</strong> 为 SpringBoot 提供了监控，以上面的使用 Feign 的项目为例子来做演示。在 pom 文件中加上以下依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入 actuator 监控 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>直接启动 cloud-provider-user-feign 项目，访问 <a href="http://localhost:9001/actuator/health" target="_blank" rel="noopener">http://localhost:9001/actuator/health</a> 就能获得当前项目的运行状态:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"status"</span>:<span class="string">"UP"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>还能查看其他更多信息：</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjD6Uwc.eC7psJYY2vdsHpX1hD4cQlMtHB05gra*6cVJXJkldKPIZRYIJUbQBUidv2w!!/mnull&amp;bo=swI9ArMCPQIDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p>此时如果我们想用 Hystrix 的 Dashboard 的话，还需修改配置文件，暴露出数据监控流。在 application.yml 中加入以下配置：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-provider-user-feign</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9001</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 指定注册到哪个注册中心</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8761/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment">#注册自己服务使用ip的方式</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#默认false</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 暴露 Hystrix 监控数据流</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">hystrix.stream</span> <span class="comment"># 访问/actuator/hystrix.stream 能看到不断更新的监控流</span></span><br></pre></td></tr></table></figure>
<p>访问 <a href="http://localhost:9001/actuator/hystrix.stream" target="_blank" rel="noopener">http://localhost:9001/actuator/hystrix.stream</a> 地址能看到页面输出一些 ping 信息，但是不能看数据的详细情况。此时，我们需要引入 HystrixDashboard，在 pom 文件中加入以下依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入 hystrix-dashboard --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在主程序上加入 <code>@EnableHystrixDashboard</code> 注解，开启可视化监控功能:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itguigu.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.hystrix.dashboard.EnableHystrixDashboard;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableHystrixDashboard</span> <span class="comment">// 开启可视化监控</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span> <span class="comment">// 开启断路保护功能</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CloudProviderUserApplication</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(CloudProviderUserApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重启项目后访问 dashboard 监控地址 <a href="http://localhost:9001/hystrix，并填入之前的监控流地址" target="_blank" rel="noopener">http://localhost:9001/hystrix，并填入之前的监控流地址</a> <a href="http://localhost:9001/actuator/hystrix.stream" target="_blank" rel="noopener">http://localhost:9001/actuator/hystrix.stream</a> 进入后就可能看到监控页面。</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjBj2srQ7FYjRBunnq9JkwLWClrdGxyYL*l9kvSvd4ymcMZr7Bq09J41zkyWmWYPrtQ!!/mnull&amp;bo=HAWAAvYJ4AQDCaw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p>编写一个shell 脚本，让它一直请求购买电影的服务接口 <a href="http://localhost:9001/buyMovie/1/2" target="_blank" rel="noopener">http://localhost:9001/buyMovie/1/2</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">while true;         </span><br><span class="line">do curl http://localhost:9001/buyMovie/1/2;</span><br><span class="line">done;</span><br></pre></td></tr></table></figure>
<p>可以看到服务是正常提供访问的，且熔断是关闭的。然后慢慢的一个一个的关闭 Movie 服务，当 Movie 服务全部关闭后，熔断被打开。再次恢复一个 Movie 服务，就会看到熔断又被关闭了，且服务在慢慢恢复。</p>
<p>服务正常</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjFdLG5O23PGeiOZxM2L9BJM6QOnb6AoMJxkI*dkudfrExkMzhrg8DFI9fg.AkQUVLQ!!/mnull&amp;bo=6AWAAjwHEAMDCWs!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p>服务熔断</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjMAksl66**oENFI765VJxrnUDYZYKrUqlcJdHYM2uuP1jgx2YHsSyz2R5j4mHcnYcA!!/mnull&amp;bo=FQaAAtAHNgMDCV8!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p><a href="https://github.com/rexyan/it_guigu/tree/master/SpringCloud/Code" target="_blank" rel="noopener">项目地址</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Java-大数据/" rel="tag"><i class="fa fa-tag"></i> Java 大数据</a>
              <a href="/tags/SpringCloud/" rel="tag"><i class="fa fa-tag"></i> SpringCloud</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/04/07/48. SpringBoot/" rel="prev" title="48. SpringBoot">
      <i class="fa fa-chevron-left"></i> 48. SpringBoot
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/04/12/50. 众筹项目 v2/" rel="next" title="50. 众筹项目 v2">
      50. 众筹项目 v2 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#相关概念"><span class="nav-number">1.</span> <span class="nav-text">相关概念</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SpringBoot-和-Spring-的关系"><span class="nav-number">1.1.</span> <span class="nav-text">SpringBoot 和 Spring 的关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-Cloud-和-SpringBoot-的关系"><span class="nav-number">1.2.</span> <span class="nav-text">Spring Cloud 和 SpringBoot 的关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#资料信息"><span class="nav-number">1.3.</span> <span class="nav-text">资料信息</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringCloud-案例开发"><span class="nav-number">2.</span> <span class="nav-text">SpringCloud 案例开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注册中心"><span class="nav-number">3.</span> <span class="nav-text">注册中心</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#概念"><span class="nav-number">3.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建注册中心"><span class="nav-number">3.2.</span> <span class="nav-text">创建注册中心</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建电影服务"><span class="nav-number">4.</span> <span class="nav-text">创建电影服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建用户服务"><span class="nav-number">5.</span> <span class="nav-text">创建用户服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#远程调用"><span class="nav-number">6.</span> <span class="nav-text">远程调用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RestTemplate"><span class="nav-number">6.1.</span> <span class="nav-text">RestTemplate</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#引入-Ribbon"><span class="nav-number">6.1.1.</span> <span class="nav-text">引入 Ribbon</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#容器注入-RestTemplate"><span class="nav-number">6.1.2.</span> <span class="nav-text">容器注入 RestTemplate</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#远程调用-1"><span class="nav-number">6.1.3.</span> <span class="nav-text">远程调用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#集成-Ribbon"><span class="nav-number">6.1.4.</span> <span class="nav-text">集成 Ribbon</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Feign"><span class="nav-number">6.2.</span> <span class="nav-text">Feign</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#创建项目"><span class="nav-number">6.2.1.</span> <span class="nav-text">创建项目</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#引入-Feign"><span class="nav-number">6.2.2.</span> <span class="nav-text">引入 Feign</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#启用-Feign"><span class="nav-number">6.2.3.</span> <span class="nav-text">启用 Feign</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#创建-Feign-远程调用接口"><span class="nav-number">6.2.4.</span> <span class="nav-text">创建 Feign 远程调用接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#实现调用"><span class="nav-number">6.2.5.</span> <span class="nav-text">实现调用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#集成-Ribbon-1"><span class="nav-number">6.2.6.</span> <span class="nav-text">集成 Ribbon</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#熔断"><span class="nav-number">7.</span> <span class="nav-text">熔断</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Hystrix-Ribbon"><span class="nav-number">7.1.</span> <span class="nav-text">Hystrix + Ribbon</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hystrix-Feign"><span class="nav-number">7.2.</span> <span class="nav-text">Hystrix + Feign</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hystrix-Dashboard"><span class="nav-number">7.3.</span> <span class="nav-text">Hystrix Dashboard</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Rex"
      src="https://raw.githubusercontent.com/rexyan/warehouse/master/20230809141242.jpg">
  <p class="site-author-name" itemprop="name">Rex</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">446</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">183</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa-hand-o-right"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rex</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
