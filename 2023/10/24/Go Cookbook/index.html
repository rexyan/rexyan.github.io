<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rexyan.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"top","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"buttons","active":null,"storage":true,"lazyload":true,"nav":{"disqus":{"text":"Load Disqus","order":-1}}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":3,"unescape":false,"preload":false},"motion":{"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Oreilly 上的  Go CookBook发布啦！内容比较基础，以下是阅读整理的笔记，和之前《100 Go Mistakes》，《Go 专家编程》结合起来看效果更佳！">
<meta property="og:type" content="article">
<meta property="og:title" content="Go CookBook">
<meta property="og:url" content="https://rexyan.github.io/2023/10/24/Go Cookbook/index.html">
<meta property="og:site_name" content="星尘">
<meta property="og:description" content="Oreilly 上的  Go CookBook发布啦！内容比较基础，以下是阅读整理的笔记，和之前《100 Go Mistakes》，《Go 专家编程》结合起来看效果更佳！">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://raw.githubusercontent.com/rexyan/warehouse/master/202310251011119.png">
<meta property="og:image" content="https://raw.githubusercontent.com/rexyan/warehouse/master/202310251021403.png">
<meta property="og:image" content="https://raw.githubusercontent.com/rexyan/warehouse/master/202310281606360.png">
<meta property="og:updated_time" content="2025-10-31T03:20:39.392Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Go CookBook">
<meta name="twitter:description" content="Oreilly 上的  Go CookBook发布啦！内容比较基础，以下是阅读整理的笔记，和之前《100 Go Mistakes》，《Go 专家编程》结合起来看效果更佳！">
<meta name="twitter:image" content="https://raw.githubusercontent.com/rexyan/warehouse/master/202310251011119.png">

<link rel="canonical" href="https://rexyan.github.io/2023/10/24/Go Cookbook/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Go CookBook | 星尘</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  
  <link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.6.0/lxgwwenkaiscreen.css" />
  <!-- 自定义为霞鹜文楷字体 -->
  <style>
	  body,div.post-body,h1,h2,h3,h4 {
		font-family: "LXGW WenKai Screen", sans-serif;
		font-size: 104%;
	  }
  </style>
  
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">星尘</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-读书">

    <a href="/books/" rel="section"><i class="address-book fa-fw"></i>读书</a>

  </li>
        <li class="menu-item menu-item-瞎扯">

    <a href="/crap/" rel="section"><i class="crap fa-fw"></i>瞎扯</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



<script src="https://cdn.jsdelivr.net/npm/echarts@4.8.0/dist/echarts.min.js"></script>

<meta name="referrer" content="never">




  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://rexyan.github.io/2023/10/24/Go Cookbook/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/rexyan/warehouse/master/20230809141242.jpg">
      <meta itemprop="name" content="Rex">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="星尘">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Go CookBook
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-10-24 23:04:57" itemprop="dateCreated datePublished" datetime="2023-10-24T23:04:57+00:00">2023-10-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-31 03:20:39" itemprop="dateModified" datetime="2025-10-31T03:20:39+00:00">2025-10-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Go/" itemprop="url" rel="index"><span itemprop="name">Go</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/阅读/" itemprop="url" rel="index"><span itemprop="name">阅读</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Oreilly 上的  <a href="https://www.oreilly.com/library/view/go-cookbook/9781098122102/" target="_blank" rel="noopener">Go CookBook</a>发布啦！内容比较基础，以下是阅读整理的笔记，和之前<a href="https://rexyan.github.io/2023/08/02/100%20Go%20Mistakes/">《100 Go Mistakes》</a>，<a href="https://rexyan.github.io/2023/03/12/%E3%80%8AGo%20%E4%B8%93%E5%AE%B6%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%94%E8%AE%B0/">《Go 专家编程》</a>结合起来看效果更佳！</p>
<a id="more"></a>
<h2 id="第一章-错误处理"><a href="#第一章-错误处理" class="headerlink" title="第一章: 错误处理"></a>第一章: 错误处理</h2><h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><p>Go 没有异常处理。它有错误，而不是异常。error 是一种内置类型，表示意外情况。你将创建一个错误并将其返回给调用函数，而不是抛出异常。</p>
<p>因此，对异常比较熟悉的人会发现 Go 中的错误处理特别繁琐。你不得不每次都检查返回的错误并单独处理，而不是在一系列语句中使用一张大网来捕捉异常。</p>
<p><strong>✅解决方法</strong></p>
<ol>
<li>如果您正在编写函数，请返回 error 以及返回值（如果有）。如果您调用的是函数，请检查返回的错误，如果不是 nil，请相应地处理错误。</li>
<li>按照惯例，错误是最后一个返回值。</li>
</ol>
<h3 id="简化重复性错误处理"><a href="#简化重复性错误处理" class="headerlink" title="简化重复性错误处理"></a>简化重复性错误处理</h3><p>以这段代码为例，它打开一个 JSON 文件进行读取并解码为一个结构体：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">unmarshal</span><span class="params">()</span> <span class="params">(person Person)</span></span> &#123;</span><br><span class="line">	r, err := http.Get(<span class="string">"https://swapi.dev/api/people/1"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">// handle error</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> r.Body.Close()</span><br><span class="line"></span><br><span class="line">	data, err := io.ReadAll(r.Body)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">// handle error</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err = json.Unmarshal(data, &amp;person)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">// handle error	</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到上述代码中有三处错误处理，分别是进行 HTTP 请求时候，读取 HTTP 响应的时候，以及反序列化的时候。这些错误处理非常相似，实际上是重复的。如何解决这个问题呢？</p>
<p><strong>✅解决方法</strong></p>
<p>解决方法就是添加辅助函数，可以自己实现，也可以使用自带的。</p>
<p>方法1: 自定义错误检查的 check 辅助函数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">helperUnmarshal</span><span class="params">()</span> <span class="params">(person Person)</span></span> &#123;</span><br><span class="line">	r, err := http.Get(<span class="string">"https://swapi.dev/api/people/1"</span>)</span><br><span class="line">  <span class="comment">// 将 err 和错误描述传递给 check</span></span><br><span class="line">	check(err, <span class="string">"Calling SW people API"</span>)</span><br><span class="line">	<span class="keyword">defer</span> r.Body.Close()</span><br><span class="line"></span><br><span class="line">	data, err := io.ReadAll(r.Body)</span><br><span class="line">  <span class="comment">// 将 err 和错误描述传递给 check</span></span><br><span class="line">	check(err, <span class="string">"Read JSON from response"</span>)</span><br><span class="line"></span><br><span class="line">	err = json.Unmarshal(data, &amp;person)</span><br><span class="line">  <span class="comment">// 将 err 和错误描述传递给 check</span></span><br><span class="line">	check(err, <span class="string">"Unmarshalling"</span>)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义 check 函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">(err error, msg <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Error encountered:"</span>, msg)</span><br><span class="line">        <span class="comment">// do common error handling stuff</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方法2: 创建一个类似于 template.Must 的 must 辅助函数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">must</span><span class="params">(param <span class="keyword">interface</span>&#123;&#125;, err error)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">// handle errors</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> param</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mustUnmarshal</span><span class="params">()</span> <span class="params">(person Person)</span></span> &#123;</span><br><span class="line">	r := must(http.Get(<span class="string">"https://swapi.dev/api/people/1"</span>)).(*http.Response)</span><br><span class="line">	<span class="keyword">defer</span> r.Body.Close()</span><br><span class="line">	data := must(io.ReadAll(r.Body)).([]<span class="keyword">byte</span>)</span><br><span class="line">	must(<span class="literal">nil</span>, json.Unmarshal(data, &amp;person))</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样的代码更加简洁，但同时也使代码更加难以阅读，因此应尽量少用这种辅助函数。</p>
<h3 id="创建自定义错误"><a href="#创建自定义错误" class="headerlink" title="创建自定义错误"></a>创建自定义错误</h3><p>我们可以使用 errors.New 函数（该函数仅使用简单字符串创建错误），也可以使用 fmt.Errorf 来进行错误的创建。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">err := errors.New(<span class="string">"Syntax error in the code"</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">err := fmt.Errorf(<span class="string">"Syntax error in the code at line %d"</span>, line)</span><br></pre></td></tr></table></figure>
<p>或者实现 error 接口。builtin 包包含内置类型、接口和函数的所有定义。其中一个接口是 error 接口。</p>
<p>任何结构体，只要有一个名为 Error 的方法返回字符串，就是错误。因此，如果您想定义自己的自定义错误以返回自定义错误信息，只需实现自己的结构并添加 Error 方法即可。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> CommsError <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m CommsError)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"An error happened during data transfer"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，自己实现的时候，通常不会只覆盖 Error，您可以在自定义错误中添加字段和其他方法，以携带更多信息。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SyntaxError <span class="keyword">struct</span> &#123;</span><br><span class="line">	Line <span class="keyword">int</span></span><br><span class="line">	Col  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现 Error 方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(err *SyntaxError)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">"Error at line %d, column %d"</span>, err.Line, err.Col)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当遇到自定义错误的时候，可以使用断言进行判断，然后进行处理</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="comment">// 使用断言进行判断是否是自定义错误</span></span><br><span class="line">	err, ok := err.(*SyntaxError)</span><br><span class="line">	<span class="keyword">if</span> ok &#123;</span><br><span class="line">		<span class="comment">// do something with the error</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// do something else</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Wrapping-错误"><a href="#Wrapping-错误" class="headerlink" title="Wrapping 错误"></a>Wrapping 错误</h3><p>在将错误作为另一个错误返回之前，您希望为收到的错误提供更多信息和上下文。这时我们就需要将错误进行包裹，然后再返回。</p>
<p><strong>✅解决方法</strong></p>
<p>最简单的是再次使用 fmt.Errorf，并将错误作为参数的一部分。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">err1 := errors.New(<span class="string">"Oops something happened."</span>)</span><br><span class="line">err2 := fmt.Errorf(<span class="string">"An error was encountered - %w"</span>, err1)</span><br></pre></td></tr></table></figure>
<p>%w  参数允许我们在格式字符串中放置错误。在上面的示例中，err2 封装了 err1。但我们如何从 err2 中提取 err1 呢？errors 软件包中有一个函数 Unwrap 可以实现这一功能。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">err := errors.Unwrap(err2)  <span class="comment">// 将返回 err1</span></span><br></pre></td></tr></table></figure>
<p>或者，创建类似这样的自定义错误结构：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ConnectionError <span class="keyword">struct</span> &#123;</span><br><span class="line">	Host <span class="keyword">string</span></span><br><span class="line">	Port <span class="keyword">int</span></span><br><span class="line">	Err  error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义错误，结构体需要有一个 Error 方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(err *ConnectionError)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">"Error connecting to %s at port %d"</span>, err.Host, err.Port)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现了一个 Unwrap 方法，将 ConnectionError 解包为以前的错误类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(err *ConnectionError)</span> <span class="title">Unwrap</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> err.Err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="错误检查"><a href="#错误检查" class="headerlink" title="错误检查"></a>错误检查</h3><p>当我们需要检查特定错误或特定类型的错误时，我们应该使用 <code>errors.Is</code> 和<code>errors.As</code> 函数。<code>errors.Is</code> 函数将错误与一个值进行比较，而 <code>errors.As</code> 函数则检查错误是否属于特定类型。</p>
<p><strong>errors.Is</strong></p>
<p>errors.Is 函数本质上是一个相等检查。假设在代码库中定义了一组自定义错误：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ApiErr error = errors.New(<span class="string">"Error trying to get data from API"</span>)</span><br></pre></td></tr></table></figure>
<p>在您代码的其他地方，有一个函数会返回这个错误。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">connectAPI</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> ApiErr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以使用 errors.Is 检查返回的错误是否真的是 ApiErr：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">err := connectAPI()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> errors.Is(err, ApiErr) &#123;</span><br><span class="line">		<span class="comment">// 判断错误是否为 ApiErr</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还可以验证 ApiErr 是否位于错误链的某处。让我们以 connect 函数为例，该函数返回一个 ConnectionError，ConnectionError Wrapping 了 ApiErr，此时我们再次使用 errors.Is(err, ApiErr) 来判断一次，也是返回 True。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">connect</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;ConnectionError&#123;</span><br><span class="line">		Host: <span class="string">"localhost"</span>,</span><br><span class="line">		Port: <span class="number">8080</span>,</span><br><span class="line">		Err:  ApiErr,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">err := connect()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> errors.Is(err, ApiErr) &#123;  <span class="comment">// 这里依然是返回 True</span></span><br><span class="line">		<span class="comment">// 匹配到错误</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>errors.As</strong></p>
<p>errors.As 函数允许我们检查特定类型的错误。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">err := connect()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> connErr *ConnectionError</span><br><span class="line">  <span class="comment">// 判断错误链中是否含有 ConnectionError，如果有，则将 err 转换为 ConnectionError，并赋值给 connErr</span></span><br><span class="line">  <span class="keyword">if</span> errors.As(err, &amp;connErr) &#123;</span><br><span class="line">    fmt.Println(<span class="string">"是 ConnectionError 错误类型"</span>)</span><br><span class="line">    log.Errorf(<span class="string">"Cannot connect to host %s at port %d"</span>, connErr.Host, connErr.Port)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总结：errors.Is 用户判断 error 链中是否包含指定的 error 值。errors.As 用户判断 error 链中是否有指定类型出现，如果有，则把 error 转换成该类型。更多示例，可见<a href="https://rexyan.github.io/2023/03/12/%E3%80%8AGo%20%E4%B8%93%E5%AE%B6%E7%BC%96%E7%A8%8B%E3%80%8B%E7%AC%94%E8%AE%B0/">《Go 专家编程》</a></p>
<h3 id="panic"><a href="#panic" class="headerlink" title="panic"></a>panic</h3><p>创建了一个正常的函数，其中main调用A，A调用B，B调用C。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">A</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">"defer on A"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"A"</span>)</span><br><span class="line">	B()</span><br><span class="line">	fmt.Println(<span class="string">"end of A"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">B</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">"defer on B"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"B"</span>)</span><br><span class="line">	C()</span><br><span class="line">	fmt.Println(<span class="string">"end of B"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">C</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">"defer on C"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"C"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"end of C"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">"defer on main"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"main"</span>)</span><br><span class="line">	A()</span><br><span class="line">	fmt.Println(<span class="string">"end of main"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正常执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">main</span><br><span class="line">A</span><br><span class="line">B</span><br><span class="line">C</span><br><span class="line">end of C</span><br><span class="line">defer on C</span><br><span class="line">end of B</span><br><span class="line">defer on B</span><br><span class="line">end of A</span><br><span class="line">defer on A</span><br><span class="line">end of main</span><br><span class="line">defer on main</span><br></pre></td></tr></table></figure>
<p>假如我们在 C 函数的两个 fmt.Println 之间添加 panic，如下所示：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">C</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">"defer on C"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"C"</span>)</span><br><span class="line">	<span class="built_in">panic</span>(<span class="string">"panic called in C"</span>) </span><br><span class="line">	fmt.Println(<span class="string">"end of C"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>C 会立即停止并在其作用域内执行延迟代码。之后，它冒泡到调用者 B，后者也立即停止并在其作用域内执行延迟代码，然后返回到其调用者 A。同样的情况也会发生在 A 上，它会冒泡到 main 函数，在其作用域内执行延迟代码。由于这是链的末端，因此它将打印出 panic 参数。</p>
<p>输出结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">main</span><br><span class="line">A</span><br><span class="line">B</span><br><span class="line">C</span><br><span class="line">defer on C</span><br><span class="line">defer on B</span><br><span class="line">defer on A</span><br><span class="line">defer on main</span><br><span class="line">panic: panic called in C</span><br></pre></td></tr></table></figure>
<h3 id="recover-panic"><a href="#recover-panic" class="headerlink" title="recover panic"></a>recover panic</h3><p>recover 只有在 defer 中使用时才能工作。这是因为当函数调用 panic 时，除了延迟代码外，其他所有代码都将停止工作。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">A</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">"defer on A"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"A"</span>)</span><br><span class="line">	B()</span><br><span class="line">	fmt.Println(<span class="string">"end of A"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">B</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> dontPanic()            <span class="comment">// defer 调用 dontPanic</span></span><br><span class="line">	fmt.Println(<span class="string">"B"</span>)</span><br><span class="line">	C()</span><br><span class="line">	fmt.Println(<span class="string">"end of B"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">C</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">"defer on C"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"C"</span>)</span><br><span class="line">  <span class="built_in">panic</span>(<span class="string">"panic called in C"</span>)   <span class="comment">// 引发 panic</span></span><br><span class="line">	fmt.Println(<span class="string">"end of C"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">"defer on main"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"main"</span>)</span><br><span class="line">	A()</span><br><span class="line">	fmt.Println(<span class="string">"end of main"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dontPanic</span><span class="params">()</span></span> &#123;</span><br><span class="line">	err := <span class="built_in">recover</span>()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"panic called but everything's ok now:"</span>, err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"defer on B"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">main</span><br><span class="line">A</span><br><span class="line">B</span><br><span class="line">C</span><br><span class="line">defer on C</span><br><span class="line">panic called but everything&apos;s ok now: panic called in C</span><br><span class="line">end of A</span><br><span class="line">defer on A</span><br><span class="line">end of main</span><br><span class="line">defer on main</span><br></pre></td></tr></table></figure></p>
<p>当 panic 在 C 中被调用时，C 中的延迟代码会启动，而不运行 C 中的其他代码，并冒泡至 B。B 停止运行其余代码，开始运行延迟代码，并调用 dontPanic。dontPanic 调用 recover， recover 返回传递给 panic 中的参数，然后运行恢复代码。</p>
<p>可见看到，在上述流程中，B 没有正常执行完成，但当 B 返回到 A 时，一切正常，代码的正常执行流程继续进行。</p>
<h3 id="处理中断"><a href="#处理中断" class="headerlink" title="处理中断"></a>处理中断</h3><p>从操作系统接收到一个中断信号（例如，用户按下ctrl-c），您希望进行清理并优雅地退出。正确方法是使用os/signal 包，使用 goroutine 监视中断。将清理代码放在 goroutine 中。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"os/signal"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建了一个无缓冲的通道 ch</span></span><br><span class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> os.Signal)</span><br><span class="line">	<span class="comment">// signal.Notify 函数将 ch 注册为接收 os.Interrupt 信号的通道。</span></span><br><span class="line">	signal.Notify(ch, os.Interrupt)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 使用 &lt;-ch 语法从 ch 通道接收信号。当接收到信号时，我们执行一些清理操作</span></span><br><span class="line">	<span class="comment">// 然后调用 os.Exit(0) 来优雅地退出程序。</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		&lt;-ch</span><br><span class="line">		fmt.Print(<span class="string">"接收到终止信号～"</span>)</span><br><span class="line">		os.Exit(<span class="number">0</span>)</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	time.Sleep(time.Second * <span class="number">10</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第二章-字符串"><a href="#第二章-字符串" class="headerlink" title="第二章: 字符串"></a>第二章: 字符串</h2><h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><ol>
<li>string 是字节的只读（不可变）片段。它可以是任何字节，不需要任何编码或格式。这与其他编程语言不同，在其他编程语言中，字符串是字符序列。</li>
<li>一个字符可以由多个字节表示。这符合 Unicode 标准，该标准定义了一个编码点来表示编码空间中的一个值。在这种情况下，一个字符可以用多个码位来表示。</li>
<li>在 Go 语言中，码位也被称为符文，符文是 int32 类型的别名，就像字节是 uint8 类型的别名一样。</li>
</ol>
<p>更多信息，可参考 <a href="https://rexyan.github.io/2023/08/02/100%20Go%20Mistakes/">100 Go Mistakes</a></p>
<h3 id="字符串和字节的转换"><a href="#字符串和字节的转换" class="headerlink" title="字符串和字节的转换"></a>字符串和字节的转换</h3><p>字符串是字节的片段，因此可以通过类型转换直接将字符串转换为字节数组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str := &quot;This is a simple string&quot;</span><br><span class="line">bytes := []byte(str)</span><br></pre></td></tr></table></figure>
<p>将字节数组转换为字符串也是通过类型转换完成的。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bytes := []<span class="keyword">byte</span>&#123;<span class="number">84</span>, <span class="number">104</span>, <span class="number">105</span>, <span class="number">115</span>, <span class="number">32</span>, <span class="number">105</span>, <span class="number">115</span>, <span class="number">32</span>, <span class="number">97</span>, <span class="number">32</span>, <span class="number">115</span>, <span class="number">105</span>, <span class="number">109</span>, <span class="number">112</span>, <span class="number">108</span>,</span><br><span class="line">                <span class="number">101</span>, <span class="number">32</span>, <span class="number">115</span>, <span class="number">116</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>&#125;</span><br><span class="line">str := <span class="keyword">string</span>(bytes)</span><br></pre></td></tr></table></figure>
<h3 id="其他方式创建字符串"><a href="#其他方式创建字符串" class="headerlink" title="其他方式创建字符串"></a>其他方式创建字符串</h3><p>方式1: 直接使用 + 进行拼接</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str <span class="keyword">string</span> = <span class="string">"The time is "</span> + time.Now().Format(time.Kitchen) + <span class="string">" now."</span></span><br></pre></td></tr></table></figure>
<p>方式2: 使用 string 软件包中的 Join 函数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str <span class="keyword">string</span> = strings.Join([]<span class="keyword">string</span>&#123;<span class="string">"The time is"</span>, time.Now().Format(time.Kitchen), <span class="string">"now."</span>&#125;, <span class="string">" "</span>)  <span class="comment">// 最后一个参数是拼接符</span></span><br></pre></td></tr></table></figure>
<p>方式3: 使用 fmt.Sprint</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str <span class="keyword">string</span> = fmt.Sprint(<span class="string">"The time is "</span>, time.Now(), <span class="string">" now."</span>)</span><br></pre></td></tr></table></figure>
<p>fmt.Sprint 及其变体使用 interface{} 参数，这意味着它可以使用任何数据类型。</p>
<p>fmt.Sprint 的一个常用变体 fmt.Sprintf，第一个参数是格式字符串，可以在字符串的不同位置放置不同的动词格式，第二个参数是可以替换到动词中的数据值。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str <span class="keyword">string</span> = fmt.Sprintf(<span class="string">"The time is %v now."</span>, time.Now())</span><br></pre></td></tr></table></figure>
<p>方式4: 使用 strings.Builder</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder strings.Builder</span><br><span class="line">builder.WriteString(<span class="string">"The time is "</span>)</span><br><span class="line">builder.WriteString(time.Now().Format(time.Kitchen))</span><br><span class="line">builder.WriteString(<span class="string">" now."</span>)</span><br><span class="line"><span class="keyword">var</span> str <span class="keyword">string</span> = builder.String()</span><br></pre></td></tr></table></figure>
<h3 id="字符串转换为数字"><a href="#字符串转换为数字" class="headerlink" title="字符串转换为数字"></a>字符串转换为数字</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">i, err := strconv.Atoi(<span class="string">"123"</span>) </span><br><span class="line"><span class="comment">// 等价于 ParseInt("123", 10, 0)</span></span><br></pre></td></tr></table></figure>
<p>ParseFloat 函数将字符串解析为浮点数。32 表示 float32，64 表示 float64 </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f, err := strconv.ParseFloat(<span class="string">"1.234"</span>, <span class="number">64</span>)</span><br></pre></td></tr></table></figure>
<p>ParseBool 在解析表示布尔值的字符串时非常有用。它接受 1、t、T、TRUE、true、True、0、f、F、FALSE、false、False。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b, err := strconv.ParseBool(<span class="string">"TRUE"</span>)</span><br></pre></td></tr></table></figure>
<p>当转换出错时，可以获取到相关的错误信息</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">str := <span class="string">"Not a number"</span></span><br><span class="line">_, err := strconv.Atoi(str)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    e := err.(*strconv.NumError)</span><br><span class="line">    fmt.Println(<span class="string">"Func:"</span>, e.Func)</span><br><span class="line">    fmt.Println(<span class="string">"Num:"</span>, e.Num)</span><br><span class="line">    fmt.Println(<span class="string">"Err:"</span>, e.Err)</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Func: Atoi</span><br><span class="line">Num: Not a number</span><br><span class="line">Err: invalid syntax</span><br><span class="line">strconv.Atoi: parsing &quot;Not a number&quot;: invalid syntax</span><br></pre></td></tr></table></figure>
<h3 id="数字转换为字符串"><a href="#数字转换为字符串" class="headerlink" title="数字转换为字符串"></a>数字转换为字符串</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str := strconv.Itoa(<span class="number">123</span>) </span><br><span class="line"><span class="comment">// 等价于 FormatInt(int64(123), 10)</span></span><br></pre></td></tr></table></figure>
<p>上述代码等价于 </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str := strconv.FormatInt(<span class="keyword">int64</span>(<span class="number">123</span>), <span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<p>第二个参数 10 代表十进制，我们换为 2 试试</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str := strconv.FormatInt(<span class="keyword">int64</span>(<span class="number">123</span>), <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>结果为  “1111011”。即将十进制的 123 转换为了二进制，并且是字符串格式。</p>
<p>FormatFloat 函数比 FormatInt 复杂一些。它根据格式和精度将浮点数转换为字符串</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v <span class="keyword">float64</span> = <span class="number">123456.123456</span></span><br><span class="line"><span class="keyword">var</span> s <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">s = strconv.FormatFloat(v, <span class="string">'f'</span>, <span class="number">-1</span>, <span class="number">64</span>)</span><br><span class="line">fmt.Println(<span class="string">"f (prec=-1)\t:"</span>, s)</span><br><span class="line">s = strconv.FormatFloat(v, <span class="string">'f'</span>, <span class="number">4</span>, <span class="number">64</span>)</span><br><span class="line">fmt.Println(<span class="string">"f (prec=4)\t:"</span>, s)</span><br><span class="line">s = strconv.FormatFloat(v, <span class="string">'f'</span>, <span class="number">9</span>, <span class="number">64</span>)</span><br><span class="line">fmt.Println(<span class="string">"f (prec=9)\t:"</span>, s)</span><br><span class="line"></span><br><span class="line">s = strconv.FormatFloat(v, <span class="string">'e'</span>, <span class="number">-1</span>, <span class="number">64</span>)</span><br><span class="line">fmt.Println(<span class="string">"\ne (prec=-1)\t:"</span>, s)</span><br><span class="line">s = strconv.FormatFloat(v, <span class="string">'E'</span>, <span class="number">-1</span>, <span class="number">64</span>)</span><br><span class="line">fmt.Println(<span class="string">"E (prec=-1)\t:"</span>, s)</span><br><span class="line">s = strconv.FormatFloat(v, <span class="string">'e'</span>, <span class="number">4</span>, <span class="number">64</span>)</span><br><span class="line">fmt.Println(<span class="string">"e (prec=4)\t:"</span>, s)</span><br><span class="line">s = strconv.FormatFloat(v, <span class="string">'e'</span>, <span class="number">9</span>, <span class="number">64</span>)</span><br><span class="line">fmt.Println(<span class="string">"e (prec=9)\t:"</span>, s)</span><br><span class="line"></span><br><span class="line">s = strconv.FormatFloat(v, <span class="string">'g'</span>, <span class="number">-1</span>, <span class="number">64</span>)</span><br><span class="line">fmt.Println(<span class="string">"\ng (prec=-1)\t:"</span>, s)</span><br><span class="line">s = strconv.FormatFloat(v, <span class="string">'G'</span>, <span class="number">-1</span>, <span class="number">64</span>)</span><br><span class="line">fmt.Println(<span class="string">"G (prec=-1)\t:"</span>, s)</span><br><span class="line">s = strconv.FormatFloat(v, <span class="string">'g'</span>, <span class="number">4</span>, <span class="number">64</span>)</span><br><span class="line">fmt.Println(<span class="string">"g (prec=4)\t:"</span>, s)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">f (prec=-1)	: 123456.123456</span><br><span class="line">f (prec=4)	: 123456.1235</span><br><span class="line">f (prec=9)	: 123456.123456000</span><br><span class="line"></span><br><span class="line">e (prec=-1)	: 1.23456123456e+05</span><br><span class="line">E (prec=-1)	: 1.23456123456E+05</span><br><span class="line">e (prec=4)	: 1.2346e+05</span><br><span class="line">e (prec=9)	: 1.234561235e+05</span><br><span class="line"></span><br><span class="line">g (prec=-1)	: 123456.123456</span><br><span class="line">G (prec=-1)	: 123456.123456</span><br><span class="line">g (prec=4)	: 1.235e+05</span><br></pre></td></tr></table></figure>
<p>FormatFloat 的函数签名如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FormatFloat</span><span class="params">(f <span class="keyword">float64</span>, fmt <span class="keyword">byte</span>, prec, bitSize <span class="keyword">int</span>)</span> <span class="title">string</span></span></span><br></pre></td></tr></table></figure>
<p>参数的含义如下：</p>
<ul>
<li><code>f</code>：要转换的浮点数。</li>
<li><code>fmt</code>：格式控制字符，用于指定转换的格式。常用的格式字符有 <code>&#39;f&#39;</code>（普通浮点数格式）和 <code>&#39;e&#39;</code>（科学计数法格式）。</li>
<li><code>prec</code>：精度，表示转换后的浮点数保留的小数位数。</li>
<li><code>bitSize</code>：浮点数的位大小，表示转换的浮点数是 <code>float32</code> 还是 <code>float64</code>。常用的值为 <code>32</code> 和 <code>64</code>。</li>
</ul>
<h3 id="替换字符串中的字符"><a href="#替换字符串中的字符" class="headerlink" title="替换字符串中的字符"></a>替换字符串中的字符</h3><p>可以使用 strings.Replace 函数或 strings.ReplaceAll 函数替换选定的字符串。</p>
<p>还可以使用 strings.Replacer 类型创建替换器。</p>
<p><strong>Replace &amp;&amp; ReplaceAll</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> quote <span class="keyword">string</span> = <span class="string">`I loved her against reason, against promise, against peace, against hope, against happiness, against all discouragement that could be.`</span></span><br><span class="line">	</span><br><span class="line">  <span class="comment">// 最后一次参数是替换的次数，如果 n 大于 0，则只替换前 n 个匹配的子串；</span></span><br><span class="line">  <span class="comment">// 如果 n 等于 0，则不进行替换；如果 n 小于 0，则替换所有匹配的子串。</span></span><br><span class="line">	replaced := strings.Replace(quote, <span class="string">"against"</span>, <span class="string">"with"</span>, <span class="number">1</span>)</span><br><span class="line">	fmt.Println(replaced)</span><br><span class="line"></span><br><span class="line">	replaced2 := strings.Replace(quote, <span class="string">"against"</span>, <span class="string">"with"</span>, <span class="number">2</span>)</span><br><span class="line">	fmt.Println(<span class="string">"\n"</span>, replaced2)</span><br><span class="line"></span><br><span class="line">	replacedAll := strings.Replace(quote, <span class="string">"against"</span>, <span class="string">"with"</span>, <span class="number">-1</span>)</span><br><span class="line">	fmt.Println(<span class="string">"\n"</span>, replacedAll)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后一次参数是替换的次数，如果 n 大于 0，则只替换前 n 个匹配的子串，如果 n 等于 0，则不进行替换；如果 n 小于 0，则替换所有匹配的子串。</p>
<p>ReplaceAll 相当于 Replace 将最后一个参数设置为 -1，即替换所有匹配的子串。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">replacedAll2 := strings.ReplaceAll(quote, <span class="string">"against"</span>, <span class="string">"with"</span>)</span><br><span class="line">fmt.Println(<span class="string">"\n"</span>, replacedAll2)</span><br></pre></td></tr></table></figure>
<p><strong>Replacer</strong></p>
<p>Replacer 可让您同时进行多个替换。如果你需要进行大量替换，这就方便多了。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">replacer := strings.NewReplacer(<span class="string">"her"</span>, <span class="string">"him"</span>, <span class="string">"against"</span>, <span class="string">"for"</span>, <span class="string">"all"</span>, <span class="string">"some"</span>)</span><br><span class="line">replaced3 := replacer.Replace(quote)</span><br><span class="line">fmt.Println(replaced3)</span><br></pre></td></tr></table></figure>
<p>在上面的代码中，我们用 “him “替换了 “her”，用 “for “替换了 “against”，用 “some “替换了 “all”。</p>
<p>总结：如果是简单的替换，那么使用 Replace 更方便，如果是进行大量替换，或替换的字符比较多，那么使用 Replacer 则效率更高。</p>
<h3 id="创建子串"><a href="#创建子串" class="headerlink" title="创建子串"></a>创建子串</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> quote <span class="keyword">string</span> = <span class="string">`I loved her against reason, against promise,</span></span><br><span class="line"><span class="string">against peace, against hope, against happiness,</span></span><br><span class="line"><span class="string">against all discouragement that could be.`</span></span><br></pre></td></tr></table></figure>
<p>如果你想从引文中提取 “against reason” 这几个字，你可以这样做。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quote[<span class="number">12</span>:<span class="number">26</span>]</span><br></pre></td></tr></table></figure>
<p>如何在不手动计算引号中字母的情况下知道单词的位置呢？</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i := strings.Index(quote, <span class="string">"against reason"</span>)  <span class="comment">// 可以使用 Index 获取子串索引的起始位置</span></span><br><span class="line">j := i + <span class="built_in">len</span>(<span class="string">"against reason"</span>)  <span class="comment">// 起始位置 + 长度 = 终止位置</span></span><br><span class="line">fmt.Println(quote[i:j])</span><br></pre></td></tr></table></figure>
<h3 id="字符串是否包含子串"><a href="#字符串是否包含子串" class="headerlink" title="字符串是否包含子串"></a>字符串是否包含子串</h3><p>可以使用 strings 包中的 Contains 函数。如果要检查的字符串是后缀或前缀，也可以使用 HasSuffix 或 HasPrefix 函数。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> quote <span class="keyword">string</span> = <span class="string">`I loved her against reason, against promise,</span></span><br><span class="line"><span class="string">against peace, against hope, against happiness,</span></span><br><span class="line"><span class="string">against all discouragement that could be.`</span></span><br></pre></td></tr></table></figure>
<p>检查是否包含  against</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> has <span class="keyword">bool</span> = strings.Contains(quote, <span class="string">"against"</span>)</span><br></pre></td></tr></table></figure>
<p>或者，也可以使用 strings.Index，如果返回结果 &lt; 0，则表示在字符串中没有找到子串。或者使用 Count 函数，它返回在字符串中找到子串的次数，但这通常是一个较差的替代方法。</p>
<p>如果想知道子串是否是字符串的前缀，可以使用 HasPrefix 函数。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings.HasPrefix(quote, <span class="string">"I loved"</span>)</span><br></pre></td></tr></table></figure>
<p>同理，可以使用 HasSuffix 函数对后缀进行同样的处理</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings.HasSuffix(quote, <span class="string">"could be."</span>)</span><br></pre></td></tr></table></figure>
<h3 id="切分字符串为数组"><a href="#切分字符串为数组" class="headerlink" title="切分字符串为数组"></a>切分字符串为数组</h3><p><strong>strings.Split</strong></p>
<p>使用 Split 包中的 strings 函数可以分割字符串。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> quote <span class="keyword">string</span> = <span class="string">`I loved her against reason, against promise,</span></span><br><span class="line"><span class="string">against peace, against hope, against happiness,</span></span><br><span class="line"><span class="string">against all discouragement that could be.`</span></span><br><span class="line"></span><br><span class="line">array := strings.Split(quote, <span class="string">" "</span>)</span><br></pre></td></tr></table></figure>
<p>上述的分割方法中，我们使用空格作为分隔符，但是存在一些问题，结果里面带有一些换行符。这是因为原始字符串带有换行符。这可能不是你想要的，那么我们如何才能删除换行符呢？更糟糕的是，如果有多个空格，你的数组看起来就会非常凌乱，会有很多额外的空字符串元素。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[&quot;I&quot; &quot;loved&quot; &quot;her&quot; &quot;against&quot; &quot;reason,&quot; &quot;against&quot; &quot;promise,&quot; &quot;\nagainst&quot; &quot;peace,&quot;</span><br><span class="line">&quot;against&quot; &quot;hope,&quot; &quot;against&quot; &quot;happiness,&quot; &quot;\nagainst&quot; &quot;all&quot; &quot;discouragement&quot; &quot;that&quot;</span><br><span class="line">&quot;could&quot; &quot;be.&quot;]</span><br></pre></td></tr></table></figure>
<p><strong>strings.Fields</strong></p>
<p>这时，我们可以使用 strings.Fields 来进行处理。strings.Fields 是一个专门用于将字符串按照空白字符（包括空格、制表符和换行符等）进行分割的函数。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array := strings.Fields(quote)</span><br></pre></td></tr></table></figure>
<p>切分结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[&quot;I&quot; &quot;loved&quot; &quot;her&quot; &quot;against&quot; &quot;reason,&quot; &quot;against&quot; &quot;promise,&quot; &quot;against&quot; &quot;peace,&quot;</span><br><span class="line">&quot;against&quot; &quot;hope,&quot; &quot;against&quot; &quot;happiness,&quot; &quot;against&quot; &quot;all&quot; &quot;discouragement&quot; &quot;that&quot;</span><br><span class="line">&quot;could&quot; &quot;be.&quot;]</span><br></pre></td></tr></table></figure>
<p><strong>strings.FieldsFunc</strong></p>
<p>其中还是含有逗号和最后的句号，如果要根据 “,” 和空格进行拆分的话，可以自定义实现 strings.FieldsFunc 函数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">f := <span class="function"><span class="keyword">func</span><span class="params">(c <span class="keyword">rune</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="comment">// IsPunct 判断是否为标点符号。</span></span><br><span class="line">    <span class="comment">// IsLetter 判断是否为字母</span></span><br><span class="line">    <span class="comment">// 这段判断的逻辑是就是，如果是标点符号或者非字母，那么就返回 True。那么就进行字符串的拆分。</span></span><br><span class="line">    <span class="keyword">return</span> unicode.IsPunct(c) || !unicode.IsLetter(c)</span><br><span class="line">&#125;</span><br><span class="line">array := strings.FieldsFunc(quote, f)</span><br><span class="line">fmt.Printf(<span class="string">"%q"</span>, array)</span><br></pre></td></tr></table></figure>
<p>切分结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[&quot;I&quot; &quot;loved&quot; &quot;her&quot; &quot;against&quot; &quot;reason&quot; &quot;against&quot; &quot;promise&quot; &quot;against&quot; &quot;peace&quot;</span><br><span class="line">&quot;against&quot; &quot;hope&quot; &quot;against&quot; &quot;happiness&quot; &quot;against&quot; &quot;all&quot; &quot;discouragement&quot; &quot;that&quot;</span><br><span class="line">&quot;could&quot; &quot;be&quot;]</span><br></pre></td></tr></table></figure>
<p><strong>strings.SplitN</strong></p>
<p>如果我们只想分割前 9 个元素的字符串，并将其余元素放入单个字符串中，我们则可以使用 SplitN 函数。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">array := strings.SplitN(quote, <span class="string">" "</span>, <span class="number">10</span>)</span><br><span class="line">fmt.Printf(<span class="string">"%q"</span>, array)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[&quot;I&quot; &quot;loved&quot; &quot;her&quot; &quot;against&quot; &quot;reason,&quot; &quot;against&quot; &quot;promise,&quot; &quot;\nagainst&quot; &quot;peace,&quot;</span><br><span class="line">&quot;against hope, against happiness, \nagainst all discouragement that could be.&quot;]</span><br></pre></td></tr></table></figure>
<p>即，切分的结果只有10个元素。</p>
<p><strong>strings.SplitAfter</strong></p>
<p>希望在分割字符串后保留分隔符。Go 有一个名为 SplitAfter 的函数可以做到这一点。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">array := strings.SplitAfter(quote, <span class="string">" "</span>)</span><br><span class="line">fmt.Printf(<span class="string">"%q"</span>, array)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[&quot;I &quot; &quot;loved &quot; &quot;her &quot; &quot;against &quot; &quot;reason, &quot; &quot;against &quot; &quot;promise, &quot; &quot;\nagainst &quot;</span><br><span class="line">&quot;peace, &quot; &quot;against &quot; &quot;hope, &quot; &quot;against &quot; &quot;happiness, &quot; &quot;\nagainst &quot; &quot;all &quot;</span><br><span class="line">&quot;discouragement &quot; &quot;that &quot; &quot;could &quot; &quot;be.&quot;]</span><br></pre></td></tr></table></figure>
<h3 id="Trimming-strings"><a href="#Trimming-strings" class="headerlink" title="Trimming strings"></a>Trimming strings</h3><p><strong>Trim</strong></p>
<p>Trim 函数接收一个字符串和一个 cutset（由一个或多个 Unicode 代码点组成的字符串），然后返回一个去掉所有前导和尾部代码点的字符串。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str <span class="keyword">string</span> = <span class="string">", and that is all."</span></span><br><span class="line"><span class="keyword">var</span> cutset <span class="keyword">string</span> = <span class="string">",. "</span></span><br><span class="line">trimmed := strings.Trim(str, cutset)  <span class="comment">// 删除前面和后面中含有的,.空格</span></span><br><span class="line"><span class="comment">//and that is all</span></span><br></pre></td></tr></table></figure>
<p><strong>TrimRight/TrimLeft</strong></p>
<p>Trim 函数同时删除尾部字符和前导字符，但如果只想删除尾部字符，可以使用 TrimRight 函数，如果只想删除前导字符，可以使用 TrimLeft 函数。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str <span class="keyword">string</span> = <span class="string">", and that is all."</span></span><br><span class="line"><span class="keyword">var</span> cutset <span class="keyword">string</span> = <span class="string">",. "</span></span><br><span class="line">trimmedLeft := strings.TrimLeft(str, cutset)   <span class="comment">//and that is all.</span></span><br><span class="line">trimmedRight := strings.TrimRight(str, cutset) <span class="comment">//, and that is all</span></span><br></pre></td></tr></table></figure>
<p><strong>TrimPrefix/TrimSuffix</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str <span class="keyword">string</span> = <span class="string">", and that is all."</span></span><br><span class="line">trimmedPrefix := strings.TrimPrefix(str, <span class="string">", and "</span>)	<span class="comment">//that is all.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str <span class="keyword">string</span> = <span class="string">", and that is all."</span></span><br><span class="line">trimmedSuffix := strings.TrimSuffix(str, <span class="string">" all."</span>) <span class="comment">//, and that is</span></span><br></pre></td></tr></table></figure>
<p><strong>TrimSpace</strong></p>
<p>TrimSpace 可以简单地删除尾部和前部的空格，可以是换行符（\n）或制表符（\t）或回车符（\r）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trimmed := strings.TrimSpace(<span class="string">"\r\n\t Hello World \t\n\r"</span>)  <span class="comment">//Hello World</span></span><br></pre></td></tr></table></figure>
<p><strong>TrimFunc/TrimLeftFunc/TrimRightFunc</strong></p>
<p>如之前的 strings.FieldsFunc 一样，TrimFunc/TrimLeftFunc/TrimRightFunc 这三个函数支持传入自定义函数，根据返回值来确认是否删除字符。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f := <span class="function"><span class="keyword">func</span><span class="params">(c <span class="keyword">rune</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> unicode.IsPunct(c) || !unicode.IsLetter(c)</span><br><span class="line">&#125;</span><br><span class="line">trimmed := strings.TrimFunc(str, f) <span class="comment">//and that is all</span></span><br></pre></td></tr></table></figure>
<h3 id="从命令行接受输入"><a href="#从命令行接受输入" class="headerlink" title="从命令行接受输入"></a>从命令行接受输入</h3><p>使用 Scan 包中的 fmt 函数从标准输入读取单个字符串。</p>
<p>要读取由空格分隔的字符串，请在 Reader 包 os.Stdin 中使用 ReadString。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> input <span class="keyword">string</span></span><br><span class="line">	fmt.Print(<span class="string">"Please enter a word: "</span>)</span><br><span class="line">	n, err := fmt.Scan(&amp;input)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"error with user input:"</span>, err, n)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"You entered:"</span>, input)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/rexyan/warehouse/master/202310251011119.png" alt></p>
<p>但是这样有一个问题，那就是空格之后的输入会被截断。Scan 函数可以接收多个参数，每个参数代表一个用户输入，中间用空格隔开。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> input1, input2 <span class="keyword">string</span></span><br><span class="line">	fmt.Print(<span class="string">"Please enter two words: "</span>)</span><br><span class="line">	n, err := fmt.Scan(&amp;input1, &amp;input2)     <span class="comment">// 接收两个输入，中间使用空格进行分割</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"error with user input:"</span>, err, n)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"You entered:"</span>, input1, <span class="string">"and"</span>, input2)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这似乎有点局限。如果要捕获一个包含空格的字符串，该怎么办？这时我们可以创建一个 Reader，并使用 Reader 的 ReadString 方法<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	reader := bufio.NewReader(os.Stdin)         <span class="comment">// 创建一个 Reader 并绑定标准输入</span></span><br><span class="line">	fmt.Print(<span class="string">"请输入内容:"</span>)</span><br><span class="line">	readString, err := reader.ReadString(<span class="string">'\n'</span>)  <span class="comment">// 从 Reader 中读取输入的消息</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"输入错误:"</span>, err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"你的输入是: "</span>, readString)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/rexyan/warehouse/master/202310251021403.png" alt></p>
<h3 id="转义-HTML-字符串"><a href="#转义-HTML-字符串" class="headerlink" title="转义 HTML 字符串"></a>转义 HTML 字符串</h3><p>使用 html 包中的 EscapeString 和 UnescapeString 函数转义或取消转义 HTML 字符串。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str := <span class="string">"&lt;b&gt;Rock &amp; Roll&lt;/b&gt;"</span></span><br><span class="line">escaped := html.EscapeString(str)   <span class="comment">// 字符串转义</span></span><br><span class="line"><span class="comment">//"&amp;lt;b&amp;gt;Rock &amp;amp; Roll&amp;lt;/b&amp;gt;"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unescaped := html.UnescapeString(escaped)   <span class="comment">// 字符串取消转义</span></span><br><span class="line"><span class="comment">//"&lt;b&gt;Rock &amp; Roll&lt;/b&gt;"</span></span><br></pre></td></tr></table></figure>
<h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><p>使用 regex 包，并使用 Compile 函数解析正则表达式，返回一个 Regexp 结构，然后使用 Find 函数匹配模式并返回字符串。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> quote <span class="keyword">string</span> = <span class="string">`I loved her against reason, against promise,</span></span><br><span class="line"><span class="string">against peace, against hope, against happiness,</span></span><br><span class="line"><span class="string">against all discouragement that could be.`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Compile 还可以替换为 MustCompile，使用 MustCompile 时，正则表达式无法编译则会出错。</span></span><br><span class="line">re, err := regexp.Compile(<span class="string">`against [\w]+`</span>)   </span><br><span class="line"></span><br><span class="line">re.MatchString(quote)  <span class="comment">// true</span></span><br><span class="line">str := re.FindString(quote) <span class="comment">// "against reason"</span></span><br><span class="line">strs := re.FindAllString(quote, <span class="number">-1</span>)  <span class="comment">//第二个参数是返回匹配的数量，&lt;0 代表返回所有的匹配的内容</span></span><br><span class="line"></span><br><span class="line">locs := re.FindStringIndex(quote) <span class="comment">// 返回匹配字符串的位置，[12 26]</span></span><br><span class="line">quote[locs[<span class="number">0</span>]:locs[<span class="number">1</span>]] <span class="comment">// 使用上面的位置进行切片即可得到结果字符串，against reason</span></span><br><span class="line">allLocs := re.FindAllStringIndex(quote, <span class="number">-1</span>)  <span class="comment">// 同理使用第二个控制返回匹配的数量</span></span><br><span class="line"></span><br><span class="line">replaced = re.ReplaceAllStringFunc(quote, strings.ToUpper) <span class="comment">// 将所有匹配到的内容转换为大写</span></span><br><span class="line"></span><br><span class="line">f := <span class="function"><span class="keyword">func</span><span class="params">(in <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	split := strings.Split(in, <span class="string">" "</span>)</span><br><span class="line">	split[<span class="number">1</span>] = strings.ToUpper(split[<span class="number">1</span>])</span><br><span class="line">	<span class="keyword">return</span> strings.Join(split, <span class="string">" "</span>)</span><br><span class="line">&#125;</span><br><span class="line">replaced = re.ReplaceAllStringFunc(quote, f)  <span class="comment">// 将匹配到的内容的第二个单词转换为大写</span></span><br></pre></td></tr></table></figure>
<p>总结：在诸多匹配方法中</p>
<ol>
<li>不带 All 的函数只会返回第一个匹配项</li>
<li>带 All 的函数则有可能返回字符串中的所有匹配项，具体取决于第二个参数 n</li>
<li>带 String 的将返回字符串或字符串片段，而不带的将返回字节数组</li>
<li>带有 Index 的会返回匹配的索引</li>
</ol>
<h2 id="第三章：日志"><a href="#第三章：日志" class="headerlink" title="第三章：日志"></a>第三章：日志</h2><h3 id="写入日志"><a href="#写入日志" class="headerlink" title="写入日志"></a>写入日志</h3><p><strong>log.Println</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	str := <span class="string">"abcdefghi"</span></span><br><span class="line">	num, err := strconv.ParseInt(str, <span class="number">10</span>, <span class="number">64</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Cannot parse string:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">"Number is"</span>, num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">% go run main.go</span><br><span class="line">2022/01/23 18:39:06 Cannot parse string: strconv.ParseInt: parsing &quot;abcdefghi&quot;:</span><br><span class="line"> invalid syntax</span><br><span class="line">Number is 0</span><br></pre></td></tr></table></figure>
<p>打印日志后，程序并没有停止，而是继续执行到程序的最后语句。它与 fmt.Println 有什么不同？其实没有区别，它在行中添加的唯一内容就是日期。</p>
<p><strong>log.Fatalln</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	str := <span class="string">"abcdefghi"</span></span><br><span class="line">	num, err := strconv.ParseInt(str, <span class="number">10</span>, <span class="number">64</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(<span class="string">"Cannot parse string"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">"Number is"</span>, num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">% go run main.go</span><br><span class="line">2022/01/23 18:42:10 Cannot parse string strconv.ParseInt: parsing &quot;abcdefghi&quot;:</span><br><span class="line">invalid syntax</span><br><span class="line">exit status 1</span><br></pre></td></tr></table></figure>
<p>注意最后一条语句没有执行，程序以退出代码 1 结束。退出代码 1 是一般错误的总括，意思是程序出了问题，所以必须退出。</p>
<p><strong>log.Panicln</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"strconv"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	str := <span class="string">"abcdefghi"</span></span><br><span class="line">	num := conv(str)</span><br><span class="line">	fmt.Println(<span class="string">"Number is"</span>, num)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">conv</span><span class="params">(str <span class="keyword">string</span>)</span> <span class="params">(num <span class="keyword">int64</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">"deferred code in function conv"</span>)</span><br><span class="line">	num, err := strconv.ParseInt(str, <span class="number">10</span>, <span class="number">64</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Panicln(<span class="string">"Cannot parse string"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">"end of function conv"</span>)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2023/10/25 15:48:57 Cannot parse string strconv.ParseInt: parsing &quot;abcdefghi&quot;: invalid syntax</span><br><span class="line">deferred code in function conv</span><br><span class="line">panic: Cannot parse string strconv.ParseInt: parsing &quot;abcdefghi&quot;: invalid syntax</span><br></pre></td></tr></table></figure>
<h3 id="添加日志记录的字段"><a href="#添加日志记录的字段" class="headerlink" title="添加日志记录的字段"></a>添加日志记录的字段</h3><p>标准日志记录器的默认行为是在每行日志中添加日期和时间字段。但我们可以使用 SetFlags 函数为每行日志设置标志和添加字段。</p>
<p>可添加的字段有：Date（当地时区的日期），Time（当时时区的时间），Microseconds（微秒），UTC（如果设置了日期或者时间，则使用 UTC 时区而不是本地时区），Longfile（完整的文件名和行号），Shortfile（文件名和行号），Message prefix position（信息前缀位置）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">log.SetFlags(log.Ldate)</span><br><span class="line">log.Println(<span class="string">"Some event happened"</span>)</span><br><span class="line"><span class="comment">// 2022/01/24 Some event happened</span></span><br><span class="line"></span><br><span class="line">log.SetFlags(log.Ldate | log.Lmicroseconds)</span><br><span class="line">log.Println(<span class="string">"Some event happened"</span>)</span><br><span class="line"><span class="comment">// 2022/01/24 20:43:54.595365 Some event happened</span></span><br><span class="line"></span><br><span class="line">log.SetFlags(log.Ldate | log.Lshortfile)</span><br><span class="line">log.Println(<span class="string">"Some event happened"</span>)</span><br><span class="line"><span class="comment">// 2022/01/24 20:51:02 logging.go:20: Some event happened</span></span><br></pre></td></tr></table></figure>
<h3 id="将日志写入到文件"><a href="#将日志写入到文件" class="headerlink" title="将日志写入到文件"></a>将日志写入到文件</h3><p>使用 SetOutput 函数将日志设置为写入文件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// os.O_APPEND：追加写入，如果文件存在，写入操作将在文件末尾进行。</span></span><br><span class="line"><span class="comment">// os.O_CREATE：如果文件不存在，创建新文件。</span></span><br><span class="line"><span class="comment">// os.O_WRONLY：只写模式打开文件。</span></span><br><span class="line"><span class="comment">// 0644：文件权限位，指定新创建文件的权限。这里的 0644 表示文件所有者具有读写权限，其他用户只有读权限。</span></span><br><span class="line">file, err := os.OpenFile(<span class="string">"app.log"</span>, os.O_APPEND|os.O_CREATE|os.O_WRONLY, <span class="number">0644</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">log.SetOutput(file)</span><br><span class="line">log.Println(<span class="string">"Some event happened"</span>)</span><br></pre></td></tr></table></figure>
<p>同时将文件写入到文件和标准输出</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">file, err := os.OpenFile(<span class="string">"app.log"</span>, os.O_APPEND|os.O_CREATE|os.O_WRONLY, <span class="number">0644</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> file.Close()</span><br><span class="line">writer := io.MultiWriter(os.Stderr, file)     <span class="comment">// 创建一个写入器，可以向 Stderr 和文件中写入日志</span></span><br><span class="line">log.SetOutput(writer)</span><br><span class="line">log.Println(<span class="string">"Some event happened"</span>)</span><br><span class="line">log.Println(<span class="string">"Another event happened"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="设置日志级别"><a href="#设置日志级别" class="headerlink" title="设置日志级别"></a>设置日志级别</h3><p>解决方法是使用 New 函数创建一个日志记录器，这样就可以为每一个日志记录器设置日志级别。</p>
<p>日志级别从高到低：Fatal &gt; Error &gt; Warn &gt; Info &gt; Debug</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	info  *log.Logger</span><br><span class="line">	debug *log.Logger</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 设置日志等级</span></span><br><span class="line">	info = log.New(os.Stderr, <span class="string">"INFO\t"</span>, log.LstdFlags) <span class="comment">// LstdFlags = Ldate | Ltime</span></span><br><span class="line">	debug = log.New(os.Stderr, <span class="string">"DEBUG\t"</span>, log.LstdFlags)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	info.Println(<span class="string">"Some informational event happened"</span>)</span><br><span class="line">	debug.Println(<span class="string">"Some debugging event happened"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INFO	2022/01/26 00:53:03 Some informational event happened</span><br><span class="line">DEBUG	2022/01/26 00:53:03 Some debugging event happened</span><br></pre></td></tr></table></figure>
<p>在基于 Unix 的系统中，我们使用 grep 命令来查看特定日志等级的日志，例如有以下日志文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DEBUG	2023/01/06 00:21:32 Some debugging event happened</span><br><span class="line">INFO	2023/01/06 00:21:35 Another informational event happened</span><br><span class="line">WARN	2023/01/06 00:23:35 A warning event happened</span><br><span class="line">WARN	2023/01/06 00:33:11 Another warning event happened</span><br><span class="line">ERROR	2023/01/06 00:33:11 An error event happened</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep "^ERROR" logfile.log      // 只查看以 ERROR 开头的行</span><br><span class="line">grep -v "^DEBUG" logfile.log   // 查看除 Debug 之外的行</span><br></pre></td></tr></table></figure>
<h2 id="第四章：函数"><a href="#第四章：函数" class="headerlink" title="第四章：函数"></a>第四章：函数</h2><h3 id="函数接受多种数据类型"><a href="#函数接受多种数据类型" class="headerlink" title="函数接受多种数据类型"></a>函数接受多种数据类型</h3><p>我们可以使用泛型来定义一个可以接受多个类型参数的函数。</p>
<p>Go 使用一种称为类型参数的机制来实现泛型。</p>
<p>类型参数是<strong>定义在函数名和参数列表之间、方括号内的抽象数据类型。</strong></p>
<p>类型约束是类型参数必须满足的要求。</p>
<p>类型约束是一种特殊的接口。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类型参数为 T，类型约束为 int 和 float64 之间的联合</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span>[<span class="title">T</span> <span class="title">int</span> | <span class="title">float64</span>] <span class="params">(x T)</span> <span class="title">T</span></span> &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>甚至可以通过 | 操作符，创建一个类型结合体，从而创建一个同时允许 int 和 float64 类型的类型约束</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Number <span class="keyword">interface</span> &#123;</span><br><span class="line">    <span class="keyword">int</span> | <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Go 还在实验包下提供了一个名为 constraints 的包，其中提供了一些常用的类型约束接口。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Signed <span class="keyword">interface</span> &#123;</span><br><span class="line">    ~<span class="keyword">int</span> | ~<span class="keyword">int8</span> | ~<span class="keyword">int16</span> | ~<span class="keyword">int32</span> | ~<span class="keyword">int64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Ordered <span class="keyword">interface</span> &#123;</span><br><span class="line">    Integer | Float | ~<span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有了这些，我们可以重写上述示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"golang.org/x/exp/constraints"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Number <span class="keyword">interface</span> &#123;</span><br><span class="line">    constraints.Integer | constraints.Float</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddNumbers</span>[<span class="title">T</span> <span class="title">Number</span>]<span class="params">(a, b T)</span> <span class="title">T</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="接收不同数量的参数"><a href="#接收不同数量的参数" class="headerlink" title="接收不同数量的参数"></a>接收不同数量的参数</h3><p>可变参数是一种允许任意数量参数的函数:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">varFunc</span><span class="params">(str ...<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> _, s := <span class="keyword">range</span> str &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"%s "</span>, s)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以向函数传递零个或多个字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">varFunc(&quot;the&quot;, &quot;quick&quot;)</span><br><span class="line">varFunc(&quot;the&quot;, &quot;quick&quot;, &quot;brown&quot;, &quot;fox&quot;)</span><br><span class="line">varFunc()</span><br></pre></td></tr></table></figure>
<p>如果您已经有了一个切片，并希望将其传递给一个可变参数的函数，可以这样做：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str := []<span class="keyword">string</span>&#123;<span class="string">"the"</span>, <span class="string">"quick"</span>, <span class="string">"brown"</span>, <span class="string">"fox"</span>&#125;</span><br><span class="line">varFunc(str...)</span><br></pre></td></tr></table></figure>
<p>除了可变参数外，还可以有其他参数，不过，可变参数必须是列表中的最后一个参数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">varFunc2</span><span class="params">(i <span class="keyword">int</span>, str ...<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> _, s := <span class="keyword">range</span> str &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"%s "</span>, s)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="接收任何类型的数据"><a href="#接收任何类型的数据" class="headerlink" title="接收任何类型的数据"></a>接收任何类型的数据</h3><p>使用 any 类型约束或空接口 interface{}</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">anyFunc</span><span class="params">(a any)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"value is %v\n"</span>, a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以用不同的数据类型来调用函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">anyFuncReflect(&quot;hello world&quot;)</span><br><span class="line">anyFuncReflect(123)</span><br><span class="line">anyFuncReflect(123.456)</span><br><span class="line">anyFuncReflect(snowy)</span><br><span class="line">anyFuncReflect([]int&#123;1, 2, 3&#125;)</span><br></pre></td></tr></table></figure>
<p>但是有一点需要注意，因为参数是任何类型，所以函数一般不能做任何事情，换句话说，你需要知道参数是什么类型之后才能做具体的操作。</p>
<p>庆幸的是在 Go 中，reflect 软件包提供了两种方法来帮助您确定变量的类型。第一种是 reflect.TypeOf，它会告诉你变量的类型；第二种是 Kind，它会告诉你变量的种类。对于原始类型来说，这两个字符串是相同的。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">anyFuncReflect</span><span class="params">(a any)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"value is %v, type is %v, kind is %v\n"</span>, a, reflect.TypeOf(a),reflect.TypeOf(a).Kind())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>value is hello world, type is <strong>string</strong>, kind is <strong>string</strong><br>value is 123, type is <strong>int</strong>, kind is <strong>int</strong><br>value is 123.456, type is <strong>float64</strong>, kind is <strong>float64</strong><br>value is {Snowy 6 Fox Terrier}, type is <strong>functions.Dog</strong>, kind is <strong>struct</strong><br>value is [1 2 3], type is <strong>[]int</strong>, kind is <strong>slice</strong></p>
</blockquote>
<p>对于结构体，类型是结构体名称，种类是结构体。对于整数片段，类型是 []int，种类是 slice。</p>
<p>即使你现在知道了它是什么，但仍然无法使用它。这是因为从 Go 的角度来看，该参数仍然是 any。要使用参数 a，需要对其进行类型断言</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">anyFuncAssert</span><span class="params">(a any)</span></span> &#123;</span><br><span class="line">	dog, ok := a.(Dog)</span><br><span class="line">	<span class="keyword">if</span> ok &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"Name is %s, age is %d, breed is %s\n"</span>, dog.Name,dog.Age,dog.Breed)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"Not a dog"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在断言中可以使用逗号、ok 模式。该模式会返回一个布尔值（在一个通常名为 ok 的变量中）和断言的类型。如果断言正确，ok 将为真；反之，则为假。</p>
<h3 id="创建匿名函数"><a href="#创建匿名函数" class="headerlink" title="创建匿名函数"></a>创建匿名函数</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">anonFunc1</span><span class="params">()</span></span> &#123;</span><br><span class="line">	anon := <span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(c <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> a + b</span><br><span class="line">	&#125;</span><br><span class="line">  <span class="comment">// 类型是 func(int, int) 种类是 func</span></span><br><span class="line">	fmt.Println(<span class="string">"type is:"</span>, reflect.TypeOf(anon), <span class="string">"\nkind is:"</span>, reflect.TypeOf(anon).Kind())</span><br><span class="line">	fmt.Println(anon(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者直接将参数放在函数本身后面，直接调用函数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">anonFunc2</span><span class="params">()</span></span> &#123;</span><br><span class="line">	anon := <span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(c <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> a + b</span><br><span class="line">	&#125;(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">	fmt.Println(anon)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="调用后保持状态的函数"><a href="#调用后保持状态的函数" class="headerlink" title="调用后保持状态的函数"></a>调用后保持状态的函数</h3><p>如果想创建一个在执行结束后仍能保留其状态的函数，那么就应该使用闭包。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">outerFunc</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	count := <span class="number">0</span></span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">		count++</span><br><span class="line">		<span class="keyword">return</span> count</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">next := outerFunc()</span><br><span class="line">fmt.Println(next())</span><br><span class="line">fmt.Println(next())</span><br><span class="line">fmt.Println(next())</span><br><span class="line"></span><br><span class="line"><span class="comment">//1</span></span><br><span class="line"><span class="comment">//2</span></span><br><span class="line"><span class="comment">//3</span></span><br></pre></td></tr></table></figure>
<h2 id="输入输出"><a href="#输入输出" class="headerlink" title="输入输出"></a>输入输出</h2><h3 id="从输入端读取数据"><a href="#从输入端读取数据" class="headerlink" title="从输入端读取数据"></a>从输入端读取数据</h3><p>可以使用 io.Reader 界面读取输入信息</p>
<p>Go 使用 io.Reader 接口来表示从输入数据流中读取数据的能力。任何实现了 Read 函数的结构体都是 Reader。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Reader <span class="keyword">interface</span> &#123;</span><br><span class="line">	Read(p []<span class="keyword">byte</span>) (n <span class="keyword">int</span>, err error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还可以使用 strings.NewReader 函数从字符串创建一个 Reader</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str := “My String Data”</span><br><span class="line">reader := strings.NewReader(str)</span><br></pre></td></tr></table></figure>
<h3 id="输出数据"><a href="#输出数据" class="headerlink" title="输出数据"></a>输出数据</h3><p>使用 io.Writer 接口写入输出。Go 也提供了 Writer 接口</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Writer <span class="keyword">interface</span> &#123;</span><br><span class="line">	Write(p []<span class="keyword">byte</span>) (n <span class="keyword">int</span>, err error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Go 中的一种常见模式是函数将写入器作为参数。例如，函数会调用写入器上的 Write 函数，之后就可以从写入器中提取数据</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buf bytes.Buffer</span><br><span class="line">fmt.Fprintf(&amp;buf, <span class="string">"Hello %s"</span>, <span class="string">"World"</span>)</span><br><span class="line">s := buf.String() <span class="comment">// s == "Hello World</span></span><br></pre></td></tr></table></figure>
<p>bytes.Buffer 结构是一个 Writer 结构（它实现了 Write 函数）。(它实现了 Write 函数），因此您可以轻松创建一个并将其传递给 fmt.Fprintf 函数，该函数的第一个参数是 io.Writer。fmt.Fprintf函数会将数据写入缓冲区，稍后即可从中提取数据。</p>
<p>使用写入器通过写入数据来传递数据，然后再提取数据，这种模式在 Go 中非常常见。标准库中的一个例子就是 HTTP 处理器中的 http.ResponseWriter。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    w.Write([]bytes(<span class="string">"Hello World"</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码将向 ResponseWriter 写入数据，即代表字符串 “Hello World “的字节片段。数据存储在 ResponseWriter 实现中，并被传递到其他地方进行进一步处理，直至最终发送到浏览器。</p>
<h3 id="从-Reader-复制到-Writer"><a href="#从-Reader-复制到-Writer" class="headerlink" title="从 Reader 复制到 Writer"></a>从 Reader 复制到 Writer</h3><p>可以使用 io.Copy 函数从 Reader 复制到 Writer。例如从网上下载一个文件，然后再将文件保存。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url <span class="keyword">string</span> = <span class="string">"http://speedtest.ftp.otenet.gr/files/test1Mb.db"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readWrite</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r, err := http.Get(url)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Cannot get from URL"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> r.Body.Close()</span><br><span class="line">	data, _ := io.ReadAll(r.Body)</span><br><span class="line">	os.WriteFile(<span class="string">"rw.data"</span>, data, <span class="number">0755</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用 http.Get 下载文件时，会得到一个 http.Response 结构，即 r。文件内容位于http.Response结构的Body变量中，而http.Response结构是一个io.ReadCloser。ReadCloser是一个将Reader和Closer分组的接口，因此您可以像对待阅读器一样对待它。您可以使用 io.ReadAll 函数从 Body 中读取数据，然后使用 os.WriteFile 将其写入文件。</p>
<p>对上面代码进行性能分析测试，可以得出下载 1 MB 的文件，测试只运行了一次，耗时 1.91 秒。它还占用了 5.27 MB 内存和 218 次不同的内存分配。</p>
<p>我们可以选择用另一种方式，使用 io.Copy 来实现：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">copy</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r, err := http.Get(url)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Cannot get from URL"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> r.Body.Close()</span><br><span class="line">	file, _ := os.Create(<span class="string">"copy.data"</span>)  <span class="comment">// 创建一个文件</span></span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line">	writer := bufio.NewWriter(file)  <span class="comment">// 创建一个 Writer 关联上面创建的文件</span></span><br><span class="line">	io.Copy(writer, r.Body)  <span class="comment">// 使用 io.Copy 将文件内容从 r.Body 拷贝到 Writer</span></span><br><span class="line">	writer.Flush()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对上述代码进行性能测试，copy 函数仅耗时 1.61 秒，使用了 43.2 kB 内存，分配了 62 次内存。可以看出对内存的占用上减少了不少。</p>
<h3 id="读取文本文件"><a href="#读取文本文件" class="headerlink" title="读取文本文件"></a>读取文本文件</h3><p><strong>一口气读取所有内容</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data, err := os.ReadFile(<span class="string">"data.txt"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Println(<span class="string">"Cannot read file:"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="keyword">string</span>(data))</span><br></pre></td></tr></table></figure>
<p><strong>打开文件再读取内容</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 打开文件</span></span><br><span class="line">file, err := os.Open(<span class="string">"data.txt"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Println(<span class="string">"Cannot open file:"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// defer 关闭文件</span></span><br><span class="line"><span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取文件信息，可以通过 stat.Size() 获取文件大小</span></span><br><span class="line">stat, err := file.Stat()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Println(<span class="string">"Cannot read file stats:"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建字节数组，以存储读取的数据，字节数据大小为文件的大小</span></span><br><span class="line">data := <span class="built_in">make</span>([]<span class="keyword">byte</span>, stat.Size())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从 file 中，读取大小为 data 这么大的内容</span></span><br><span class="line">bytes, err := file.Read(data)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Println(<span class="string">"Cannot read file:"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">"Read %d bytes from file\n"</span>, bytes)</span><br><span class="line">fmt.Println(<span class="keyword">string</span>(data))</span><br></pre></td></tr></table></figure></p>
<h3 id="写入文本文件"><a href="#写入文本文件" class="headerlink" title="写入文本文件"></a>写入文本文件</h3><p><strong>一次性写入文件</strong></p>
<p>给定数据后，您可以使用 os.WriteFile 一次写入文件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data := []<span class="keyword">byte</span>(<span class="string">"Hello World!\n"</span>)</span><br><span class="line"></span><br><span class="line">err := os.WriteFile(<span class="string">"data.txt"</span>, data, <span class="number">0644</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Println(<span class="string">"Cannot write to file:"</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一个参数是文件名，数据以字节数组形式存在，最后一个参数是要赋予文件的 Unix 文件权限。如果文件不存在，将创建一个新文件。如果文件存在，则会删除文件中的所有数据，并将新数据写入文件，但不会更改权限。</p>
<p><strong>创建文件并写入内容</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">data := []<span class="keyword">byte</span>(<span class="string">"Hello World!\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建文件</span></span><br><span class="line">file, err := os.Create(<span class="string">"data.txt"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Println(<span class="string">"Cannot create file:"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写入文件</span></span><br><span class="line">bytes, err := file.Write(data)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Println(<span class="string">"Cannot write to file:"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">"Wrote %d bytes to file\n"</span>, bytes)</span><br></pre></td></tr></table></figure>
<p>如果文件不存在，将以指定名称和模式 0666 创建一个新文件。如果文件存在，则会删除其中的所有数据。获得文件后，可以使用 Write 方法直接写入文件，并将字节数组传递给它。</p>
<h3 id="使用临时文件"><a href="#使用临时文件" class="headerlink" title="使用临时文件"></a>使用临时文件</h3><p>可以使用 os.CreateTemp 函数创建临时文件，临时文件是在程序执行任务时为临时存储数据而创建的文件。一旦任务完成，它就会被删除或复制到永久存储空间。在 Go 中，可以使用 os.CreateTemp 函数创建临时文件。之后，就可以删除它了。不同的操作系统会将临时文件存储在不同的地方。无论临时文件存放在哪里，Go 都会使用 os.TempDir 函数告诉你它的位置：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(os.TempDir())</span><br></pre></td></tr></table></figure>
<p>可以在临时目录基础上继续创建子目录</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tmpdir, err := os.MkdirTemp(os.TempDir(), <span class="string">"mytmpdir_*"</span>)  <span class="comment">// 将使用随机字符串替换 *</span></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	log.Println(<span class="string">"Cannot create temp directory:"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> os.RemoveAll(tmpdir)  <span class="comment">// 延迟清理临时目录</span></span><br></pre></td></tr></table></figure>
<p>回到 os.CreateTemp，我们使用 os.CreateTemp 创建实际的临时文件，并将刚刚创建的临时目录和文件名的模式字符串传递给它，其作用与临时目录相同</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建临时文件，在 tmpdir 的基础上</span></span><br><span class="line">tmpfile, err := os.CreateTemp(tmpdir, <span class="string">"mytmp_*"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	log.Println(<span class="string">"Cannot create temp file:"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向文件中写入内容</span></span><br><span class="line">data := []<span class="keyword">byte</span>(<span class="string">"Some random stuff for the temporary file"</span>)</span><br><span class="line">_, err = tmpfile.Write(data)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	log.Println(<span class="string">"Cannot write to temp file:"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">err = tmpfile.Close()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	log.Println(<span class="string">"Cannot close temp file:"</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果没有选择将临时文件放到一个单独的目录中（上述 os.RemoveAll(tmpdir) 删除目录即可删除所有内容），这时可以使用 os.Remove 进行删除临时文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defer os.Remove(tmpfile.Name())</span><br></pre></td></tr></table></figure>
<h2 id="CSV"><a href="#CSV" class="headerlink" title="CSV"></a>CSV</h2><h3 id="读取整个-CSV-文件"><a href="#读取整个-CSV-文件" class="headerlink" title="读取整个 CSV 文件"></a>读取整个 CSV 文件</h3><p>使用 encoding/csv 和 csv.ReadAll 将 CSV 文件中的所有数据读入二维字符串数组。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 打开文件，这会创建一个os.File结构实例（即io.Reader），作为csv.NewReader的参数</span></span><br><span class="line">file, err := os.Open(<span class="string">"users.csv"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"> log.Println(<span class="string">"Cannot open CSV file:"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 Reader</span></span><br><span class="line">reader := csv.NewReader(file)</span><br><span class="line"><span class="comment">// 读取所有数据，返回一个二维字符串数组 [][]string</span></span><br><span class="line">rows, err := reader.ReadAll()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"> log.Println(<span class="string">"Cannot read CSV file:"</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="逐行读取-CSV-文件"><a href="#逐行读取-CSV-文件" class="headerlink" title="逐行读取 CSV 文件"></a>逐行读取 CSV 文件</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">file, err := os.Open(<span class="string">"users.csv"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"> log.Println(<span class="string">"Cannot open CSV file:"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 Reader</span></span><br><span class="line">reader := csv.NewReader(file)</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="comment">// 每次读取一行，直到遇到 io.EOF</span></span><br><span class="line">    record, err := reader.Read()</span><br><span class="line">    <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Println(<span class="string">"Cannot read CSV file:"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> value := <span class="keyword">range</span> record &#123;</span><br><span class="line">        fmt.Printf(<span class="string">"%s\n"</span>, record[value])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="将-CSV-数据转码为结构体"><a href="#将-CSV-数据转码为结构体" class="headerlink" title="将 CSV 数据转码为结构体"></a>将 CSV 数据转码为结构体</h3><p>假设有一个 User 结构体</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">   Id         <span class="keyword">int</span></span><br><span class="line">   firstName  <span class="keyword">string</span></span><br><span class="line">   lastName   <span class="keyword">string</span></span><br><span class="line">   email      <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> users []User</span><br><span class="line"><span class="keyword">for</span> _, row := <span class="keyword">range</span> rows &#123;</span><br><span class="line"> <span class="comment">// 将 ID 转换为 int 类型。（）</span></span><br><span class="line"> id, _ := strconv.ParseInt(row[<span class="number">0</span>], <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"> user := User&#123;Id: <span class="keyword">int</span>(id),</span><br><span class="line">   firstName: row[<span class="number">1</span>],</span><br><span class="line">   lastName:  row[<span class="number">2</span>],</span><br><span class="line">   email:     row[<span class="number">3</span>],</span><br><span class="line"> &#125;</span><br><span class="line"> users = <span class="built_in">append</span>(users, user)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>具体来说，<code>strconv.ParseInt</code> 函数接受三个参数：</p>
<ul>
<li>第一个参数 <code>row[0]</code> 是要转换的字符串</li>
<li>第二个参数 <code>0</code> 是用于指定字符串所表示的整数的进制。通过设置为 <code>0</code>，函数会根据字符串的前缀来自动判断进制，比如 <code>0x</code> 表示十六进制，<code>0</code> 表示八进制，其他情况则默认为十进制。</li>
<li>第三个参数 <code>0</code> 是用于指定要转换的整数类型的位数。通过设置为 <code>0</code>，函数会根据字符串的内容自动选择合适的位数，例如根据字符串的长度来决定是使用 <code>int64</code> 还是 <code>int32</code>。</li>
</ul>
</blockquote>
<p>但是上述代码存在一个问题，那就是文件的标头都被转换了。</p>
<h3 id="移除第一行标题"><a href="#移除第一行标题" class="headerlink" title="移除第一行标题"></a>移除第一行标题</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">file, err := os.Open(<span class="string">"users.csv"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"> log.Println(<span class="string">"Cannot open CSV file:"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> file.Close()</span><br><span class="line">reader := csv.NewReader(file)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 read 移除第一行</span></span><br><span class="line">reader.Read()</span><br><span class="line"><span class="comment">// 在读取剩下的所有行</span></span><br><span class="line">rows, err := reader.ReadAll()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"> log.Println(<span class="string">"Cannot read CSV file:"</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用不同的分隔符"><a href="#使用不同的分隔符" class="headerlink" title="使用不同的分隔符"></a>使用不同的分隔符</h3><p>要读取的 CSV 文件的分隔符不是逗号。我们可以通过以下方法进行设置</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">file, err := os.Open(<span class="string">"users2.csv"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Println(<span class="string">"Cannot open CSV file:"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 Reader</span></span><br><span class="line">reader := csv.NewReader(file)</span><br><span class="line"><span class="comment">// 指定分隔符</span></span><br><span class="line">reader.Comma = <span class="string">';'</span></span><br><span class="line"><span class="comment">// 然后在读取数据</span></span><br><span class="line">rows, err := reader.ReadAll()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Println(<span class="string">"Cannot read CSV file:"</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="忽略行"><a href="#忽略行" class="headerlink" title="忽略行"></a>忽略行</h3><p>如果想忽略某些行，只需将这些行注释掉即可。但是，在 CSV 中是不行的，因为注释不在标准中。不过，使用 Go encoding/csv 软件包，你可以指定一个注释符，如果把它放在行的开头，就可以忽略整行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id,first_name,last_name,email</span><br><span class="line">1,Sausheong,Chang,sausheong@email.com</span><br><span class="line"># 2,John,Doe,john@email.com</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">file, err := os.Open(<span class="string">"users.csv"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Println(<span class="string">"Cannot open CSV file:"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> file.Close()</span><br><span class="line">reader := csv.NewReader(file)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以 # 开头的行将被忽略</span></span><br><span class="line">reader.Comment = <span class="string">'#'</span></span><br><span class="line">rows, err := reader.ReadAll()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Println(<span class="string">"Cannot read CSV file:"</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="数据全写入-CSV-文件"><a href="#数据全写入-CSV-文件" class="headerlink" title="数据全写入 CSV 文件"></a>数据全写入 CSV 文件</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建文件</span></span><br><span class="line">file, err := os.Create(<span class="string">"new_users.csv"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Println(<span class="string">"Cannot create CSV file:"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 要写入的数据</span></span><br><span class="line">data := [][]<span class="keyword">string</span>&#123;</span><br><span class="line"> &#123;<span class="string">"id"</span>, <span class="string">"first_name"</span>, <span class="string">"last_name"</span>, <span class="string">"email"</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"1"</span>, <span class="string">"Sausheong"</span>, <span class="string">"Chang"</span>, <span class="string">"sausheong@email.com"</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"2"</span>, <span class="string">"John"</span>, <span class="string">"Doe"</span>, <span class="string">"john@email.com"</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新建一个 Writer 和 file 关联起来</span></span><br><span class="line">writer := csv.NewWriter(file)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一次性写入所有数据</span></span><br><span class="line">err = writer.WriteAll(data)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"> log.Println(<span class="string">"Cannot write to CSV file:"</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="数据逐行写入-CSV-文件"><a href="#数据逐行写入-CSV-文件" class="headerlink" title="数据逐行写入 CSV 文件"></a>数据逐行写入 CSV 文件</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新建一个 Writer 和 file 关联起来</span></span><br><span class="line">writer := csv.NewWriter(file)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历数据，将数据写入文件中</span></span><br><span class="line"><span class="keyword">for</span> _, row := <span class="keyword">range</span> data &#123;</span><br><span class="line"> err = writer.Write(row)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Println(<span class="string">"Cannot write to CSV file:"</span>, err)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">writer.Flush()</span><br></pre></td></tr></table></figure>
<h2 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h2><h3 id="json-转换为结构体"><a href="#json-转换为结构体" class="headerlink" title="json 转换为结构体"></a>json 转换为结构体</h3><p>创建包含 JSON 数据的结构体，然后使用 encoding/json 包中的 Unmarshal 将数据解码到结构体中。</p>
<p>有一份 skywalker.json 文件，内容如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"name"</span>: <span class="string">"Luke Skywalker"</span>,</span><br><span class="line">	<span class="attr">"height"</span>: <span class="string">"172"</span>,</span><br><span class="line">	<span class="attr">"mass"</span>: <span class="string">"77"</span>,</span><br><span class="line">	<span class="attr">"hair_color"</span>: <span class="string">"blond"</span>,</span><br><span class="line">	<span class="attr">"skin_color"</span>: <span class="string">"fair"</span>,</span><br><span class="line">	<span class="attr">"eye_color"</span>: <span class="string">"blue"</span>,</span><br><span class="line">	<span class="attr">"birth_year"</span>: <span class="string">"19BBY"</span>,</span><br><span class="line">	<span class="attr">"gender"</span>: <span class="string">"male"</span>,</span><br><span class="line">	<span class="attr">"homeworld"</span>: <span class="string">"https://swapi.dev/api/planets/1/"</span>,</span><br><span class="line">	<span class="attr">"films"</span>: [</span><br><span class="line">		<span class="string">"https://swapi.dev/api/films/1/"</span>,</span><br><span class="line">		<span class="string">"https://swapi.dev/api/films/2/"</span>,</span><br><span class="line">		<span class="string">"https://swapi.dev/api/films/3/"</span>,</span><br><span class="line">		<span class="string">"https://swapi.dev/api/films/6/"</span></span><br><span class="line">	],</span><br><span class="line">	<span class="attr">"species"</span>: [],</span><br><span class="line">	<span class="attr">"vehicles"</span>: [</span><br><span class="line">		<span class="string">"https://swapi.dev/api/vehicles/14/"</span>,</span><br><span class="line">		<span class="string">"https://swapi.dev/api/vehicles/30/"</span></span><br><span class="line">	],</span><br><span class="line">	<span class="attr">"starships"</span>: [</span><br><span class="line">		<span class="string">"https://swapi.dev/api/starships/12/"</span>,</span><br><span class="line">		<span class="string">"https://swapi.dev/api/starships/22/"</span></span><br><span class="line">		],</span><br><span class="line">	<span class="attr">"created"</span>: <span class="string">"2014-12-09T13:50:51.644000Z"</span>,</span><br><span class="line">	<span class="attr">"edited"</span>: <span class="string">"2014-12-20T21:17:56.891000Z"</span>,</span><br><span class="line">	<span class="attr">"url"</span>: <span class="string">"https://swapi.dev/api/people/1/"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Person 结构体格式如下</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name      <span class="keyword">string</span>        <span class="string">`json:"name"`</span></span><br><span class="line">	Height    <span class="keyword">string</span>        <span class="string">`json:"height"`</span></span><br><span class="line">	Mass      <span class="keyword">string</span>        <span class="string">`json:"mass"`</span></span><br><span class="line">	HairColor <span class="keyword">string</span>        <span class="string">`json:"hair_color"`</span></span><br><span class="line">	SkinColor <span class="keyword">string</span>        <span class="string">`json:"skin_color"`</span></span><br><span class="line">	EyeColor  <span class="keyword">string</span>        <span class="string">`json:"eye_color"`</span></span><br><span class="line">	BirthYear <span class="keyword">string</span>        <span class="string">`json:"birth_year"`</span></span><br><span class="line">	Gender    <span class="keyword">string</span>        <span class="string">`json:"gender"`</span></span><br><span class="line">	Homeworld <span class="keyword">string</span>        <span class="string">`json:"homeworld"`</span></span><br><span class="line">	Films     []<span class="keyword">string</span>      <span class="string">`json:"films"`</span></span><br><span class="line">	Species   []<span class="keyword">string</span>      <span class="string">`json:"species"`</span></span><br><span class="line">	Vehicles  []<span class="keyword">string</span>      <span class="string">`json:"vehicles"`</span></span><br><span class="line">	Starships []<span class="keyword">string</span>      <span class="string">`json:"starships"`</span></span><br><span class="line">	Created   time.Time     <span class="string">`json:"created"`</span></span><br><span class="line">	Edited    time.Time     <span class="string">`json:"edited"`</span></span><br><span class="line">	URL       <span class="keyword">string</span>        <span class="string">`json:"url"`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用 json.Unmarshal 一次函数，即可将数据解串到结构体实例 person 中（需要创建一个 Person 结构体实例）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">unmarshal</span><span class="params">()</span> <span class="params">(person Person)</span></span> &#123;</span><br><span class="line">	file, err := os.Open(<span class="string">"skywalker.json"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Error opening json file:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">	data, err := io.ReadAll(file)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Error reading json data:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err = json.Unmarshal(data, &amp;person)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Error unmarshalling json data:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="解析非结构化-json-数据"><a href="#解析非结构化-json-数据" class="headerlink" title="解析非结构化 json 数据"></a>解析非结构化 json 数据</h3><p>假如想解析一些 JSON 数据，但事先不知道 JSON 数据的结构或属性，无法构建结构体，或者值的键是动态的。那么这时候，就不能使用预定义结构体了，而是需要使用 any。</p>
<p>例如有以下格式的 json 数据:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"Luke Skywalker"</span>: [</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/1/"</span>,</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/2/"</span>,</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/3/"</span>,</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/6/"</span></span><br><span class="line">       ],</span><br><span class="line">    <span class="attr">"C-3P0"</span>: [</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/1/"</span>,</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/2/"</span>,</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/3/"</span>,</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/4/"</span>,</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/5/"</span>,</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/6/"</span></span><br><span class="line">       ],</span><br><span class="line">    <span class="attr">"R2D2"</span>: [</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/1/"</span>,</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/2/"</span>,</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/3/"</span>,</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/4/"</span>,</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/5/"</span>,</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/6/"</span></span><br><span class="line">       ],</span><br><span class="line">    <span class="attr">"Darth Vader"</span>: [</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/1/"</span>,</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/2/"</span>,</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/3/"</span>,</span><br><span class="line">        <span class="string">"https://swapi.dev/api/films/6/"</span></span><br><span class="line">       ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>则可以这样进行解析</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">unstructured</span><span class="params">()</span> <span class="params">(output <span class="keyword">map</span>[<span class="keyword">string</span>]any)</span></span> &#123;</span><br><span class="line">	file, err := os.Open(<span class="string">"unstructured.json"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Error opening json file:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">	data, err := io.ReadAll(file)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Println(<span class="string">"Error reading json data:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err = json.Unmarshal(data, &amp;output)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Error unmarshalling json data:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果就是这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">map[string]any&#123;</span><br><span class="line">    &quot;C-3P0&quot;: []any&#123;</span><br><span class="line">        &quot;https://swapi.dev/api/films/1/&quot;,</span><br><span class="line">        &quot;https://swapi.dev/api/films/2/&quot;,</span><br><span class="line">        &quot;https://swapi.dev/api/films/3/&quot;,</span><br><span class="line">        &quot;https://swapi.dev/api/films/4/&quot;,</span><br><span class="line">        &quot;https://swapi.dev/api/films/5/&quot;,</span><br><span class="line">        &quot;https://swapi.dev/api/films/6/&quot;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;Darth Vader&quot;: []any&#123;</span><br><span class="line">        &quot;https://swapi.dev/api/films/1/&quot;,</span><br><span class="line">        &quot;https://swapi.dev/api/films/2/&quot;,</span><br><span class="line">        &quot;https://swapi.dev/api/films/3/&quot;,</span><br><span class="line">        &quot;https://swapi.dev/api/films/6/&quot;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;Luke Skywalker&quot;: []any&#123;</span><br><span class="line">        &quot;https://swapi.dev/api/films/1/&quot;,</span><br><span class="line">        &quot;https://swapi.dev/api/films/2/&quot;,</span><br><span class="line">        &quot;https://swapi.dev/api/films/3/&quot;,</span><br><span class="line">        &quot;https://swapi.dev/api/films/6/&quot;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;R2D2&quot;: []any&#123;</span><br><span class="line">        &quot;https://swapi.dev/api/films/1/&quot;,</span><br><span class="line">        &quot;https://swapi.dev/api/films/2/&quot;,</span><br><span class="line">        &quot;https://swapi.dev/api/films/3/&quot;,</span><br><span class="line">        &quot;https://swapi.dev/api/films/4/&quot;,</span><br><span class="line">        &quot;https://swapi.dev/api/films/5/&quot;,</span><br><span class="line">        &quot;https://swapi.dev/api/films/6/&quot;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是在使用的时候就比较麻烦，要对值进行断言后才能使用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">unstruct := unstructured()</span><br><span class="line">vader, ok := unstruct[<span class="string">"Darth Vader"</span>].([]any)   <span class="comment">// 断言之后才能使用</span></span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line">    log.Println(<span class="string">"Cannot type assert"</span>)</span><br><span class="line">&#125;</span><br><span class="line">first := vader[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<h3 id="解析-json-数据流"><a href="#解析-json-数据流" class="headerlink" title="解析 json 数据流"></a>解析 json 数据流</h3><p>对于 JSON 文件或 API 数据，使用 Unmarshal 简单明了。但如果 API 是流式 JSON 数据，会发生什么情况呢？在这种情况下，就不能再使用 Unmarshal 了，因为 Unmarshal 需要一次性读取整个文件。取而代之的是，encoding/json 软件包为您提供了一个 Decoder 函数来处理数据。</p>
<p>下面是另一个 JSON 文件，它代表了一个 JSON 数据流：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;Luke Skywalker&quot;,</span><br><span class="line">&quot;height&quot;: &quot;172&quot;,</span><br><span class="line">&quot;mass&quot;: &quot;77&quot;,</span><br><span class="line">&quot;hair_color&quot;: &quot;blond&quot;,</span><br><span class="line">&quot;skin_color&quot;: &quot;fair&quot;,</span><br><span class="line">&quot;eye_color&quot;: &quot;blue&quot;,</span><br><span class="line">&quot;birth_year&quot;: &quot;19BBY&quot;,</span><br><span class="line">&quot;gender&quot;: &quot;male&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;C-3PO&quot;,</span><br><span class="line">&quot;height&quot;: &quot;167&quot;,</span><br><span class="line">&quot;mass&quot;: &quot;75&quot;,</span><br><span class="line">&quot;hair_color&quot;: &quot;n/a&quot;,</span><br><span class="line">&quot;skin_color&quot;: &quot;gold&quot;,</span><br><span class="line">&quot;eye_color&quot;: &quot;yellow&quot;,</span><br><span class="line">&quot;birth_year&quot;: &quot;112BBY&quot;,</span><br><span class="line">&quot;gender&quot;: &quot;n/a&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;R2-D2&quot;,</span><br><span class="line">&quot;height&quot;: &quot;96&quot;,</span><br><span class="line">&quot;mass&quot;: &quot;32&quot;,</span><br><span class="line">&quot;hair_color&quot;: &quot;n/a&quot;,</span><br><span class="line">&quot;skin_color&quot;: &quot;white, blue&quot;,</span><br><span class="line">&quot;eye_color&quot;: &quot;red&quot;,</span><br><span class="line">&quot;birth_year&quot;: &quot;33BBY&quot;,</span><br><span class="line">&quot;gender&quot;: &quot;n/a&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请注意，这不是一个 JSON 对象，而是三个连续的 JSON 对象。这不再是一个有效的 JSON 文件，但是当你读取 http.Response 结构的 Body 时，你可以得到它。如果尝试使用 Unmarshal 读取，则会出现错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error unmarshalling json data: invalid character &apos;&#123;&apos; after top-level value</span><br></pre></td></tr></table></figure>
<p>但可以使用 Decoder 对其进行解码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">decode</span><span class="params">(p <span class="keyword">chan</span> Person)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 打开文件</span></span><br><span class="line">	file, err := os.Open(<span class="string">"people_stream.json"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Error opening json file:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用 json.NewDecoder 创建解码器</span></span><br><span class="line">	decoder := json.NewDecoder(file)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="comment">// 每次创建创新一个新的 Person 实例，然后使用 Decode 就行解析到对应的实例对象当中</span></span><br><span class="line">		<span class="keyword">var</span> person Person</span><br><span class="line">		err = decoder.Decode(&amp;person)</span><br><span class="line">    <span class="comment">// 直到读取到 io.EOF 为止</span></span><br><span class="line">		<span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Println(<span class="string">"Error decoding json data:"</span>, err)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		p &lt;- person</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">close</span>(p)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	p := <span class="built_in">make</span>(<span class="keyword">chan</span> Person)</span><br><span class="line">  <span class="keyword">go</span> decode(p)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		person, ok := &lt;-p</span><br><span class="line">		<span class="keyword">if</span> ok &#123;</span><br><span class="line">      fmt.Printf(<span class="string">"%# v\n"</span>, pretty.Formatter(person))</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">json.Person&#123;</span><br><span class="line">    Name:      &quot;Luke Skywalker&quot;,</span><br><span class="line">    Height:    &quot;172&quot;,</span><br><span class="line">    Mass:      &quot;77&quot;,</span><br><span class="line">    HairColor: &quot;blond&quot;,</span><br><span class="line">    SkinColor: &quot;fair&quot;,</span><br><span class="line">    EyeColor:  &quot;blue&quot;,</span><br><span class="line">    BirthYear: &quot;19BBY&quot;,</span><br><span class="line">    Gender:    &quot;male&quot;,</span><br><span class="line">    Homeworld: &quot;&quot;,</span><br><span class="line">    Films:     nil,</span><br><span class="line">    Species:   nil,</span><br><span class="line">    Vehicles:  nil,</span><br><span class="line">    Starships: nil,</span><br><span class="line">    Created:   time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC),</span><br><span class="line">    Edited:    time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC),</span><br><span class="line">    URL:       &quot;&quot;,</span><br><span class="line">&#125;</span><br><span class="line">json.Person&#123;</span><br><span class="line">    Name:      &quot;C-3PO&quot;,</span><br><span class="line">    Height:    &quot;167&quot;,</span><br><span class="line">    Mass:      &quot;75&quot;,</span><br><span class="line">    HairColor: &quot;n/a&quot;,</span><br><span class="line">    SkinColor: &quot;gold&quot;,</span><br><span class="line">    EyeColor:  &quot;yellow&quot;,</span><br><span class="line">    BirthYear: &quot;112BBY&quot;,</span><br><span class="line">    Gender:    &quot;n/a&quot;,</span><br><span class="line">    Homeworld: &quot;&quot;,</span><br><span class="line">    Films:     nil,</span><br><span class="line">    Species:   nil,</span><br><span class="line">    Vehicles:  nil,</span><br><span class="line">    Starships: nil,</span><br><span class="line">    Created:   time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC),</span><br><span class="line">    Edited:    time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC),</span><br><span class="line">    URL:       &quot;&quot;,</span><br><span class="line">&#125;</span><br><span class="line">json.Person&#123;</span><br><span class="line">    Name:      &quot;R2-D2&quot;,</span><br><span class="line">    Height:    &quot;96&quot;,</span><br><span class="line">    Mass:      &quot;32&quot;,</span><br><span class="line">    HairColor: &quot;n/a&quot;,</span><br><span class="line">    SkinColor: &quot;white, blue&quot;,</span><br><span class="line">    EyeColor:  &quot;red&quot;,</span><br><span class="line">    BirthYear: &quot;33BBY&quot;,</span><br><span class="line">    Gender:    &quot;n/a&quot;,</span><br><span class="line">    Homeworld: &quot;&quot;,</span><br><span class="line">    Films:     nil,</span><br><span class="line">    Species:   nil,</span><br><span class="line">    Vehicles:  nil,</span><br><span class="line">    Starships: nil,</span><br><span class="line">    Created:   time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC),</span><br><span class="line">    Edited:    time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC),</span><br><span class="line">    URL:       &quot;&quot;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打印结果如上所示，是三个 Person 对象。那么什么时候使用 Unmarshal，什么时候使用 decode 呢？</p>
<blockquote>
<p>在 Go 语言中，JSON 解码有两种常用的方式：<code>json.Unmarshal</code> 和 <code>json.Decoder</code>。它们之间的区别如下：</p>
<ol>
<li><code>json.Unmarshal</code>：这是一个简单而方便的函数，用于将 JSON 数据解码为 Go 中的数据结构。你只需要提供要解码的 JSON 字节或字符串以及一个指向目标数据结构的指针，<code>json.Unmarshal</code> 函数会自动将 JSON 数据解码为对应的 Go 数据类型。这个函数适用于较小的 JSON 数据，因为它会将整个 JSON 数据加载到内存中，然后进行解码。</li>
<li><code>json.Decoder</code>：这是一个更灵活和高级的 JSON 解码器。<code>json.Decoder</code> 允许你对 JSON 数据进行流式处理，逐个解码 JSON 值，而不需要将整个 JSON 数据加载到内存中。你可以使用 <code>json.Decoder</code> 的 <code>Decode</code> 方法来逐个解码 JSON 数据，并将解码后的值存储到相应的变量中。这个方法适用于处理大型的 JSON 数据或需要逐个解码的情况。</li>
</ol>
<p>总结起来，<code>json.Unmarshal</code> 是一个简单的函数，适用于较小的 JSON 数据，而 <code>json.Decoder</code> 是一个更灵活和高级的解码器，适用于处理大型的 JSON 数据或需要逐个解码的情况。</p>
</blockquote>
<h3 id="结构体转换为-json"><a href="#结构体转换为-json" class="headerlink" title="结构体转换为 json"></a>结构体转换为 json</h3><p>使用 json.Marshal 将数据编译成 JSON</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	person := get(<span class="string">"https://swapi.dev/api/people/14"</span>)</span><br><span class="line">  <span class="comment">// 将数据序列化为 json</span></span><br><span class="line">	data, err := json.Marshal(&amp;person)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Cannot marshal person:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">  <span class="comment">// 将序列化后的 json 保存到文件中</span></span><br><span class="line">  err = os.WriteFile(<span class="string">"han.json"</span>, data, <span class="number">0644</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Cannot write to file"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求接口，获取数据，并转换为 Person 结构后返回</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="title">Person</span></span> &#123;</span><br><span class="line">	r, err := http.Get(url)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Cannot get from URL"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> r.Body.Close()</span><br><span class="line"></span><br><span class="line">	data, err := os.ReadAll(r.Body)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Error reading json data:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> person Person</span><br><span class="line">	json.Unmarshal(data, &amp;person)</span><br><span class="line">	<span class="keyword">return</span> person</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>保存到 han.json 文件后可读性不高，这时我们可以使用 MarshalIndent 将其序列化可读性更高的格式，MarshalIndent 的参数第一个是前缀，第二个是缩进。如果你想获得简洁的 JSON 输出，前缀可以是空字符串，而缩进可以是单空格</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data, err := json.MarshalIndent(&amp;person, <span class="string">""</span>, <span class="string">" "</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> &quot;name&quot;: &quot;Han Solo&quot;,</span><br><span class="line"> &quot;height&quot;: &quot;180&quot;,</span><br><span class="line"> &quot;mass&quot;: &quot;80&quot;,</span><br><span class="line"> &quot;hair_color&quot;: &quot;brown&quot;,</span><br><span class="line"> &quot;skin_color&quot;: &quot;fair&quot;,</span><br><span class="line"> &quot;eye_color&quot;: &quot;brown&quot;,</span><br><span class="line"> &quot;birth_year&quot;: &quot;29BBY&quot;,</span><br><span class="line"> &quot;gender&quot;: &quot;male&quot;,</span><br><span class="line"> &quot;homeworld&quot;: &quot;https://swapi.dev/api/planets/22/&quot;,</span><br><span class="line"> &quot;films&quot;: [</span><br><span class="line">  &quot;https://swapi.dev/api/films/1/&quot;,</span><br><span class="line">  &quot;https://swapi.dev/api/films/2/&quot;,</span><br><span class="line">  &quot;https://swapi.dev/api/films/3/&quot;</span><br><span class="line"> ],</span><br><span class="line"> &quot;species&quot;: [],</span><br><span class="line"> &quot;vehicles&quot;: [],</span><br><span class="line"> &quot;starships&quot;: [</span><br><span class="line">  &quot;https://swapi.dev/api/starships/10/&quot;,</span><br><span class="line">  &quot;https://swapi.dev/api/starships/22/&quot;</span><br><span class="line"> ],</span><br><span class="line"> &quot;created&quot;: &quot;2014-12-10T16:49:14.582Z&quot;,</span><br><span class="line"> &quot;edited&quot;: &quot;2014-12-20T21:17:50.334Z&quot;,</span><br><span class="line"> &quot;url&quot;: &quot;https://swapi.dev/api/people/14/&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="从结构体创建-json-数据流"><a href="#从结构体创建-json-数据流" class="headerlink" title="从结构体创建 json 数据流"></a>从结构体创建 json 数据流</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请求 HTTP 接口，将数据转换为 Person 结构</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="params">(person Person)</span></span> &#123;</span><br><span class="line">	r, err := http.Get(<span class="string">"https://swapi.dev/api/people/"</span> + strconv.Itoa(n))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Cannot get from URL"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> r.Body.Close()</span><br><span class="line"></span><br><span class="line">	data, err := ioutil.ReadAll(r.Body)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Error reading json data:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	json.Unmarshal(data, &amp;person)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 创建编码器，参数是 io.Writer，os.Stdout 也属于 io.Writer</span></span><br><span class="line">	encoder := json.NewEncoder(os.Stdout)</span><br><span class="line">  <span class="comment">// 获取数据并进行json编码</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">4</span>; i++ &#123;</span><br><span class="line">		person := get(i)</span><br><span class="line">    <span class="comment">// encoder.SetIndent("", " ")  和 MarshalIndent 一样用于设置输出格式</span></span><br><span class="line">		encoder.Encode(person)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Marshal 和 Encode 的区别，和使用场景：</p>
<ol>
<li><code>json.Marshal</code>：你只需要提供一个 Go 数据结构的值作为输入，<code>json.Marshal</code> 函数会自动将其转换为 JSON 格式的数据。这个函数适用于将整个数据结构转换为 JSON 的场景。</li>
<li><code>json.Encoder</code> 允许你将 Go 数据结构编码为 JSON，并将其写入输出流（如文件、网络连接等）。与 <code>json.Marshal</code> 不同，<code>json.Encoder</code> 可以将 JSON 数据流式地写入输出，而不需要将整个 JSON 数据加载到内存中。这个方法适用于处理大型的 JSON 数据或需要流式写入的情况。</li>
</ol>
</blockquote>
<h3 id="忽略结构体中的字段"><a href="#忽略结构体中的字段" class="headerlink" title="忽略结构体中的字段"></a>忽略结构体中的字段</h3><p>使用 omitempty 标记来定义结构变量，这些结构变量在 marshaling 时就可以被忽略。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name      <span class="keyword">string</span>        <span class="string">`json:"name"`</span></span><br><span class="line">	Height    <span class="keyword">string</span>        <span class="string">`json:"height"`</span></span><br><span class="line">	Mass      <span class="keyword">string</span>        <span class="string">`json:"mass"`</span></span><br><span class="line">	HairColor <span class="keyword">string</span>        <span class="string">`json:"hair_color"`</span></span><br><span class="line">	SkinColor <span class="keyword">string</span>        <span class="string">`json:"skin_color"`</span></span><br><span class="line">	EyeColor  <span class="keyword">string</span>        <span class="string">`json:"eye_color"`</span></span><br><span class="line">	BirthYear <span class="keyword">string</span>        <span class="string">`json:"birth_year"`</span></span><br><span class="line">	Gender    <span class="keyword">string</span>        <span class="string">`json:"gender"`</span></span><br><span class="line">	Homeworld <span class="keyword">string</span>        <span class="string">`json:"homeworld"`</span></span><br><span class="line">	Films     []<span class="keyword">string</span>      <span class="string">`json:"films"`</span></span><br><span class="line">	Species   []<span class="keyword">string</span>      <span class="string">`json:"species,omitempty"`</span>    <span class="comment">// 忽略</span></span><br><span class="line">	Vehicles  []<span class="keyword">string</span>      <span class="string">`json:"vehicles,omitempty"`</span>   <span class="comment">// 忽略</span></span><br><span class="line">	Starships []<span class="keyword">string</span>      <span class="string">`json:"starships,omitempty"`</span>  <span class="comment">// 忽略</span></span><br><span class="line">	Created   time.Time     <span class="string">`json:"created"`</span></span><br><span class="line">	Edited    time.Time     <span class="string">`json:"edited"`</span></span><br><span class="line">	URL       <span class="keyword">string</span>        <span class="string">`json:"url"`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二进制"><a href="#二进制" class="headerlink" title="二进制"></a>二进制</h2><h3 id="将数据编码为-gob-格式"><a href="#将数据编码为-gob-格式" class="headerlink" title="将数据编码为 gob 格式"></a>将数据编码为 gob 格式</h3><p>encoding/gob软件包是一个用于编码和解码二进制格式的 Go 库。数据可以是任何东西，但对 Go 结构体尤其有用。需要注意的是，gob 是 Go 专有的二进制格式。它并不像 protobuf 或 Thrift 那样是一种广泛使用的格式。如果您对二进制数据有更复杂的使用情况，建议您使用更常用的格式。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Meter <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id        <span class="keyword">uint32</span></span><br><span class="line">	Voltage   <span class="keyword">uint8</span></span><br><span class="line">	Current   <span class="keyword">uint8</span></span><br><span class="line">	Energy    <span class="keyword">uint32</span></span><br><span class="line">	Timestamp <span class="keyword">uint64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一条数据</span></span><br><span class="line"><span class="keyword">var</span> reading Meter = Meter&#123;</span><br><span class="line">	Id:        <span class="number">123456</span>,</span><br><span class="line">	Voltage:   <span class="number">229.5</span>,</span><br><span class="line">	Current:   <span class="number">1.3</span>,</span><br><span class="line">	Energy:    <span class="number">4321</span>,</span><br><span class="line">	Timestamp: <span class="keyword">uint64</span>(time.Now().UnixNano()),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// data 为要编码的原始数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">write</span><span class="params">(data <span class="keyword">interface</span>&#123;&#125;, filename <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 创建一个文件</span></span><br><span class="line">	file, err := os.Create(<span class="string">"reading"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Cannot create file:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">  <span class="comment">// 创建一个 Encoder 关联创建的文件</span></span><br><span class="line">	encoder := gob.NewEncoder(file)</span><br><span class="line">  <span class="comment">// 将数据编码为 gob</span></span><br><span class="line">	err = encoder.Encode(data)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Cannot encode data to file:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="将-gob-数据解码为结构体"><a href="#将-gob-数据解码为结构体" class="headerlink" title="将 gob 数据解码为结构体"></a>将 gob 数据解码为结构体</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// data为解码填充的数据结构实例，filename 是 gob 数据文件</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">(data <span class="keyword">interface</span>&#123;&#125;, filename <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 打开文件</span></span><br><span class="line">	file, err := os.Open(<span class="string">"reading"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Println(<span class="string">"Cannot read file:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">  <span class="comment">// 创建一个 Encoder 关联打开的文件</span></span><br><span class="line">	decoder := gob.NewDecoder(file)</span><br><span class="line">  <span class="comment">// 解码文件获取到数据</span></span><br><span class="line">	err = decoder.Decode(data)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Cannot decode data:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">read(&amp;reading, <span class="string">"reading"</span>)</span><br></pre></td></tr></table></figure>
<p>编码 gob 比编码 JSON 更快，二者使用的内存量是一样的。解码 gob 也比解码 JSON 快得多，而且使用的内存也少得多。</p>
<h3 id="编码为定制的二进制格式"><a href="#编码为定制的二进制格式" class="headerlink" title="编码为定制的二进制格式"></a>编码为定制的二进制格式</h3><p>使用 gob 有几个缺点。首先，gob 仅支持 Go 语言，如果发送方和接收方都用 Go 语言编写，则效果最佳。其次，gob 保存的是整个结构，包括标签和所有内容，这使得编码后的二进制数据相对较大。事实上，在内容相同的情况下，JSON 数据的大小与 gob 数据的大小没有区别。</p>
<p>另一种方法是去掉标签；例如，Meter 结构可以这样存储</p>
<p><img src="https://raw.githubusercontent.com/rexyan/warehouse/master/202310281606360.png" alt></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"encoding/binary"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"math"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Meter <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id        <span class="keyword">uint32</span></span><br><span class="line">	Voltage   <span class="keyword">float32</span></span><br><span class="line">	Current   <span class="keyword">float32</span></span><br><span class="line">	Energy    <span class="keyword">uint32</span></span><br><span class="line">	Timestamp <span class="keyword">uint64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> reading Meter = Meter&#123;</span><br><span class="line">	Id:        <span class="number">123456</span>,</span><br><span class="line">	Voltage:   <span class="number">5.1</span>,</span><br><span class="line">	Current:   <span class="number">3.2</span>,</span><br><span class="line">	Energy:    <span class="number">4321</span>,</span><br><span class="line">	Timestamp: <span class="keyword">uint64</span>(time.Now().UnixNano()),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	file, err := os.Create(<span class="string">"data.bin"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Cannot create file:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建一个字节数组，大小为 4+4+4+4+8=24</span></span><br><span class="line">	buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">24</span>)</span><br><span class="line">	binary.BigEndian.PutUint32(buf[<span class="number">0</span>:], reading.Id)</span><br><span class="line">	binary.BigEndian.PutUint32(buf[<span class="number">4</span>:], math.Float32bits(reading.Voltage))</span><br><span class="line">	binary.BigEndian.PutUint32(buf[<span class="number">8</span>:], math.Float32bits(reading.Current))</span><br><span class="line">	binary.BigEndian.PutUint32(buf[<span class="number">12</span>:], reading.Energy)</span><br><span class="line">	binary.BigEndian.PutUint64(buf[<span class="number">16</span>:], reading.Timestamp)</span><br><span class="line">	file.Write(buf)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="将定制二进制解码为结构体"><a href="#将定制二进制解码为结构体" class="headerlink" title="将定制二进制解码为结构体"></a>将定制二进制解码为结构体</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"encoding/binary"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"math"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Meter <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id        <span class="keyword">uint32</span></span><br><span class="line">	Voltage   <span class="keyword">float32</span></span><br><span class="line">	Current   <span class="keyword">float32</span></span><br><span class="line">	Energy    <span class="keyword">uint32</span></span><br><span class="line">	Timestamp <span class="keyword">uint64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> data Meter = Meter&#123;&#125;</span><br><span class="line">	file, err := os.Open(<span class="string">"data.bin"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"Cannot read file:"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">24</span>)</span><br><span class="line">	file.Read(buf)</span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">	data.Id = binary.BigEndian.Uint32(buf[:<span class="number">4</span>])</span><br><span class="line">	data.Voltage = math.Float32frombits(binary.BigEndian.Uint32(buf[<span class="number">4</span>:<span class="number">8</span>]))</span><br><span class="line">	data.Current = math.Float32frombits(binary.BigEndian.Uint32(buf[<span class="number">8</span>:<span class="number">12</span>]))</span><br><span class="line">	data.Energy = binary.BigEndian.Uint32(buf[<span class="number">12</span>:<span class="number">16</span>])</span><br><span class="line">	data.Timestamp = binary.BigEndian.Uint64(buf[<span class="number">16</span>:])</span><br><span class="line">	fmt.Println(data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="日期和时间"><a href="#日期和时间" class="headerlink" title="日期和时间"></a>日期和时间</h2><h3 id="时间做加减法"><a href="#时间做加减法" class="headerlink" title="时间做加减法"></a>时间做加减法</h3><p>如果想对时间做加减法，那么可以使用 Add 和 Sub 函数。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">t0 := time.Now()</span><br><span class="line">t1 := t0.Add(<span class="number">10</span> * time.Minute) <span class="comment">// add 10 minutes</span></span><br><span class="line"></span><br><span class="line">t2 := to.Add(<span class="number">-10</span> * time.Minute) <span class="comment">// subtract 10 minutes</span></span><br><span class="line"></span><br><span class="line">t3 := t1.Sub(t2)</span><br></pre></td></tr></table></figure>
<h3 id="日期"><a href="#日期" class="headerlink" title="日期"></a>日期</h3><p>在 time 包或标准库中都没有 Date 结构。不过，time包中有一个Date函数，用于创建特定的日期和时间，并返回一个 Time 结构体：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">t := time.Date(<span class="number">2009</span>, time.November, <span class="number">10</span>, <span class="number">23</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, time.UTC)</span><br><span class="line"></span><br><span class="line">m := t.Month() <span class="comment">// returns a Month type</span></span><br><span class="line">m.String() <span class="comment">// November</span></span><br><span class="line"></span><br><span class="line">w := t.Weekday() <span class="comment">// returns a Weekday type</span></span><br><span class="line">w.String() <span class="comment">// Tuesday</span></span><br></pre></td></tr></table></figure>
<h3 id="时区"><a href="#时区" class="headerlink" title="时区"></a>时区</h3><p>Time 结构包含一个 Location，表示时区。创建 Location 结构有几种方法：</p>
<p><strong>LoadLocation</strong></p>
<p>Go 的 time 包和其他许多编程语言的库一样，使用由互联网编号分配机构（IANA）管理的时区数据库。该数据库也称作 tz 或 zoneinfo，tz数据库中的时区命名规则为 Area/Location，例如 Asia/Singapore或America/New_York。可以使用 LoadLocation(从 tz 数据库中加载位置）：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    location, err := time.LoadLocation(<span class="string">"Asia/Singapore"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Println(<span class="string">"Cannot load location:"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">"location:"</span>, location)</span><br><span class="line">    utcTime := time.Date(<span class="number">2009</span>, time.November, <span class="number">10</span>, <span class="number">23</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, time.UTC)</span><br><span class="line">    fmt.Println(<span class="string">"UTC time:"</span>, utcTime)</span><br><span class="line">    fmt.Println(<span class="string">"equivalent in Singapore:"</span>, utcTime.In(location))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location: Asia/Singapore</span><br><span class="line">UTC time: 2009-11-10 23:00:00 +0000 UTC</span><br><span class="line">equivalent in Singapore: 2009-11-11 07:00:00 +0800 +08</span><br></pre></td></tr></table></figure>
<p><strong>FixedZone</strong></p>
<p>创建 Location 的另一种方法是使用 FixedZone 函数。这样您就可以创建任何您想要的位置（不在 tz 数据库中），还可以随心所欲地为其命名：</p>
<p>摘录来自<br>Go Cookbook<br>Sau Sheong Chang<br>此材料可能受版权保护。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    location := time.FixedZone(<span class="string">"Singapore Time"</span>, <span class="number">8</span>*<span class="number">60</span>*<span class="number">60</span>)</span><br><span class="line">    fmt.Println(<span class="string">"location:"</span>, location)</span><br><span class="line">    utcTime := time.Date(<span class="number">2009</span>, time.November, <span class="number">10</span>, <span class="number">23</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, time.UTC)</span><br><span class="line">    fmt.Println(<span class="string">"UTC time:"</span>, utcTime)</span><br><span class="line">    fmt.Println(<span class="string">"equivalent in Singapore:"</span>, utcTime.In(location))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location: Singapore Time</span><br><span class="line">UTC time: 2009-11-10 23:00:00 +0000 UTC</span><br><span class="line">equivalent in Singapore: 2009-11-11 07:00:00 +0800 Singapore Time”</span><br></pre></td></tr></table></figure>
<h3 id="持续时间"><a href="#持续时间" class="headerlink" title="持续时间"></a>持续时间</h3><p>想指定一个时间长度，Duration 表示时间跨度。如果您想创建 2 小时 34 分钟 5 秒的时间，该怎么办？当然是相加（因为Duration只是一个int64）：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d := (<span class="number">2</span> * time.Hour) + (<span class="number">34</span> * time.Minute) + (<span class="number">5</span> * time.Second)</span><br></pre></td></tr></table></figure>
<h3 id="测量时间延时"><a href="#测量时间延时" class="headerlink" title="测量时间延时"></a>测量时间延时</h3><p>Go 和许多其他编程语言一样，使用计算机中的单调时钟来测量时间。如果使用 time.Now 创建一个 Time 结构实例，并打印出该结构，就能看到单调时钟：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t := time.Now()</span><br><span class="line">fmt.Println(t)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2021-10-09 13:10:43.311791 +0800 +08 m=+0.000093742</span><br></pre></td></tr></table></figure>
<p>m=+0.000093742部分是单调时钟。之前的部分是挂钟。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  	<span class="comment">// 睡眠 10s</span></span><br><span class="line">    time.Sleep(<span class="number">10</span> * time.Second)</span><br><span class="line">    t := time.Now()</span><br><span class="line">    fmt.Println(t)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2021-10-09 13:21:28.090604 +0800 +08 m=+10.000173581  </span></span><br><span class="line"><span class="comment">// 单调时钟的值为 10.000173581</span></span><br></pre></td></tr></table></figure>
<p>测量代码的运行时长</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="comment">// 睡眠 10s</span></span><br><span class="line">    time.Sleep(<span class="number">10</span> * time.Second)</span><br><span class="line">    t1 := time.Now()</span><br><span class="line">    t2 := time.Now()</span><br><span class="line">    fmt.Println(<span class="string">"t1:"</span>, t1)</span><br><span class="line">    fmt.Println(<span class="string">"t2:"</span>, t2)</span><br><span class="line">    fmt.Println(<span class="string">"difference:"</span>, t2.Sub(t1))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// t1: 2021-10-09 15:12:12.432516 +0800 +08 m=+10.005330678</span></span><br><span class="line"><span class="comment">// t2: 2021-10-09 15:12:12.432516 +0800 +08 m=+10.005330984</span></span><br><span class="line"><span class="comment">// difference: 306ns</span></span><br></pre></td></tr></table></figure>
<p>AddDate、Round 和 Truncate等方法属于挂钟计算，因此它们返回的Time结构体中不会包含单调时钟。同样，In、Local 和 UTC 等返回的Time结构体也不会具有单调时钟。</p>
<p>如果在没有单调时钟的 Sub 结构实例上调用 Sub（或其他单调方法），会发生什么呢？</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    t1 := time.Now().Round(<span class="number">0</span>)</span><br><span class="line">    t2 := time.Now().Round(<span class="number">0</span>)</span><br><span class="line">    fmt.Println(<span class="string">"t1:"</span>, t1)</span><br><span class="line">    fmt.Println(<span class="string">"t2:"</span>, t2)</span><br><span class="line">    fmt.Println(<span class="string">"difference:"</span>, t2.Sub(t1))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// t1: 2021-10-09 15:28:38.451622 +0800 +08</span></span><br><span class="line"><span class="comment">// t2: 2021-10-09 15:28:38.451622 +0800 +08</span></span><br><span class="line"><span class="comment">// difference: 0s</span></span><br></pre></td></tr></table></figure>
<h3 id="格式化时间"><a href="#格式化时间" class="headerlink" title="格式化时间"></a>格式化时间</h3><p>time软件包通过基于模式的布局来格式化时间。这意味着，您只需提供一个类似于参考的特定格式布局，time包就会相应地格式化时间。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"> t := time.Now()</span><br><span class="line"> fmt.Println(t.Format(<span class="string">"3:04PM"</span>))</span><br><span class="line"> fmt.Println(t.Format(<span class="string">"Jan 02, 2006"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1:45PM</span></span><br><span class="line"><span class="comment">// Oct 23, 2021</span></span><br></pre></td></tr></table></figure>
<p>还有一些 RFC 标准的 format 格式的常量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"> t := time.Now()</span><br><span class="line"> fmt.Println(t.Format(time.UnixDate))</span><br><span class="line"> fmt.Println(t.Format(time.RFC822))</span><br><span class="line"> fmt.Println(t.Format(time.RFC850))</span><br><span class="line"> fmt.Println(t.Format(time.RFC1123))</span><br><span class="line"> fmt.Println(t.Format(time.RFC3339))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sat Oct 23 15:05:37 +08 2021</span></span><br><span class="line"><span class="comment">// 22 Oct 23 15:05 +08</span></span><br><span class="line"><span class="comment">// Saturday, 23-Oct-21 15:05:37 +08</span></span><br><span class="line"><span class="comment">// Sat, 23 Oct 2021 15:05:37 +08</span></span><br><span class="line"><span class="comment">// 2021-10-23T15:05:37+08:00</span></span><br></pre></td></tr></table></figure>
<p>Kitchen 标准的 format 格式的常量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"> t := time.Now()</span><br><span class="line"> fmt.Println(t.Format(time.Stamp))</span><br><span class="line"> fmt.Println(t.Format(time.StampMilli))</span><br><span class="line"> fmt.Println(t.Format(time.StampMicro))</span><br><span class="line"> fmt.Println(t.Format(time.StampNano))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Oct 23 15:10:53</span></span><br><span class="line"><span class="comment">// Oct 23 15:10:53.899</span></span><br><span class="line"><span class="comment">// Oct 23 15:10:53.899873</span></span><br><span class="line"><span class="comment">// Oct 23 15:10:53.899873000</span></span><br></pre></td></tr></table></figure>
<p>在自定义其他格式时，月必须是 1，日必须是 2，小时必须是 3，分钟必须是 4，秒必须是 5，年必须是 6，时区必须是 7</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前时间</span></span><br><span class="line">currentTime := time.Now()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义时间格式模板</span></span><br><span class="line">layout := <span class="string">"2006-01-02 15:04:05"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用时间格式模板将时间格式化为指定格式</span></span><br><span class="line">formattedTime := currentTime.Format(layout)</span><br></pre></td></tr></table></figure>
<h3 id="字符串转换为-Time-结构"><a href="#字符串转换为-Time-结构" class="headerlink" title="字符串转换为 Time 结构"></a>字符串转换为 Time 结构</h3><p>使用 Parse 方法将时间显示字符串转换为 Time 结构。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"> str := <span class="string">"4:31am +0800 on Oct 1, 2021"</span></span><br><span class="line"> layout := <span class="string">"3:04pm -0700 on Jan 2, 2006"</span></span><br><span class="line"> t, err := time.Parse(layout, str)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Println(<span class="string">"Cannot parse:"</span>, err)</span><br><span class="line"> &#125;</span><br><span class="line"> fmt.Println(t.Format(time.RFC3339))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2021-10-01T04:31:00+08:00</span></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/08/02/100 Go Mistakes/" rel="prev" title="100 Go Mistakes">
      <i class="fa fa-chevron-left"></i> 100 Go Mistakes
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/11/07/Django源码分析/" rel="next" title="Django 源码分析">
      Django 源码分析 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#第一章-错误处理"><span class="nav-number">1.</span> <span class="nav-text">第一章: 错误处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#错误处理"><span class="nav-number">1.1.</span> <span class="nav-text">错误处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#简化重复性错误处理"><span class="nav-number">1.2.</span> <span class="nav-text">简化重复性错误处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建自定义错误"><span class="nav-number">1.3.</span> <span class="nav-text">创建自定义错误</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Wrapping-错误"><span class="nav-number">1.4.</span> <span class="nav-text">Wrapping 错误</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#错误检查"><span class="nav-number">1.5.</span> <span class="nav-text">错误检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#panic"><span class="nav-number">1.6.</span> <span class="nav-text">panic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#recover-panic"><span class="nav-number">1.7.</span> <span class="nav-text">recover panic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#处理中断"><span class="nav-number">1.8.</span> <span class="nav-text">处理中断</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第二章-字符串"><span class="nav-number">2.</span> <span class="nav-text">第二章: 字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串"><span class="nav-number">2.1.</span> <span class="nav-text">字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串和字节的转换"><span class="nav-number">2.2.</span> <span class="nav-text">字符串和字节的转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其他方式创建字符串"><span class="nav-number">2.3.</span> <span class="nav-text">其他方式创建字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串转换为数字"><span class="nav-number">2.4.</span> <span class="nav-text">字符串转换为数字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数字转换为字符串"><span class="nav-number">2.5.</span> <span class="nav-text">数字转换为字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#替换字符串中的字符"><span class="nav-number">2.6.</span> <span class="nav-text">替换字符串中的字符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建子串"><span class="nav-number">2.7.</span> <span class="nav-text">创建子串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串是否包含子串"><span class="nav-number">2.8.</span> <span class="nav-text">字符串是否包含子串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#切分字符串为数组"><span class="nav-number">2.9.</span> <span class="nav-text">切分字符串为数组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Trimming-strings"><span class="nav-number">2.10.</span> <span class="nav-text">Trimming strings</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#从命令行接受输入"><span class="nav-number">2.11.</span> <span class="nav-text">从命令行接受输入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#转义-HTML-字符串"><span class="nav-number">2.12.</span> <span class="nav-text">转义 HTML 字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#正则表达式"><span class="nav-number">2.13.</span> <span class="nav-text">正则表达式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第三章：日志"><span class="nav-number">3.</span> <span class="nav-text">第三章：日志</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#写入日志"><span class="nav-number">3.1.</span> <span class="nav-text">写入日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加日志记录的字段"><span class="nav-number">3.2.</span> <span class="nav-text">添加日志记录的字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将日志写入到文件"><span class="nav-number">3.3.</span> <span class="nav-text">将日志写入到文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置日志级别"><span class="nav-number">3.4.</span> <span class="nav-text">设置日志级别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第四章：函数"><span class="nav-number">4.</span> <span class="nav-text">第四章：函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#函数接受多种数据类型"><span class="nav-number">4.1.</span> <span class="nav-text">函数接受多种数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#接收不同数量的参数"><span class="nav-number">4.2.</span> <span class="nav-text">接收不同数量的参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#接收任何类型的数据"><span class="nav-number">4.3.</span> <span class="nav-text">接收任何类型的数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建匿名函数"><span class="nav-number">4.4.</span> <span class="nav-text">创建匿名函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#调用后保持状态的函数"><span class="nav-number">4.5.</span> <span class="nav-text">调用后保持状态的函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输入输出"><span class="nav-number">5.</span> <span class="nav-text">输入输出</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#从输入端读取数据"><span class="nav-number">5.1.</span> <span class="nav-text">从输入端读取数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#输出数据"><span class="nav-number">5.2.</span> <span class="nav-text">输出数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#从-Reader-复制到-Writer"><span class="nav-number">5.3.</span> <span class="nav-text">从 Reader 复制到 Writer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#读取文本文件"><span class="nav-number">5.4.</span> <span class="nav-text">读取文本文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写入文本文件"><span class="nav-number">5.5.</span> <span class="nav-text">写入文本文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用临时文件"><span class="nav-number">5.6.</span> <span class="nav-text">使用临时文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CSV"><span class="nav-number">6.</span> <span class="nav-text">CSV</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#读取整个-CSV-文件"><span class="nav-number">6.1.</span> <span class="nav-text">读取整个 CSV 文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#逐行读取-CSV-文件"><span class="nav-number">6.2.</span> <span class="nav-text">逐行读取 CSV 文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将-CSV-数据转码为结构体"><span class="nav-number">6.3.</span> <span class="nav-text">将 CSV 数据转码为结构体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#移除第一行标题"><span class="nav-number">6.4.</span> <span class="nav-text">移除第一行标题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用不同的分隔符"><span class="nav-number">6.5.</span> <span class="nav-text">使用不同的分隔符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#忽略行"><span class="nav-number">6.6.</span> <span class="nav-text">忽略行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据全写入-CSV-文件"><span class="nav-number">6.7.</span> <span class="nav-text">数据全写入 CSV 文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据逐行写入-CSV-文件"><span class="nav-number">6.8.</span> <span class="nav-text">数据逐行写入 CSV 文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JSON"><span class="nav-number">7.</span> <span class="nav-text">JSON</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#json-转换为结构体"><span class="nav-number">7.1.</span> <span class="nav-text">json 转换为结构体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解析非结构化-json-数据"><span class="nav-number">7.2.</span> <span class="nav-text">解析非结构化 json 数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解析-json-数据流"><span class="nav-number">7.3.</span> <span class="nav-text">解析 json 数据流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#结构体转换为-json"><span class="nav-number">7.4.</span> <span class="nav-text">结构体转换为 json</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#从结构体创建-json-数据流"><span class="nav-number">7.5.</span> <span class="nav-text">从结构体创建 json 数据流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#忽略结构体中的字段"><span class="nav-number">7.6.</span> <span class="nav-text">忽略结构体中的字段</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二进制"><span class="nav-number">8.</span> <span class="nav-text">二进制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#将数据编码为-gob-格式"><span class="nav-number">8.1.</span> <span class="nav-text">将数据编码为 gob 格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将-gob-数据解码为结构体"><span class="nav-number">8.2.</span> <span class="nav-text">将 gob 数据解码为结构体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编码为定制的二进制格式"><span class="nav-number">8.3.</span> <span class="nav-text">编码为定制的二进制格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将定制二进制解码为结构体"><span class="nav-number">8.4.</span> <span class="nav-text">将定制二进制解码为结构体</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#日期和时间"><span class="nav-number">9.</span> <span class="nav-text">日期和时间</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#时间做加减法"><span class="nav-number">9.1.</span> <span class="nav-text">时间做加减法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#日期"><span class="nav-number">9.2.</span> <span class="nav-text">日期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#时区"><span class="nav-number">9.3.</span> <span class="nav-text">时区</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#持续时间"><span class="nav-number">9.4.</span> <span class="nav-text">持续时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测量时间延时"><span class="nav-number">9.5.</span> <span class="nav-text">测量时间延时</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#格式化时间"><span class="nav-number">9.6.</span> <span class="nav-text">格式化时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串转换为-Time-结构"><span class="nav-number">9.7.</span> <span class="nav-text">字符串转换为 Time 结构</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Rex"
      src="https://raw.githubusercontent.com/rexyan/warehouse/master/20230809141242.jpg">
  <p class="site-author-name" itemprop="name">Rex</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">446</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">183</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa-hand-o-right"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rex</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
