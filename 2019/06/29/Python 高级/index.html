<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rexyan.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"top","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"buttons","active":null,"storage":true,"lazyload":true,"nav":{"disqus":{"text":"Load Disqus","order":-1}}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":3,"unescape":false,"preload":false},"motion":{"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="魔法方法reprPython 有一个内置的函数叫 repr，它能把一个对象用字符串的形式表达出来以便辨认，这就是“字符串表示形式”。repr 就是通过 __repr__ 这个特殊方法来得到一个对象的字符串表示形式的。如果没有实现 _repr__，当我们在控制台里打印一个向量的实例时，得到的字符串可能会是 Vecto r object at 0x10e100070&amp;gt; 1234567class">
<meta name="keywords" content="Python 高级">
<meta property="og:type" content="article">
<meta property="og:title" content="Python 高级">
<meta property="og:url" content="https://rexyan.github.io/2019/06/29/Python 高级/index.html">
<meta property="og:site_name" content="星尘">
<meta property="og:description" content="魔法方法reprPython 有一个内置的函数叫 repr，它能把一个对象用字符串的形式表达出来以便辨认，这就是“字符串表示形式”。repr 就是通过 __repr__ 这个特殊方法来得到一个对象的字符串表示形式的。如果没有实现 _repr__，当我们在控制台里打印一个向量的实例时，得到的字符串可能会是 Vecto r object at 0x10e100070&amp;gt; 1234567class">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjBvtyafT1KaVP*Q3G4MQFMtEyT9mG0Q0N9CjjjuUO2ywpLWr04NmTmXfq3i36Miwvg!!/mnull&bo=RwOVAUcDlQEDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">
<meta property="og:updated_time" content="2025-10-31T03:20:39.399Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Python 高级">
<meta name="twitter:description" content="魔法方法reprPython 有一个内置的函数叫 repr，它能把一个对象用字符串的形式表达出来以便辨认，这就是“字符串表示形式”。repr 就是通过 __repr__ 这个特殊方法来得到一个对象的字符串表示形式的。如果没有实现 _repr__，当我们在控制台里打印一个向量的实例时，得到的字符串可能会是 Vecto r object at 0x10e100070&amp;gt; 1234567class">
<meta name="twitter:image" content="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjBvtyafT1KaVP*Q3G4MQFMtEyT9mG0Q0N9CjjjuUO2ywpLWr04NmTmXfq3i36Miwvg!!/mnull&bo=RwOVAUcDlQEDCSw!&rf=photolist&t=5/r/_yake_qzoneimgout.png">

<link rel="canonical" href="https://rexyan.github.io/2019/06/29/Python 高级/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Python 高级 | 星尘</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  
  <link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.6.0/lxgwwenkaiscreen.css" />
  <!-- 自定义为霞鹜文楷字体 -->
  <style>
	  body,div.post-body,h1,h2,h3,h4 {
		font-family: "LXGW WenKai Screen", sans-serif;
		font-size: 104%;
	  }
  </style>
  
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">星尘</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-读书">

    <a href="/books/" rel="section"><i class="address-book fa-fw"></i>读书</a>

  </li>
        <li class="menu-item menu-item-瞎扯">

    <a href="/crap/" rel="section"><i class="crap fa-fw"></i>瞎扯</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



<script src="https://cdn.jsdelivr.net/npm/echarts@4.8.0/dist/echarts.min.js"></script>

<meta name="referrer" content="never">




  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://rexyan.github.io/2019/06/29/Python 高级/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/rexyan/warehouse/master/20230809141242.jpg">
      <meta itemprop="name" content="Rex">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="星尘">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Python 高级
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-06-29 10:25:57" itemprop="dateCreated datePublished" datetime="2019-06-29T10:25:57+00:00">2019-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-31 03:20:39" itemprop="dateModified" datetime="2025-10-31T03:20:39+00:00">2025-10-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-进阶/" itemprop="url" rel="index"><span itemprop="name">Python 进阶</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="魔法方法"><a href="#魔法方法" class="headerlink" title="魔法方法"></a>魔法方法</h3><h4 id="repr"><a href="#repr" class="headerlink" title="repr"></a>repr</h4><p>Python 有一个内置的函数叫 repr，它能把一个对象用字符串的形式表达出来以便辨认，这就是“字符串表示形式”。repr 就是通过 <code>__repr__</code> 这个特殊方法来得到一个对象的字符串表示形式的。如果没有实现 <code>_repr__</code>，当我们在控制台里打印一个向量的实例时，得到的字符串可能会是 <code>Vecto r object at 0x10e100070&gt;</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AAA</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"AAA"</span></span><br><span class="line"></span><br><span class="line">aaa = AAA()</span><br><span class="line">print(aaa)  <span class="comment"># AAA</span></span><br><span class="line">print(repr(aaa))  <span class="comment"># AAA</span></span><br></pre></td></tr></table></figure>
<h4 id="str"><a href="#str" class="headerlink" title="str"></a>str</h4><p><code>__repr__</code>和<code>__str__</code> 区别在于，后者是在 str() 函数被使用，或是在用 print 函数打印一个对象的时候才被调用的，并且它返回的字符串对终端用户更友好。如果你只想实现这两个特殊方法中的一个，<code>__repr__</code> 是更好的选择，因为<strong>一个对象没有 <code>__str__</code> 函数，而 Python 又需要调用它的时候，解释器会用<code>__repr__</code> 作为替代</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AAA</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"这里写什么就返回什么"</span></span><br><span class="line"></span><br><span class="line">aaa = AAA()</span><br><span class="line">print(str(aaa)) <span class="comment">#一个对象没有 __str__ 函数，而 Python 又需要调用它的时候，解释器会用__repr__ 作为替代</span></span><br></pre></td></tr></table></figure>
<h4 id="bool"><a href="#bool" class="headerlink" title="bool"></a>bool</h4><p>bool(x) 的背后是调用 <code>x.__bool__()</code> 的结果；如果不存在<code>__bool__</code> 方法，那么 bool(x) 会尝试调用 <code>x.__len__()</code>。若返回 0，则 bool 会返回 False；否则返回 True。</p>
<h3 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h3><h4 id="元组拆包"><a href="#元组拆包" class="headerlink" title="元组拆包"></a>元组拆包</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(divmod(<span class="number">20</span>, <span class="number">8</span>))  <span class="comment"># (2, 4)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个元组</span></span><br><span class="line">t = (<span class="number">20</span>, <span class="number">8</span>)</span><br><span class="line">print(divmod(*t))  <span class="comment"># (2, 4)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">a, b, *rest = range(<span class="number">5</span>)</span><br><span class="line">print(<span class="string">f"a: <span class="subst">&#123;a&#125;</span>, b: <span class="subst">&#123;b&#125;</span>, rest: <span class="subst">&#123;rest&#125;</span>"</span>)  <span class="comment"># a: 0, b: 1, rest: [2, 3, 4]</span></span><br><span class="line"></span><br><span class="line">a, b, *rest = range(<span class="number">3</span>)</span><br><span class="line">print(<span class="string">f"a: <span class="subst">&#123;a&#125;</span>, b: <span class="subst">&#123;b&#125;</span>, rest: <span class="subst">&#123;rest&#125;</span>"</span>)  <span class="comment"># a: 0, b: 1, rest: [2]</span></span><br><span class="line"></span><br><span class="line">a, b, *rest = range(<span class="number">2</span>)</span><br><span class="line">print(<span class="string">f"a: <span class="subst">&#123;a&#125;</span>, b: <span class="subst">&#123;b&#125;</span>, rest: <span class="subst">&#123;rest&#125;</span>"</span>)  <span class="comment"># a: 0, b: 1, rest: []</span></span><br><span class="line"></span><br><span class="line">a, *body, c, d = range(<span class="number">5</span>)</span><br><span class="line">print(<span class="string">f"a: <span class="subst">&#123;a&#125;</span>, body: <span class="subst">&#123;body&#125;</span>, c: <span class="subst">&#123;c&#125;</span>, d:<span class="subst">&#123;d&#125;</span>"</span>)  <span class="comment"># a: 0, body: [1, 2], c: 3, d:4</span></span><br><span class="line"></span><br><span class="line">*head, b, c, d = range(<span class="number">5</span>)</span><br><span class="line">print(<span class="string">f"head: <span class="subst">&#123;head&#125;</span>, b: <span class="subst">&#123;b&#125;</span>, c: <span class="subst">&#123;c&#125;</span>, d:<span class="subst">&#123;d&#125;</span>"</span>)  <span class="comment"># head: [0, 1], b: 2, c: 3, d:4</span></span><br></pre></td></tr></table></figure>
<h4 id="嵌套元组拆包"><a href="#嵌套元组拆包" class="headerlink" title="嵌套元组拆包"></a>嵌套元组拆包</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">users = [</span><br><span class="line">    (<span class="string">"张三"</span>, <span class="string">"男"</span>, <span class="string">"20"</span>, (<span class="string">"湖北省"</span>, <span class="string">"武汉市"</span>, <span class="string">"xx区"</span>)),</span><br><span class="line">    (<span class="string">"李四"</span>, <span class="string">"男"</span>, <span class="string">"34"</span>, (<span class="string">"江苏省"</span>, <span class="string">"南京市"</span>, <span class="string">"xx区"</span>))</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name, sex, age, (province, city, area) <span class="keyword">in</span> users:</span><br><span class="line">    print(province, city, area)</span><br><span class="line">    <span class="comment"># 湖北省 武汉市 xx区</span></span><br><span class="line">    <span class="comment"># 江苏省 南京市 xx区</span></span><br></pre></td></tr></table></figure>
<h4 id="具名元组"><a href="#具名元组" class="headerlink" title="具名元组"></a>具名元组</h4><p>创建一个具名元组需要两个参数，一个是类名，另一个是类的各个字段的名字。后者可以是由数个字符串组成的可迭代对象，或者是由空格分隔开的字段名组成的字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line">users = namedtuple(<span class="string">"users"</span>, <span class="string">"name sex age position"</span>)</span><br><span class="line">u1 = users(<span class="string">"李四"</span>, <span class="string">"男"</span>, <span class="string">"34"</span>, (<span class="string">"江苏省"</span>, <span class="string">"南京市"</span>, <span class="string">"xx区"</span>))</span><br><span class="line">print(u1.name, u1.sex, u1.age, u1.position)</span><br><span class="line"><span class="comment"># 李四 男 34 ('江苏省', '南京市', 'xx区')</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 常用属性和方法</span></span><br><span class="line">print(u1._fields)</span><br><span class="line"><span class="comment"># ('name', 'sex', 'age', 'position')</span></span><br><span class="line"></span><br><span class="line">print(u1._asdict())</span><br><span class="line"><span class="comment"># OrderedDict([('name', '李四'), ('sex', '男'), ('age', '34'), ('position', ('江苏省', '南京市', 'xx区'))])</span></span><br><span class="line"></span><br><span class="line">print(u1._replace(sex=<span class="string">"女"</span>))</span><br><span class="line"><span class="comment"># users(name='李四', sex='女', age='34', position=('江苏省', '南京市', 'xx区'))</span></span><br><span class="line"></span><br><span class="line">print(u1.count(<span class="string">"淮安"</span>))</span><br><span class="line"><span class="comment"># 0</span></span><br><span class="line"></span><br><span class="line">u2 = users._make((<span class="string">"张三"</span>, <span class="string">"男"</span>, <span class="string">"20"</span>, (<span class="string">"湖北省"</span>, <span class="string">"武汉市"</span>, <span class="string">"xx区"</span>)))</span><br><span class="line">print(u2)</span><br><span class="line"><span class="comment"># users(name='张三', sex='男', age='20', position=('湖北省', '武汉市', 'xx区'))</span></span><br></pre></td></tr></table></figure>
<h4 id="切片赋值"><a href="#切片赋值" class="headerlink" title="切片赋值"></a>切片赋值</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">l = list(range(<span class="number">10</span>))</span><br><span class="line">print(l)  <span class="comment"># [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span><br><span class="line">l[<span class="number">2</span>:<span class="number">5</span>] = [<span class="number">20</span>, <span class="number">30</span>]  <span class="comment">#  l[2:5] 的位置是从2开始的到4的元素（不包含5），共三个，但是后面的列表值只有两个</span></span><br><span class="line">print(l)  <span class="comment"># [0, 1, 20, 30, 5, 6, 7, 8, 9]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">del</span> l[<span class="number">5</span>:<span class="number">7</span>]</span><br><span class="line">print(l)  <span class="comment"># [0, 1, 20, 30, 5, 8, 9]</span></span><br><span class="line"></span><br><span class="line">l[<span class="number">3</span>::<span class="number">2</span>] = [<span class="number">11</span>, <span class="number">22</span>]  <span class="comment"># 从下标为 3 的元素开始，每隔两个进行赋值(注意只能赋值一次， 不然会出现错误，例如 l[2::2] = [11, 22] 就会出错)。</span></span><br><span class="line">print(l)  <span class="comment"># [0, 1, 20, 11, 5, 22, 9]</span></span><br><span class="line"></span><br><span class="line">l[<span class="number">2</span>:<span class="number">5</span>] = <span class="number">100</span> <span class="comment"># TypeError: can only assign an iterable</span></span><br><span class="line"><span class="comment"># 如果赋值的对象是一个切片，那么赋值语句的右侧必须是个可迭代对象。即便只有单独一个值，也要把它转换成可迭代的序列。</span></span><br></pre></td></tr></table></figure>
<h4 id="序列的增量赋值"><a href="#序列的增量赋值" class="headerlink" title="序列的增量赋值"></a>序列的增量赋值</h4><p>增量赋值运算符 += 和 *= 后面的概念和理论都是一样的，这里以  += 进行举例。+= 背后的特殊方法是 <code>__iadd__</code> （用于“就地加法”, 不会创建新对象，还是修改当前对象的值）。但是如果一个类没有实现这个方法的话，Python 会退一步调用  <code>__add__</code> 。考虑下面这个简单的表达式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a += b</span><br></pre></td></tr></table></figure>
<p>如果 a 实现了<code>__iadd__</code> 方法，就会调用这个方法。同时对可变序列（例如 list、bytearray 和 array.array）来说，a 会就地改动，就像调用了 a.extend(b) 一样。但是如果 a 没有实现 <code>__iadd__</code> 的话，a += b 这个表达式的效果就变得跟 a = a + b 一样了：首先计算 a +b，得到一个新的对象，然后赋值给 a。也就是说，在这个表达式中，变量名会不会被关联到新的对象，完全取决于这个类型有没有实现 <code>__iadd__</code> 这个方法。总体来讲，可变序列一般都实现了 <code>__iadd__</code> 方法，因此 += 是就地加法（不会创建新对象）。而不可变序列根本就不支持这个操作（会创建新对象）。上面所说的这些关于 += 的概念也适用于 *=，不同的是，后者相对应的是 <code>__imul__</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 展示 *= 在可变和不可变序列上的作用：</span></span><br><span class="line">l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">print(l)  <span class="comment"># [1, 2, 3]</span></span><br><span class="line">print(id(l))  <span class="comment"># 2439123847944</span></span><br><span class="line"></span><br><span class="line">l *= <span class="number">2</span></span><br><span class="line">print(l)  <span class="comment"># [1, 2, 3, 1, 2, 3]  值变了</span></span><br><span class="line">print(id(l))  <span class="comment"># 2439123847944   ID 没变</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"===================================="</span>)</span><br><span class="line"></span><br><span class="line">t = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">print(t)  <span class="comment"># (1, 2, 3)</span></span><br><span class="line">print(id(t))  <span class="comment"># 1865362443288</span></span><br><span class="line"></span><br><span class="line">t *= <span class="number">2</span></span><br><span class="line">print(t)  <span class="comment"># (1, 2, 3, 1, 2, 3)  值变了</span></span><br><span class="line">print(id(t))  <span class="comment"># 1865361721288   ID 也变了</span></span><br></pre></td></tr></table></figure>
<h4 id="一个关于-的谜题"><a href="#一个关于-的谜题" class="headerlink" title="一个关于+=的谜题"></a>一个关于+=的谜题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">下面代码会发生下面 4 种情况中的哪一种？</span><br><span class="line">&gt;&gt;&gt; t = (1, 2, [30, 40])</span><br><span class="line">&gt;&gt;&gt; t[2] += [50, 60]</span><br><span class="line"></span><br><span class="line">a. t 变成 (1, 2, [30, 40, 50, 60])。</span><br><span class="line">b. 因为 tuple 不支持对它的元素赋值，所以会抛出 TypeError 异常。</span><br><span class="line">c. 以上两个都不是。</span><br><span class="line">d. a 和 b 都是对的。</span><br><span class="line"></span><br><span class="line">答案：a，b。被改变成了 (1, 2, [30, 40, 50, 60])，但是也抛出了异常。如果改写成 t[2].extend([50, 60]) 就能避免这个异常。</span><br></pre></td></tr></table></figure>
<h3 id="list-sort-和-sorted"><a href="#list-sort-和-sorted" class="headerlink" title="list.sort 和 sorted"></a>list.sort 和 sorted</h3><p>list.sort 方法会就地排序列表，也就是说不会把原列表复制一份（不会创建新的内存空间，使用 id 查看到的内存地址是一致的）。这也是这个方法的返回值是 None 的原因，提醒你本方法不会新建一个列表。</p>
<p>在这种情况下返回 None 其实是 Python 的一个惯例：如果一个函数或者方法对对象进行的是就地改动，那它就应该返回 None，好让调用者知道传入的参数发生了变动，而且并未产生新的对象。用返回 None 来表示就地改动这个惯例有个弊端，那就是调用者无法将其串联起来。而返回一个新对象的方法（比如说 str 里的所有方法）则正好相反，它们可以串联起来调用，从而形成连贯接口。</p>
<p>与 list.sort 相反的是内置函数 sorted，它会新建一个列表作为返回值。这个方法可以接受任何形式的可迭代对象作为参数，甚至包括不可变序列或生成器。而不管 sorted 接受的是怎样的参数，它最后都会返回一个列表。不管是 list.sort 方法还是 sorted 函数，都有两个可选的关键字参数，reverse 和 key。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="string">"aa"</span>, <span class="string">"ccc"</span>, <span class="string">"ee"</span>, <span class="string">"dddd"</span>]</span><br><span class="line"><span class="comment"># 按照字母升序进行排序（sorted 会创建新的对象）</span></span><br><span class="line">print(sorted(a))  <span class="comment"># ['aa', 'ccc', 'dddd', 'ee']</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照字母降序进行排序（sorted 会创建新的对象）</span></span><br><span class="line">print(sorted(a, reverse=<span class="literal">True</span>))  <span class="comment"># ['ee', 'dddd', 'ccc', 'aa']</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 先按照字母降序进行排序，如果长度相同，那么会保持列表中原来的位置，如下面的 aa 和 ee 的位置。</span></span><br><span class="line">print(sorted(a, reverse=<span class="literal">True</span>, key=len))  <span class="comment"># ['dddd', 'ccc', 'aa', 'ee']</span></span><br></pre></td></tr></table></figure>
<p>因为排序算法是稳定的，aa和 ee的长度都是 2，所以它们的相对位置跟在原来的列表里是一样的。</p>
<h3 id="bisect"><a href="#bisect" class="headerlink" title="bisect"></a>bisect</h3><p>bisect 是 python 内置模块，用于<strong>有序序列的插入和查找</strong> </p>
<p>查找</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bisect</span><br><span class="line"> </span><br><span class="line">a = [<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">15</span>,<span class="number">20</span>]</span><br><span class="line">position = bisect.bisect(a,<span class="number">12</span>)  <span class="comment"># 5</span></span><br><span class="line">position_left = bisect.bisect_left(a,<span class="number">12</span>)  <span class="comment"># 4</span></span><br></pre></td></tr></table></figure>
<p>插入并排序</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bisect</span><br><span class="line"> </span><br><span class="line">a = [<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">15</span>,<span class="number">20</span>]</span><br><span class="line">bisect.insort(a,<span class="number">13</span>)</span><br><span class="line">print(a)  <span class="comment"># [1, 4, 6, 8, 12, 13, 15, 20]</span></span><br></pre></td></tr></table></figure>
<p>综合实例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bisect</span><br><span class="line">HAYSTACK = [<span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">23</span>, <span class="number">23</span>, <span class="number">26</span>, <span class="number">29</span>, <span class="number">30</span>]</span><br><span class="line">NEEDLES = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>]</span><br><span class="line">ROW_FMT = <span class="string">'&#123;0:2d&#125; @ &#123;1:2d&#125; &#123;2&#125;&#123;0:&lt;2d&#125;'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo</span><span class="params">(bisect_fn)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> needle <span class="keyword">in</span> reversed(NEEDLES):</span><br><span class="line">        position = bisect_fn(HAYSTACK, needle)</span><br><span class="line">        offset = position * <span class="string">' |'</span></span><br><span class="line">        print(ROW_FMT.format(needle, position, offset))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># bisect_fn = bisect.bisect_left  # 位置在左边</span></span><br><span class="line">    bisect_fn = bisect.bisect  </span><br><span class="line">    print(<span class="string">'DEMO:'</span>, bisect_fn.__name__)</span><br><span class="line">    print(<span class="string">'haystack -&gt;'</span>, <span class="string">' '</span>.join(<span class="string">'%2d'</span> % n <span class="keyword">for</span> n <span class="keyword">in</span> HAYSTACK))</span><br><span class="line">    demo(bisect_fn)</span><br></pre></td></tr></table></figure>
<h3 id="array"><a href="#array" class="headerlink" title="array"></a>array</h3><p><a href="https://www.cnblogs.com/jlf0103/p/9168093.html" target="_blank" rel="noopener">https://www.cnblogs.com/jlf0103/p/9168093.html</a> </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个浮点型数组，并取最后一个值</span></span><br><span class="line">floats = array(<span class="string">'d'</span>, (random() <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>**<span class="number">7</span>)))</span><br><span class="line">print(floats[<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将生成的数组数据写入一个二进制文件中</span></span><br><span class="line">fp = open(<span class="string">'floats.bin'</span>, <span class="string">'wb'</span>)</span><br><span class="line">floats.tofile(fp)</span><br><span class="line">fp.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将数据从二进制文件中读取出来</span></span><br><span class="line">floats2 = array(<span class="string">'d'</span>)</span><br><span class="line">fp = open(<span class="string">'floats.bin'</span>, <span class="string">'rb'</span>)</span><br><span class="line">floats2.fromfile(fp, <span class="number">10</span>**<span class="number">7</span>)</span><br><span class="line">fp.close()</span><br><span class="line"></span><br><span class="line">print(floats[<span class="number">-1</span>] == floats2[<span class="number">-1</span>])  <span class="comment"># True</span></span><br></pre></td></tr></table></figure>
<h3 id="deque"><a href="#deque" class="headerlink" title="deque"></a>deque</h3><p>collections.deque 类（双向队列）是一个线程安全、可以快速从两端添加或者删除元素的数据类型。而且如果想要有一种数据类型来存放“最近用到的几个元素”，deque 也是一个很好的选择。这是因为在新建一个双向队列的时候，你可以指定这个队列的大小，如果这个队列满员了，还可以从反向端删除过期的元素，然后在尾端添加新的元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个大小为 10 的双向队列</span></span><br><span class="line">dq = deque(range(<span class="number">10</span>), maxlen=<span class="number">10</span>)</span><br><span class="line">print(dq)  <span class="comment"># deque([0, 1, 2, 3, 4, 5, 6, 7, 8, 9], maxlen=10)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 队列的旋转操作。接受参数 n，当 n 大于 0 时，队列最右边的元素会被移动的到最左边</span></span><br><span class="line">dq.rotate(<span class="number">3</span>)</span><br><span class="line">print(dq)  <span class="comment"># deque([7, 8, 9, 0, 1, 2, 3, 4, 5, 6], maxlen=10)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 队列的旋转操作。接受参数 n，当 n 小于 0 时，队列最左边的元素会被移动的到最右边</span></span><br><span class="line">dq.rotate(<span class="number">-4</span>)</span><br><span class="line">print(dq)  <span class="comment"># deque([1, 2, 3, 4, 5, 6, 7, 8, 9, 0], maxlen=10)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 左边插入元素</span></span><br><span class="line">dq.appendleft(<span class="number">-1</span>)</span><br><span class="line">print(dq)  <span class="comment"># deque([-1, 1, 2, 3, 4, 5, 6, 7, 8, 9], maxlen=10)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 右边添加三个元素，因为大小为 10， 所以会挤掉左边的三个元素</span></span><br><span class="line">dq.extend([<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>])</span><br><span class="line">print(dq)  <span class="comment"># deque([3, 4, 5, 6, 7, 8, 9, 10, 11, 12], maxlen=10)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 左边添加元素（注意这里是倒序）因为大小为 10， 所以会挤掉右边的三个元素</span></span><br><span class="line">dq.extendleft([<span class="number">-3</span>, <span class="number">-4</span>, <span class="number">-5</span>])</span><br><span class="line">print(dq)  <span class="comment"># deque([-5, -4, -3, 3, 4, 5, 6, 7, 8, 9], maxlen=10)</span></span><br></pre></td></tr></table></figure>
<h3 id="字典找不到-key-时返回默认值"><a href="#字典找不到-key-时返回默认值" class="headerlink" title="字典找不到 key 时返回默认值"></a>字典找不到 key 时返回默认值</h3><p>defaultdict</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用的时候需要给 defaultdict 构造函数传递一个可调用的对象</span></span><br><span class="line"><span class="comment"># 这个对象会在调用 __getitem__ 碰到 key 找不到的情况被调用，并让 __getitem__ 返回一个可调用对象产生的值</span></span><br><span class="line"><span class="comment"># 注意 defaultdict 只是在调用 __getitem__ 找不到 key 的情况下才会有效果，也就是 dd["zhangsan"] 这种写法</span></span><br><span class="line"><span class="comment"># 而 dd.get("zhangsan") 这种写法是不会触发调用 __getitem__ 方法的，所以返回值为 None</span></span><br><span class="line"><span class="comment"># 所有这一切背后的功臣其实是特殊方法 __missing__，而实际上这个特性是所有映射类型都可以选择去支持的。</span></span><br><span class="line">dd = defaultdict(list)</span><br><span class="line"></span><br><span class="line">print(dd.get(<span class="string">"zhangsan"</span>))  <span class="comment"># None</span></span><br><span class="line">print(dd[<span class="string">"zhangsan"</span>])  <span class="comment"># []</span></span><br></pre></td></tr></table></figure>
<p><code>__missing__</code></p>
<p><code>__missing__</code> 方法只会被 <code>__getitem__</code> 调用（比如在表达式 d[k] 中）。提供 <code>__missing__</code> 方法对 get 或者<code>__contains__</code>（in 运算符会用到这个方法）这些方法的使用没有影响。这也是我在上一节最后的警告中提到，defaultdict 中的default_factory 只对 <code>__getitem__</code> 有作用的原因。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StrKeyDict0</span><span class="params">(dict)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    StrKeyDict0 继承了 dict</span></span><br><span class="line"><span class="string">    如果找不到的键本身就是字符串，那就抛出 KeyError 异常</span></span><br><span class="line"><span class="string">    如果找不到的键不是字符串，那么把它转换成字符串再进行查找</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    isinstance(key, str) 测试在上面的__missing__ 中是必需的。如果没有这个测试，只要 str(k) 返回的是一个存在的键，那么__missing__</span></span><br><span class="line"><span class="string">    方法是没问题的，不管是字符串键还是非字符串键，它都能正常运行。但是如果 str(k) 不是一个存在的键，代码就会陷入无限递归。这是因为</span></span><br><span class="line"><span class="string">    __missing__ 的最后一行中的 self[str(key)] 会调用 __getitem__，而这个 str(key) 又不存在，于是 __missing__又会被调用。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    同样在 __contains__ 方法中，也不能使用 key in my_dict 来检查 key 是否存在，因为那也会导致 __contains__ 被递归调用</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__missing__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(key, str):</span><br><span class="line">            <span class="keyword">raise</span> KeyError(key)</span><br><span class="line">        <span class="keyword">return</span> self[str(key)]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, key, default=None)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self[key]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">return</span> default</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> key <span class="keyword">in</span> self.keys() <span class="keyword">or</span> str(key) <span class="keyword">in</span> self.keys()</span><br></pre></td></tr></table></figure>
<h3 id="OrderedDict"><a href="#OrderedDict" class="headerlink" title="OrderedDict"></a>OrderedDict</h3><p>这个类型在添加键的时候会保持顺序，因此键的迭代次序总是一致的。OrderedDict 的 popitem 方法默认删除并返回的是字典里的最后一个元素，但是如果像 my_odict.popitem(last=False) 这样调用它，那么它删除并返回第一个被添加进去的元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line">new_dict = OrderedDict()</span><br><span class="line">new_dict[<span class="string">"a"</span>] = <span class="string">"a"</span></span><br><span class="line">new_dict[<span class="string">"c"</span>] = <span class="string">"c"</span></span><br><span class="line">new_dict[<span class="string">"d"</span>] = <span class="string">"d"</span></span><br><span class="line">new_dict[<span class="string">"b"</span>] = <span class="string">"b"</span></span><br><span class="line">print(new_dict)  <span class="comment"># OrderedDict([('a', 'a'), ('c', 'c'), ('d', 'd'), ('b', 'b')])</span></span><br><span class="line"></span><br><span class="line">print(new_dict.popitem())  <span class="comment"># ('b', 'b')</span></span><br><span class="line">print(new_dict.popitem(last=<span class="literal">False</span>))  <span class="comment"># ('a', 'a')</span></span><br></pre></td></tr></table></figure>
<h3 id="ChainMap"><a href="#ChainMap" class="headerlink" title="ChainMap"></a>ChainMap</h3><p><a href="https://www.cnblogs.com/mangmangbiluo/p/9882097.html" target="_blank" rel="noopener">https://www.cnblogs.com/mangmangbiluo/p/9882097.html</a> </p>
<p>该类型可以容纳数个不同的映射对象，然后在进行键查找操作的时候，这些对象会被当作一个整体被逐个查找，直到键被找到为止。这个功能在给有嵌套作用域的语言做解释器的时候很有用，可以用一个映射对象来代表一个作用域的上下文。</p>
<h3 id="不可变字典"><a href="#不可变字典" class="headerlink" title="不可变字典"></a>不可变字典</h3><p>标准库里所有的映射类型都是可变的，从 Python 3.3 开始，types 模块中引入了一个封装类名叫MappingProxyType。如果给这个类一个映射，它会返回一个只读的映射视图。虽然是个只读视图，但是它是动态的。这意味着如果对原映射做出了改动，我们通过这个视图可以观察到，但是无法通过这个视图对原映射做出修改。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> types <span class="keyword">import</span> MappingProxyType</span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">"a"</span>: <span class="string">"a"</span>, <span class="string">"b"</span>: <span class="string">"b"</span>, <span class="string">"c"</span>:<span class="string">"c"</span>&#125;</span><br><span class="line">proxy_d = MappingProxyType(d)</span><br><span class="line"></span><br><span class="line">print(proxy_d)  <span class="comment"># &#123;'a': 'a', 'b': 'b', 'c': 'c'&#125;</span></span><br><span class="line">print(proxy_d[<span class="string">"a"</span>])  <span class="comment"># a</span></span><br><span class="line">proxy_d[<span class="string">"a"</span>] = <span class="number">1</span>  <span class="comment"># TypeError: 'mappingproxy' object does not support item assignment</span></span><br></pre></td></tr></table></figure>
<h3 id="字典中的散列表"><a href="#字典中的散列表" class="headerlink" title="字典中的散列表"></a>字典中的散列表</h3><p>散列表其实是一个稀疏数组（总是有空白元素的数组称为稀疏数组）。在一般的数据结构教材中，散列表里的单元通常叫作表元（bucket）。在 dict 的散列表当中，每个键值对都占用一个表元，每个表元都有两个部分，一个是对键的引用，另一个是对值的引用。因为所有表元的大小一致，所以可以通过偏移量来读取某个表元。Python 会设法保证大概还有三分之一的表元是空的，所以在快要达到这个阈值的时候，原有的散列表会被复制到一个更大的空间里面。如果要把一个对象放入散列表，那么首先要计算这个元素键的散列值。Python 中可以用 hash() 方法来做这件事情。从 Python 3.3 开始，str、bytes 和 datetime 对象的散列值计算过程中多了随机的“加盐”这一步。所加盐值是 Python 进程内的一个常量，但是每次启动 Python 解释器都会生成一个不同的盐值。随机盐值的加入是为了防止 DOS 攻击而采取的一种安全措施。</p>
<p>为了获取 my_dict[search_key] 背后的值，Python 首先会调用 hash(search_key) 来计算 search_key 的散列值，把这个值最低的几位数字当作偏移量，在散列表里查找表元（具体取几位，得看当前散列表的大小）。若找到的表元是空的，则抛出 KeyError 异常。若不是空的，则表元里会有一对 found_key:found_value。这时候 Python 会检验 search_key == found_key 是否为真，如果它们相等的话，就会返回 found_value。如果 search_key 和found_key 不匹配的话，这种情况称为散列冲突。发生这种情况是因为，散列表所做的其实是把随机的元素映<br>射到只有几位的数字上，而散列表本身的索引又只依赖于这个数字的一部分。为了解决散列冲突，算法会在散列值中另外再取几位，然后用特殊的方法处理一下，把新得到的数字再当作索引来寻找表元。若这次找到的表元是空的，则同样抛出 KeyError；若非空，或者键匹配，则返回这个值；或者又发现了散列冲突，则重复以上的步骤。</p>
<p><img src="https://r.photo.store.qq.com/psc?/V12EvAd609VbnF/ChQ0KIcA.iub3F93BayOjBvtyafT1KaVP*Q3G4MQFMtEyT9mG0Q0N9CjjjuUO2ywpLWr04NmTmXfq3i36Miwvg!!/mnull&amp;bo=RwOVAUcDlQEDCSw!&amp;rf=photolist&amp;t=5/r/_yake_qzoneimgout.png" alt></p>
<p>添加新元素和更新现有键值的操作几乎跟上面一样。只不过对于前者，在发现空表元的时候会放入一个新元素；对于后者，在找到相对应的表元后，原表里的值对象会被替换成新值。另外在插入新值时，Python 可能会按照散列表的拥挤程度来决定是否要重新分配内存为它扩容。如果增加了散列表的大小，那散列值所占的位数和用作索引的位数都会随之增加，这样做的目的是为了减少发生散列冲突的概率。</p>
<h3 id="字典键的次序取决于添加顺序"><a href="#字典键的次序取决于添加顺序" class="headerlink" title="字典键的次序取决于添加顺序"></a>字典键的次序取决于添加顺序</h3><p>当往 dict 里添加新键而又发生散列冲突的时候，新键可能会被安排存放到另一个位置。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">DIAL_CODES = [</span><br><span class="line">    (<span class="number">86</span>, <span class="string">'China'</span>),</span><br><span class="line">    (<span class="number">91</span>, <span class="string">'India'</span>),</span><br><span class="line">    (<span class="number">1</span>, <span class="string">'United States'</span>),</span><br><span class="line">    (<span class="number">62</span>, <span class="string">'Indonesia'</span>),</span><br><span class="line">    (<span class="number">55</span>, <span class="string">'Brazil'</span>),</span><br><span class="line">    (<span class="number">92</span>, <span class="string">'Pakistan'</span>),</span><br><span class="line">    (<span class="number">880</span>, <span class="string">'Bangladesh'</span>),</span><br><span class="line">    (<span class="number">234</span>, <span class="string">'Nigeria'</span>),</span><br><span class="line">    (<span class="number">7</span>, <span class="string">'Russia'</span>),</span><br><span class="line">    (<span class="number">81</span>, <span class="string">'Japan'</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d1 = dict(DIAL_CODES)</span><br><span class="line">print(<span class="string">'d1:'</span>, d1.keys())</span><br><span class="line">print(<span class="string">'d1:'</span>, d1)</span><br><span class="line"></span><br><span class="line">d2 = dict(sorted(DIAL_CODES))</span><br><span class="line">print(<span class="string">'d2:'</span>, d2.keys())</span><br><span class="line">print(<span class="string">'d2:'</span>, d2)</span><br><span class="line"></span><br><span class="line">d3 = dict(sorted(DIAL_CODES, key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>]))</span><br><span class="line">print(<span class="string">'d3:'</span>, d3.keys())</span><br><span class="line">print(<span class="string">'d3:'</span>, d3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> d1 == d2 <span class="keyword">and</span> d2 == d3  <span class="comment"># 三个字典相等，但是 key 的顺序不一致</span></span><br></pre></td></tr></table></figure>
<p>无论何时往字典里添加新的键，Python 解释器都可能做出为字典扩容的决定。扩容导致的结果就是要新建一个更大的散列表，并把字典里已有的元素添加到新表里。这个过程中可能会发生新的散列冲突，导致新散列表中键的次序变化。</p>
<h3 id="保留最后-N-个元素"><a href="#保留最后-N-个元素" class="headerlink" title="保留最后 N 个元素"></a>保留最后 N 个元素</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个固定大小的队列</span></span><br><span class="line">q = deque(maxlen=<span class="number">3</span>)</span><br><span class="line"><span class="comment"># 添加元素</span></span><br><span class="line">q.append(<span class="number">1</span>)</span><br><span class="line">q.append(<span class="number">2</span>)</span><br><span class="line">q.append(<span class="number">3</span>)</span><br><span class="line">q.append(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">print(q)  <span class="comment"># deque([2, 3, 4], maxlen=3)</span></span><br><span class="line">print(q.pop())  <span class="comment"># 删除结尾的元素</span></span><br><span class="line">print(q.popleft())  <span class="comment"># 删除前面的元素</span></span><br></pre></td></tr></table></figure>
<h3 id="查找最大或最小的-N-个元素"><a href="#查找最大或最小的-N-个元素" class="headerlink" title="查找最大或最小的 N 个元素"></a>查找最大或最小的 N 个元素</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line">nums = [<span class="number">1</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">23</span>, <span class="number">7</span>, <span class="number">-4</span>, <span class="number">18</span>, <span class="number">23</span>, <span class="number">42</span>, <span class="number">37</span>, <span class="number">2</span>]</span><br><span class="line"><span class="comment"># 获取最大的前三个元素</span></span><br><span class="line">print(heapq.nlargest(<span class="number">3</span>, nums))  <span class="comment"># [42, 37, 23]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取最小的前三个元素</span></span><br><span class="line">print(heapq.nsmallest(<span class="number">3</span>, nums)) <span class="comment"># [-4, 1, 2]</span></span><br></pre></td></tr></table></figure>
<p>按照某些规则获取查找最大或最小的 N 个元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">portfolio = [</span><br><span class="line">    &#123;<span class="string">'name'</span>: <span class="string">'IBM'</span>, <span class="string">'shares'</span>: <span class="number">100</span>, <span class="string">'price'</span>: <span class="number">91.1</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'name'</span>: <span class="string">'AAPL'</span>, <span class="string">'shares'</span>: <span class="number">50</span>, <span class="string">'price'</span>: <span class="number">543.22</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'name'</span>: <span class="string">'FB'</span>, <span class="string">'shares'</span>: <span class="number">200</span>, <span class="string">'price'</span>: <span class="number">21.09</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'name'</span>: <span class="string">'HPQ'</span>, <span class="string">'shares'</span>: <span class="number">35</span>, <span class="string">'price'</span>: <span class="number">31.75</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'name'</span>: <span class="string">'YHOO'</span>, <span class="string">'shares'</span>: <span class="number">45</span>, <span class="string">'price'</span>: <span class="number">16.35</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'name'</span>: <span class="string">'ACME'</span>, <span class="string">'shares'</span>: <span class="number">75</span>, <span class="string">'price'</span>: <span class="number">115.65</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据价格获取最大前三个数据</span></span><br><span class="line">print(heapq.nlargest(<span class="number">3</span>, portfolio, key=<span class="keyword">lambda</span> x:x[<span class="string">"price"</span>]))</span><br><span class="line"><span class="comment"># [&#123;'name': 'AAPL', 'shares': 50, 'price': 543.22&#125;, &#123;'name': 'ACME', 'shares': 75, 'price': 115.65&#125;, &#123;'name': 'IBM', 'shares': 100, 'price': 91.1&#125;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据价格获取最小前三个数据</span></span><br><span class="line">print(heapq.nsmallest(<span class="number">3</span>, portfolio, key=<span class="keyword">lambda</span> x:x[<span class="string">"price"</span>]))</span><br><span class="line"><span class="comment"># [&#123;'name': 'YHOO', 'shares': 45, 'price': 16.35&#125;, &#123;'name': 'FB', 'shares': 200, 'price': 21.09&#125;, &#123;'name': 'HPQ', 'shares': 35, 'price': 31.75&#125;]</span></span><br></pre></td></tr></table></figure>
<p>将元素排序后，每次返回最小的元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line">nums = [<span class="number">1</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">23</span>, <span class="number">7</span>, <span class="number">-4</span>, <span class="number">18</span>, <span class="number">23</span>, <span class="number">42</span>, <span class="number">37</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">heapq.heapify(nums)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每次返回一个最小的元素</span></span><br><span class="line">print(heapq.heappop(nums))</span><br><span class="line">print(heapq.heappop(nums))</span><br><span class="line">print(heapq.heappop(nums))</span><br><span class="line">print(heapq.heappop(nums))</span><br><span class="line">print(heapq.heappop(nums))</span><br><span class="line">print(heapq.heappop(nums))</span><br></pre></td></tr></table></figure>
<h3 id="实现一个优先级队列"><a href="#实现一个优先级队列" class="headerlink" title="实现一个优先级队列"></a>实现一个优先级队列</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line">nums = [(<span class="number">1</span>, <span class="number">1</span>), (<span class="number">-1</span>, <span class="number">3</span>),(<span class="number">-1</span>, <span class="number">2</span>), (<span class="number">1</span>, <span class="number">0</span>)]</span><br><span class="line"></span><br><span class="line">heapq.heapify(nums)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每次返回一个最小的元素, 按照每个元素的第一个值先排序，若第一个值相同在按照第二个值进行排序</span></span><br><span class="line">print(heapq.heappop(nums))</span><br><span class="line">print(heapq.heappop(nums))</span><br><span class="line">print(heapq.heappop(nums))</span><br><span class="line">print(heapq.heappop(nums))</span><br></pre></td></tr></table></figure>
<p>根据 heapq 的排序原理（按照元素第一个值排序，第一个值相同在按照第二个），heappop 每次返回一个最小的元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PriorityQueue</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._queue = []  <span class="comment"># 存储元素</span></span><br><span class="line">        self._index = <span class="number">0</span>  <span class="comment"># 添加顺序</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, item, priority)</span>:</span></span><br><span class="line">        <span class="comment"># 添加元素</span></span><br><span class="line">        heapq.heappush(self._queue, (-priority, self._index, item))</span><br><span class="line">        self._index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 弹出元素</span></span><br><span class="line">        <span class="keyword">return</span> heapq.heappop(self._queue)[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Item</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Item(&#123;!r&#125;)'</span>.format(self.name)</span><br><span class="line"></span><br><span class="line">q = PriorityQueue()</span><br><span class="line">q.push(Item(<span class="string">'foo'</span>), <span class="number">1</span>)</span><br><span class="line">q.push(Item(<span class="string">'bar'</span>), <span class="number">5</span>)</span><br><span class="line">q.push(Item(<span class="string">'spam'</span>), <span class="number">4</span>)</span><br><span class="line">q.push(Item(<span class="string">'grok'</span>), <span class="number">1</span>)  <span class="comment"># 添加两个优先级相同的元素，优先级相同会按照添加顺序弹出</span></span><br><span class="line"></span><br><span class="line">print(q.pop())</span><br><span class="line">print(q.pop())</span><br><span class="line">print(q.pop())</span><br><span class="line">print(q.pop())</span><br></pre></td></tr></table></figure>
<p>由于 push 和 pop 操作时间复杂度为 O(log N)，其中 N 是堆的大小，因此就算是 N 很大的时候它们运行速度也依旧很快。 在上面代码中，队列包含了一个 <code>(-priority, index, item)</code> 的元组。 优先级为负数的目的是使得元素按照优先级从高到低排序。 这个跟普通的按优先级从低到高排序的堆排序恰巧相反。<code>index</code> 变量的作用是保证同等优先级元素的正确排序。 通过保存一个不断增加的 <code>index</code> 下标变量，可以确保元素按照它们插入的顺序排序。 而且， <code>index</code> 变量也在相同优先级元素比较的时候起到重要作用。</p>
<h3 id="字典中的键映射多个值"><a href="#字典中的键映射多个值" class="headerlink" title="字典中的键映射多个值"></a>字典中的键映射多个值</h3><p>普通实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 字典中的每个 key 映射多个值，值是 list，有顺序，可重复</span></span><br><span class="line">d = &#123;</span><br><span class="line">    <span class="string">'a'</span> : [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    <span class="string">'b'</span> : [<span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字典中的每个 key 映射多个值，值是 set，无顺序，不可重复</span></span><br><span class="line">e = &#123;</span><br><span class="line">    <span class="string">'a'</span> : &#123;<span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>&#125;,</span><br><span class="line">    <span class="string">'b'</span> : &#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>defaultdict 实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line">d = defaultdict(list)</span><br><span class="line">d[<span class="string">"a"</span>].append(<span class="number">1</span>)</span><br><span class="line">d[<span class="string">"a"</span>].append(<span class="number">2</span>)</span><br><span class="line">d[<span class="string">"a"</span>].append(<span class="number">4</span>)</span><br><span class="line">d[<span class="string">"a"</span>].append(<span class="number">5</span>)</span><br><span class="line">print(d)  <span class="comment"># defaultdict(&lt;class 'list'&gt;, &#123;'a': [1, 2, 4, 5]&#125;)</span></span><br><span class="line"></span><br><span class="line">s = defaultdict(set)</span><br><span class="line">s[<span class="string">"a"</span>].add(<span class="number">1</span>)</span><br><span class="line">s[<span class="string">"a"</span>].add(<span class="number">2</span>)</span><br><span class="line">s[<span class="string">"a"</span>].add(<span class="number">4</span>)</span><br><span class="line">s[<span class="string">"a"</span>].add(<span class="number">4</span>)</span><br><span class="line">print(s)  <span class="comment">#  defaultdict(&lt;class 'set'&gt;, &#123;'a': &#123;1, 2, 4&#125;&#125;)</span></span><br></pre></td></tr></table></figure>
<p>setdefault 实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c = &#123;&#125; <span class="comment"># 一个普通的字典</span></span><br><span class="line">c.setdefault(<span class="string">'a'</span>, []).append(<span class="number">1</span>)  <span class="comment">#</span></span><br><span class="line">c.setdefault(<span class="string">'a'</span>, []).append(<span class="number">2</span>)  <span class="comment"># 如果 a 存在则直接 append</span></span><br><span class="line">c.setdefault(<span class="string">'b'</span>, []).append(<span class="number">4</span>)</span><br><span class="line">print(c)  <span class="comment"># &#123;'a': [1, 2], 'b': [4]&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="有序字典"><a href="#有序字典" class="headerlink" title="有序字典"></a>有序字典</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line">d = OrderedDict()</span><br><span class="line">d[<span class="string">'foo'</span>] = <span class="number">1</span></span><br><span class="line">d[<span class="string">'bar'</span>] = <span class="number">2</span></span><br><span class="line">d[<span class="string">'spam'</span>] = <span class="number">3</span></span><br><span class="line">d[<span class="string">'grok'</span>] = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">print(d)  <span class="comment"># OrderedDict([('foo', 1), ('bar', 2), ('spam', 3), ('grok', 4)])</span></span><br></pre></td></tr></table></figure>
<p><code>OrderedDict</code> 内部维护着一个根据键插入顺序排序的双向链表。每次当一个新的元素插入进来的时候， 它会被放到链表的尾部。对于一个已经存在的键的重复赋值不会改变键的顺序。需要注意的是，一个 <code>OrderedDict</code> 的大小是一个普通字典的两倍，因为它内部维护着另外一个链表。</p>
<h3 id="查找两字典的相同点"><a href="#查找两字典的相同点" class="headerlink" title="查找两字典的相同点"></a>查找两字典的相同点</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;</span><br><span class="line">    <span class="string">'x'</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="string">'y'</span> : <span class="number">2</span>,</span><br><span class="line">    <span class="string">'z'</span> : <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">b = &#123;</span><br><span class="line">    <span class="string">'w'</span> : <span class="number">10</span>,</span><br><span class="line">    <span class="string">'x'</span> : <span class="number">11</span>,</span><br><span class="line">    <span class="string">'y'</span> : <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print(a.keys() &amp; b.keys())  <span class="comment"># &#123;'y', 'x'&#125;</span></span><br><span class="line">print(a.keys() - b.keys())  <span class="comment"># &#123;'z'&#125;</span></span><br><span class="line">print(a.items() &amp; b.items())  <span class="comment"># &#123;('y', 2)&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="删除序列相同元素并保持顺序"><a href="#删除序列相同元素并保持顺序" class="headerlink" title="删除序列相同元素并保持顺序"></a>删除序列相同元素并保持顺序</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dedupe</span><span class="params">(items, key=None)</span>:</span></span><br><span class="line">    seen = set()</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        val = item <span class="keyword">if</span> key <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> key(item)</span><br><span class="line">        <span class="keyword">if</span> val <span class="keyword">not</span> <span class="keyword">in</span> seen:</span><br><span class="line">            <span class="keyword">yield</span> item</span><br><span class="line">            seen.add(val)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = [ &#123;<span class="string">'x'</span>:<span class="number">1</span>, <span class="string">'y'</span>:<span class="number">2</span>&#125;, &#123;<span class="string">'x'</span>:<span class="number">1</span>, <span class="string">'y'</span>:<span class="number">3</span>&#125;, &#123;<span class="string">'x'</span>:<span class="number">1</span>, <span class="string">'y'</span>:<span class="number">2</span>&#125;, &#123;<span class="string">'x'</span>:<span class="number">2</span>, <span class="string">'y'</span>:<span class="number">4</span>&#125;]</span><br><span class="line">print(list(dedupe(a, key=<span class="keyword">lambda</span> d: (d[<span class="string">'x'</span>],d[<span class="string">'y'</span>]))))</span><br><span class="line"><span class="comment"># [&#123;'x': 1, 'y': 2&#125;, &#123;'x': 1, 'y': 3&#125;, &#123;'x': 2, 'y': 4&#125;]</span></span><br><span class="line"></span><br><span class="line">b = [<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">10</span>]</span><br><span class="line">print(list(dedupe(b)))</span><br><span class="line"><span class="comment"># [1, 5, 2, 9, 10]</span></span><br></pre></td></tr></table></figure>
<h3 id="slice"><a href="#slice" class="headerlink" title="slice"></a>slice</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">items = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">name_slice = slice(<span class="number">2</span>, <span class="number">4</span>)  <span class="comment"># 创建一个带名字的切片 name_slice</span></span><br><span class="line">print(items[name_slice])  <span class="comment"># 利用命名切片，获取元素</span></span><br><span class="line">print(items[<span class="number">2</span>:<span class="number">4</span>])         <span class="comment"># 和这种方式一样，但是这种方式不直观</span></span><br></pre></td></tr></table></figure>
<h3 id="序列中出现次数最多的元素"><a href="#序列中出现次数最多的元素" class="headerlink" title="序列中出现次数最多的元素"></a>序列中出现次数最多的元素</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">words = [</span><br><span class="line">    <span class="string">'look'</span>, <span class="string">'into'</span>, <span class="string">'my'</span>, <span class="string">'eyes'</span>, <span class="string">'look'</span>, <span class="string">'into'</span>, <span class="string">'my'</span>, <span class="string">'eyes'</span>,</span><br><span class="line">    <span class="string">'the'</span>, <span class="string">'eyes'</span>, <span class="string">'the'</span>, <span class="string">'eyes'</span>, <span class="string">'the'</span>, <span class="string">'eyes'</span>, <span class="string">'not'</span>, <span class="string">'around'</span>, <span class="string">'the'</span>,</span><br><span class="line">    <span class="string">'eyes'</span>, <span class="string">"don't"</span>, <span class="string">'look'</span>, <span class="string">'around'</span>, <span class="string">'the'</span>, <span class="string">'eyes'</span>, <span class="string">'look'</span>, <span class="string">'into'</span>,</span><br><span class="line">    <span class="string">'my'</span>, <span class="string">'eyes'</span>, <span class="string">"you're"</span>, <span class="string">'under'</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">word_counts = Counter(words)</span><br><span class="line"><span class="comment"># 取出前三个出现最多的元素</span></span><br><span class="line">print(word_counts.most_common(<span class="number">3</span>))</span><br><span class="line"><span class="comment"># [('eyes', 8), ('the', 5), ('look', 4)</span></span><br></pre></td></tr></table></figure>
<h3 id="通过某个关键字排序一个字典列表"><a href="#通过某个关键字排序一个字典列表" class="headerlink" title="通过某个关键字排序一个字典列表"></a>通过某个关键字排序一个字典列表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">rows = [</span><br><span class="line">    &#123;<span class="string">'fname'</span>: <span class="string">'Brian'</span>, <span class="string">'lname'</span>: <span class="string">'Jones'</span>, <span class="string">'uid'</span>: <span class="number">1003</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'fname'</span>: <span class="string">'David'</span>, <span class="string">'lname'</span>: <span class="string">'Beazley'</span>, <span class="string">'uid'</span>: <span class="number">1002</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'fname'</span>: <span class="string">'John'</span>, <span class="string">'lname'</span>: <span class="string">'Cleese'</span>, <span class="string">'uid'</span>: <span class="number">1001</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'fname'</span>: <span class="string">'Big'</span>, <span class="string">'lname'</span>: <span class="string">'Jones'</span>, <span class="string">'uid'</span>: <span class="number">1004</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据 fname 排序</span></span><br><span class="line">rows_by_fname = sorted(rows, key=itemgetter(<span class="string">"fname"</span>))</span><br><span class="line">print(rows_by_fname)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据 fname lname 排序</span></span><br><span class="line">rows_by_lfname = sorted(rows, key=itemgetter(<span class="string">"fname"</span>, <span class="string">"lname"</span>))</span><br><span class="line">print(rows_by_lfname)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用匿名函数替换 itemgetter，但是匿名函数效率没有 itemgetter 高</span></span><br><span class="line">rows_by_fname2 = sorted(rows, key=<span class="keyword">lambda</span> r: r[<span class="string">'fname'</span>])</span><br><span class="line">rows_by_lfname2 = sorted(rows, key=<span class="keyword">lambda</span> r: (r[<span class="string">'lname'</span>],r[<span class="string">'fname'</span>]))</span><br></pre></td></tr></table></figure>
<p>itemgetter 同样也适用于 max，min</p>
<h3 id="排序不支持比较的对象"><a href="#排序不支持比较的对象" class="headerlink" title="排序不支持比较的对象"></a>排序不支持比较的对象</h3><p>可以借助对象的属性的值来进行排序</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, user_id)</span>:</span></span><br><span class="line">        self.user_id = user_id</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'User(&#123;&#125;)'</span>.format(self.user_id)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">users = [User(<span class="number">23</span>), User(<span class="number">3</span>), User(<span class="number">99</span>)]</span><br><span class="line">print(sorted(users, key=<span class="keyword">lambda</span> x:x.user_id))</span><br><span class="line"><span class="comment"># [User(3), User(23), User(99)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 attrgetter 替代匿名函数，attrgetter 效率更高些</span></span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> attrgetter</span><br><span class="line">print(sorted(users, key=attrgetter(<span class="string">"user_id"</span>)))</span><br><span class="line"><span class="comment"># [User(3), User(23), User(99)]</span></span><br></pre></td></tr></table></figure>
<p>attrgetter同样也适用于 max，min</p>
<h3 id="通过某个字段将记录分组"><a href="#通过某个字段将记录分组" class="headerlink" title="通过某个字段将记录分组"></a>通过某个字段将记录分组</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">rows = [</span><br><span class="line">    &#123;<span class="string">'address'</span>: <span class="string">'5412 N CLARK'</span>, <span class="string">'date'</span>: <span class="string">'07/01/2012'</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'address'</span>: <span class="string">'5148 N CLARK'</span>, <span class="string">'date'</span>: <span class="string">'07/02/2012'</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'address'</span>: <span class="string">'5800 E 58TH'</span>, <span class="string">'date'</span>: <span class="string">'07/02/2012'</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'address'</span>: <span class="string">'2122 N CLARK'</span>, <span class="string">'date'</span>: <span class="string">'07/03/2012'</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'address'</span>: <span class="string">'5645 N RAVENSWOOD'</span>, <span class="string">'date'</span>: <span class="string">'07/02/2012'</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'address'</span>: <span class="string">'1060 W ADDISON'</span>, <span class="string">'date'</span>: <span class="string">'07/02/2012'</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'address'</span>: <span class="string">'4801 N BROADWAY'</span>, <span class="string">'date'</span>: <span class="string">'07/01/2012'</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'address'</span>: <span class="string">'1039 W GRANVILLE'</span>, <span class="string">'date'</span>: <span class="string">'07/03/2012'</span>&#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照 date 进行分组排序</span></span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> groupby</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里的排序非常重要，因为 groupby 仅仅检查连续的元素。如果不排序，会和期望结果不一样</span></span><br><span class="line">rows.sort(key=itemgetter(<span class="string">'date'</span>))</span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> groupby(rows, key=itemgetter(<span class="string">"date"</span>)):</span><br><span class="line">    print(k)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> v:</span><br><span class="line">        print(<span class="string">" "</span>, x)</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">07/01/2012</span></span><br><span class="line"><span class="string">  &#123;'address': '5412 N CLARK', 'date': '07/01/2012'&#125;</span></span><br><span class="line"><span class="string">  &#123;'address': '4801 N BROADWAY', 'date': '07/01/2012'&#125;</span></span><br><span class="line"><span class="string">07/02/2012</span></span><br><span class="line"><span class="string">  &#123;'address': '5148 N CLARK', 'date': '07/02/2012'&#125;</span></span><br><span class="line"><span class="string">  &#123;'address': '5800 E 58TH', 'date': '07/02/2012'&#125;</span></span><br><span class="line"><span class="string">  &#123;'address': '5645 N RAVENSWOOD', 'date': '07/02/2012'&#125;</span></span><br><span class="line"><span class="string">  &#123;'address': '1060 W ADDISON', 'date': '07/02/2012'&#125;</span></span><br><span class="line"><span class="string">07/03/2012</span></span><br><span class="line"><span class="string">  &#123;'address': '2122 N CLARK', 'date': '07/03/2012'&#125;</span></span><br><span class="line"><span class="string">  &#123;'address': '1039 W GRANVILLE', 'date': '07/03/2012'&#125;</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<p>将相同日期的数据放到同一个 list 当中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将相同日期的数据放到同一个 list 当中</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line">rows_by_date = defaultdict(list)</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> rows:</span><br><span class="line">    rows_by_date[row[<span class="string">'date'</span>]].append(row)</span><br><span class="line">print(rows_by_date)</span><br></pre></td></tr></table></figure>
<h3 id="过滤序列元素"><a href="#过滤序列元素" class="headerlink" title="过滤序列元素"></a>过滤序列元素</h3><p>列表推导式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用列表推导式进行元素的过滤，此性能不高，较耗内存</span></span><br><span class="line">mylist = [<span class="number">1</span>, <span class="number">4</span>, <span class="number">-5</span>, <span class="number">10</span>, <span class="number">-7</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">-1</span>]</span><br><span class="line">print([x <span class="keyword">for</span> x <span class="keyword">in</span> mylist <span class="keyword">if</span> x &lt; <span class="number">0</span>])</span><br><span class="line"><span class="comment"># [-5, -7, -1]</span></span><br></pre></td></tr></table></figure>
<p>生成器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成器</span></span><br><span class="line">a = (x <span class="keyword">for</span> x <span class="keyword">in</span> mylist <span class="keyword">if</span> x &lt; <span class="number">0</span>)</span><br><span class="line">print(list(a))</span><br><span class="line"><span class="comment"># [-5, -7, -1]</span></span><br></pre></td></tr></table></figure>
<p>Filter</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Filter</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">less</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span> <span class="keyword">if</span> x &lt; <span class="number">0</span> <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line">print(list(filter(less, mylist)))</span><br><span class="line"><span class="comment"># [-5, -7, -1]</span></span><br></pre></td></tr></table></figure>
<p>compress</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># compress</span></span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> compress</span><br><span class="line">addresses = [</span><br><span class="line">    <span class="string">'5412 N CLARK'</span>,</span><br><span class="line">    <span class="string">'5148 N CLARK'</span>,</span><br><span class="line">    <span class="string">'5800 E 58TH'</span>,</span><br><span class="line">    <span class="string">'2122 N CLARK'</span>,</span><br><span class="line">    <span class="string">'5645 N RAVENSWOOD'</span>,</span><br><span class="line">    <span class="string">'1060 W ADDISON'</span>,</span><br><span class="line">    <span class="string">'4801 N BROADWAY'</span>,</span><br><span class="line">    <span class="string">'1039 W GRANVILLE'</span>,</span><br><span class="line">]</span><br><span class="line"><span class="comment"># 选择器，值为 True 即不过滤 addresses 中的元素</span></span><br><span class="line">selector = [<span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">False</span>, <span class="literal">False</span>, <span class="literal">True</span>]</span><br><span class="line">print(list(compress(addresses, selector)))</span><br><span class="line"><span class="comment"># ['5412 N CLARK', '5148 N CLARK', '5645 N RAVENSWOOD']</span></span><br></pre></td></tr></table></figure>
<h3 id="命名元组"><a href="#命名元组" class="headerlink" title="命名元组"></a>命名元组</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line">User = namedtuple(<span class="string">"User"</span>, [<span class="string">"name"</span>, <span class="string">"age"</span>])</span><br><span class="line"></span><br><span class="line">u1 = User(<span class="string">"zhangsan"</span>, <span class="number">20</span>)</span><br><span class="line">u2 = User(<span class="string">"lisi"</span>, <span class="number">30</span>)</span><br><span class="line">print(u1, u2)</span><br><span class="line"><span class="comment"># User(name='zhangsan', age=20) User(name='lisi', age=30)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改 namedtuple 的值只能使用 _replace 方法</span></span><br><span class="line">u11 = u1._replace(name=<span class="string">"wanghwu"</span>)</span><br><span class="line">print(u11)</span><br><span class="line"><span class="comment"># User(name='wanghwu', age=20)</span></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Python-高级/" rel="tag"><i class="fa fa-tag"></i> Python 高级</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/06/29/Python 高级2/" rel="prev" title="Python 高级2">
      <i class="fa fa-chevron-left"></i> Python 高级2
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/07/01/安装 Elasticsearch /" rel="next" title="安装 Elasticsearch">
      安装 Elasticsearch <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#魔法方法"><span class="nav-number">1.</span> <span class="nav-text">魔法方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#repr"><span class="nav-number">1.1.</span> <span class="nav-text">repr</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#str"><span class="nav-number">1.2.</span> <span class="nav-text">str</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bool"><span class="nav-number">1.3.</span> <span class="nav-text">bool</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#切片"><span class="nav-number">2.</span> <span class="nav-text">切片</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#元组拆包"><span class="nav-number">2.1.</span> <span class="nav-text">元组拆包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#嵌套元组拆包"><span class="nav-number">2.2.</span> <span class="nav-text">嵌套元组拆包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#具名元组"><span class="nav-number">2.3.</span> <span class="nav-text">具名元组</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#切片赋值"><span class="nav-number">2.4.</span> <span class="nav-text">切片赋值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#序列的增量赋值"><span class="nav-number">2.5.</span> <span class="nav-text">序列的增量赋值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#一个关于-的谜题"><span class="nav-number">2.6.</span> <span class="nav-text">一个关于+=的谜题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#list-sort-和-sorted"><span class="nav-number">3.</span> <span class="nav-text">list.sort 和 sorted</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bisect"><span class="nav-number">4.</span> <span class="nav-text">bisect</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#array"><span class="nav-number">5.</span> <span class="nav-text">array</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#deque"><span class="nav-number">6.</span> <span class="nav-text">deque</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字典找不到-key-时返回默认值"><span class="nav-number">7.</span> <span class="nav-text">字典找不到 key 时返回默认值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OrderedDict"><span class="nav-number">8.</span> <span class="nav-text">OrderedDict</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ChainMap"><span class="nav-number">9.</span> <span class="nav-text">ChainMap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#不可变字典"><span class="nav-number">10.</span> <span class="nav-text">不可变字典</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字典中的散列表"><span class="nav-number">11.</span> <span class="nav-text">字典中的散列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字典键的次序取决于添加顺序"><span class="nav-number">12.</span> <span class="nav-text">字典键的次序取决于添加顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#保留最后-N-个元素"><span class="nav-number">13.</span> <span class="nav-text">保留最后 N 个元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查找最大或最小的-N-个元素"><span class="nav-number">14.</span> <span class="nav-text">查找最大或最小的 N 个元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现一个优先级队列"><span class="nav-number">15.</span> <span class="nav-text">实现一个优先级队列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字典中的键映射多个值"><span class="nav-number">16.</span> <span class="nav-text">字典中的键映射多个值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#有序字典"><span class="nav-number">17.</span> <span class="nav-text">有序字典</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查找两字典的相同点"><span class="nav-number">18.</span> <span class="nav-text">查找两字典的相同点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除序列相同元素并保持顺序"><span class="nav-number">19.</span> <span class="nav-text">删除序列相同元素并保持顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#slice"><span class="nav-number">20.</span> <span class="nav-text">slice</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#序列中出现次数最多的元素"><span class="nav-number">21.</span> <span class="nav-text">序列中出现次数最多的元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通过某个关键字排序一个字典列表"><span class="nav-number">22.</span> <span class="nav-text">通过某个关键字排序一个字典列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#排序不支持比较的对象"><span class="nav-number">23.</span> <span class="nav-text">排序不支持比较的对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通过某个字段将记录分组"><span class="nav-number">24.</span> <span class="nav-text">通过某个字段将记录分组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#过滤序列元素"><span class="nav-number">25.</span> <span class="nav-text">过滤序列元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#命名元组"><span class="nav-number">26.</span> <span class="nav-text">命名元组</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Rex"
      src="https://raw.githubusercontent.com/rexyan/warehouse/master/20230809141242.jpg">
  <p class="site-author-name" itemprop="name">Rex</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">446</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">183</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa-hand-o-right"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rex</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
